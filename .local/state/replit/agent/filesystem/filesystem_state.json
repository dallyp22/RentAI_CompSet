{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2755},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertPropertySchema, insertPropertyAnalysisSchema, insertOptimizationReportSchema, insertScrapingJobSchema, filterCriteriaSchema, type ScrapedUnit } from \"@shared/schema\";\nimport OpenAI from \"openai\";\n\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY_ENV_VAR || \"default_key\" \n});\n\nconst SCRAPEZY_API_KEY = process.env.SCRAPEZY_API_KEY;\nconst SCRAPEZY_BASE_URL = \"https://scrapezy.com/api/extract\";\n\n// Scrapezy API integration functions\nasync function callScrapezyScraping(url: string, customPrompt?: string) {\n  console.log(`üöÄ [SCRAPEZY] Starting scraping for URL: ${url}`);\n  console.log(`üöÄ [SCRAPEZY] API Key configured: ${!!SCRAPEZY_API_KEY}`);\n  console.log(`üöÄ [SCRAPEZY] Base URL: ${SCRAPEZY_BASE_URL}`);\n  \n  if (!SCRAPEZY_API_KEY) {\n    console.error(`‚ùå [SCRAPEZY] API key not configured`);\n    throw new Error(\"Scrapezy API key not configured\");\n  }\n\n  const prompt = customPrompt || \"Extract apartment listings from this apartments.com page. For each apartment property listing, extract: 1) The complete URL link to the individual apartment page (must start with https://www.apartments.com/), 2) The property/apartment name or title, 3) The address or location information. Return as JSON array with objects containing \\\"url\\\", \\\"name\\\", and \\\"address\\\" fields.\";\n  \n  console.log(`üöÄ [SCRAPEZY] Using prompt: ${prompt.substring(0, 100)}...`);\n\n  // Create job\n  console.log(`üöÄ [SCRAPEZY] Creating scraping job...`);\n  const requestBody = {\n    url,\n    prompt\n  };\n  console.log(`üöÄ [SCRAPEZY] Request body:`, JSON.stringify(requestBody, null, 2));\n  \n  const jobResponse = await fetch(SCRAPEZY_BASE_URL, {\n    method: \"POST\",\n    headers: {\n      \"x-api-key\": SCRAPEZY_API_KEY,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(requestBody),\n    signal: AbortSignal.timeout(30000)\n  });\n\n  console.log(`üöÄ [SCRAPEZY] Job creation response status: ${jobResponse.status} ${jobResponse.statusText}`);\n  console.log(`üöÄ [SCRAPEZY] Job creation response headers:`, Object.fromEntries(jobResponse.headers.entries()));\n\n  if (!jobResponse.ok) {\n    const responseText = await jobResponse.text();\n    console.error(`‚ùå [SCRAPEZY] Job creation failed. Response body: ${responseText}`);\n    throw new Error(`Scrapezy API error: ${jobResponse.status} ${jobResponse.statusText}`);\n  }\n\n  const jobData = await jobResponse.json();\n  console.log(`üöÄ [SCRAPEZY] Job creation response data:`, JSON.stringify(jobData, null, 2));\n  \n  const jobId = jobData.id || jobData.jobId;\n  \n  if (!jobId) {\n    console.error(`‚ùå [SCRAPEZY] No job ID received from response`);\n    console.error(`‚ùå [SCRAPEZY] Full response data keys:`, Object.keys(jobData));\n    throw new Error('No job ID received from Scrapezy');\n  }\n\n  console.log(`üöÄ [SCRAPEZY] Job created successfully with ID: ${jobId}`);\n\n  // Poll for results\n  let attempts = 0;\n  const maxAttempts = 15; // 2.5 minutes maximum\n  const POLL_INTERVAL = 10000; // 10 seconds\n  let finalResult = null;\n\n  console.log(`üöÄ [SCRAPEZY] Starting polling for job ${jobId} (max ${maxAttempts} attempts, ${POLL_INTERVAL}ms interval)`);\n\n  while (attempts < maxAttempts) {\n    await new Promise(resolve => setTimeout(resolve, POLL_INTERVAL));\n    attempts++;\n    \n    console.log(`üöÄ [SCRAPEZY] Polling attempt ${attempts}/${maxAttempts} for job ${jobId}`);\n    \n    const resultResponse = await fetch(`${SCRAPEZY_BASE_URL}/${jobId}`, {\n      headers: {\n        \"x-api-key\": SCRAPEZY_API_KEY,\n        \"Content-Type\": \"application/json\"\n      },\n      signal: AbortSignal.timeout(30000)\n    });\n\n    console.log(`üöÄ [SCRAPEZY] Polling response status: ${resultResponse.status} ${resultResponse.statusText}`);\n\n    if (!resultResponse.ok) {\n      const responseText = await resultResponse.text();\n      console.error(`‚ùå [SCRAPEZY] Polling failed. Response body: ${responseText}`);\n      throw new Error(`Scrapezy polling error: ${resultResponse.status} ${resultResponse.statusText}`);\n    }\n\n    const resultData = await resultResponse.json();\n    console.log(`üöÄ [SCRAPEZY] Polling response data:`, JSON.stringify(resultData, null, 2));\n    \n    if (resultData.status === 'completed') {\n      console.log(`‚úÖ [SCRAPEZY] Job ${jobId} completed successfully!`);\n      console.log(`‚úÖ [SCRAPEZY] Final result structure:`, typeof resultData.result, Array.isArray(resultData.result) ? `Array[${resultData.result.length}]` : `Object with keys: ${Object.keys(resultData.result || {})}`);\n      finalResult = resultData;\n      break;\n    } else if (resultData.status === 'failed') {\n      console.error(`‚ùå [SCRAPEZY] Job ${jobId} failed:`, resultData.error || 'Unknown error');\n      throw new Error(`Scrapezy job failed: ${resultData.error || 'Unknown error'}`);\n    } else {\n      console.log(`‚è≥ [SCRAPEZY] Job ${jobId} still processing, status: ${resultData.status}`);\n    }\n    // Continue polling if status is pending\n  }\n\n  if (!finalResult && attempts >= maxAttempts) {\n    console.error(`‚ùå [SCRAPEZY] Job ${jobId} timed out after ${maxAttempts} attempts (${(maxAttempts * POLL_INTERVAL) / 1000} seconds)`);\n    throw new Error('Scrapezy job timed out after 2.5 minutes');\n  }\n\n  console.log(`üéâ [SCRAPEZY] Returning final result for job ${jobId}`);\n  return finalResult;\n}\n\n// Parse Scrapezy results to extract property URLs\nfunction parseUrls(scrapezyResult: any): Array<{url: string, name: string, address: string}> {\n  console.log(`üîç [PARSE_URLS] Starting URL parsing...`);\n  console.log(`üîç [PARSE_URLS] Input data type: ${typeof scrapezyResult}`);\n  console.log(`üîç [PARSE_URLS] Input data keys:`, Object.keys(scrapezyResult || {}));\n  console.log(`üîç [PARSE_URLS] Full input structure:`, JSON.stringify(scrapezyResult, null, 2));\n  \n  let properties = [];\n  \n  try {\n    // Try to get the result from the response structure\n    const resultText = scrapezyResult.result || scrapezyResult.data || scrapezyResult;\n    console.log(`üîç [PARSE_URLS] Extracted result text type: ${typeof resultText}`);\n    console.log(`üîç [PARSE_URLS] Result text keys:`, typeof resultText === 'object' ? Object.keys(resultText) : 'N/A');\n    \n    if (typeof resultText === 'string') {\n      try {\n        const parsed = JSON.parse(resultText);\n        \n        // Check for listings, apartment_listings or apartments key (Scrapezy format)\n        const apartmentData = parsed.listings || parsed.apartment_listings || parsed.apartments;\n        if (apartmentData && Array.isArray(apartmentData)) {\n          properties = apartmentData.filter(item => \n            item && \n            typeof item === 'object' && \n            item.url && \n            typeof item.url === 'string' &&\n            item.url.includes('apartments.com') &&\n            item.url.startsWith('http')\n          );\n        }\n        // Also check if it's a direct array\n        else if (Array.isArray(parsed)) {\n          properties = parsed.filter(item => \n            item && \n            typeof item === 'object' && \n            item.url && \n            typeof item.url === 'string' &&\n            item.url.includes('apartments.com') &&\n            item.url.startsWith('http')\n          );\n        }\n      } catch (parseError) {\n        console.warn('Failed to parse JSON result, trying fallback parsing');\n        // Fallback: try to extract URLs from text\n        const lines = resultText.split('\\n');\n        for (const line of lines) {\n          if (line.includes('apartments.com') && line.startsWith('http')) {\n            properties.push({\n              url: line.trim(),\n              name: 'Property',\n              address: 'Address not available'\n            });\n          }\n        }\n      }\n    } else if (typeof resultText === 'object' && resultText !== null) {\n      // Handle object response (already parsed)\n      const apartmentDataObj = resultText.listings || resultText.apartment_listings || resultText.apartments;\n      if (apartmentDataObj && Array.isArray(apartmentDataObj)) {\n        properties = apartmentDataObj.filter(item => \n          item && \n          typeof item === 'object' && \n          item.url && \n          typeof item.url === 'string' &&\n          item.url.includes('apartments.com')\n        );\n      } else if (Array.isArray(resultText)) {\n        properties = resultText.filter(item => \n          item && \n          typeof item === 'object' && \n          item.url && \n          typeof item.url === 'string' &&\n          item.url.includes('apartments.com')\n        );\n      }\n    }\n  } catch (error) {\n    console.error('Error parsing Scrapezy result:', error);\n  }\n\n  // Ensure all properties have required fields and deduplicate\n  const validProperties = properties\n    .map(prop => ({\n      url: prop.url?.trim() || '',\n      name: prop.name?.trim() || 'Property Name Not Available',\n      address: prop.address?.trim() || 'Address Not Available'\n    }))\n    .filter(prop => prop.url)\n    .filter((prop, index, arr) => arr.findIndex(p => p.url === prop.url) === index);\n\n  return validProperties;\n}\n\n// Parse Scrapezy results to extract unit details\nfunction parseUnitData(scrapezyResult: any): Array<{\n  unitNumber?: string;\n  floorPlanName?: string;\n  unitType: string;\n  bedrooms?: number;\n  bathrooms?: number;\n  squareFootage?: number;\n  rent?: number;\n  availabilityDate?: string;\n}> {\n  let units = [];\n  \n  try {\n    // Try to get the result from the response structure\n    const resultText = scrapezyResult.result || scrapezyResult.data || scrapezyResult;\n    console.log(`Parsing unit data. Result type: ${typeof resultText}, structure keys:`, typeof resultText === 'object' ? Object.keys(resultText) : 'N/A');\n    \n    if (typeof resultText === 'string') {\n      try {\n        const parsed = JSON.parse(resultText);\n        \n        // Check for different possible keys for unit data\n        // Handle nested \"root\" structure that Scrapezy uses\n        const rootData = parsed.root || parsed;\n        const unitData = rootData.units || rootData.availableUnits || rootData.apartment_units || rootData.listings || parsed.units || parsed.apartment_units || parsed.listings || parsed;\n        if (Array.isArray(unitData)) {\n          units = unitData.filter(item => \n            item && \n            typeof item === 'object' && \n            (item.unitType || item.unit_type || item.type)\n          );\n        }\n      } catch (parseError) {\n        console.warn('Failed to parse JSON result for units, trying fallback parsing');\n        // Fallback: try to extract basic unit info from text\n        const lines = resultText.split('\\n');\n        for (const line of lines) {\n          if (line.includes('BR') || line.includes('Studio') || line.includes('bedroom')) {\n            units.push({\n              unitType: line.trim(),\n              bedrooms: extractBedroomCount(line),\n              bathrooms: extractBathroomCount(line),\n              rent: extractRentPrice(line)\n            });\n          }\n        }\n      }\n    } else if (typeof resultText === 'object' && resultText !== null) {\n      // Handle object response (already parsed)\n      // Handle nested \"root\" structure that Scrapezy uses\n      const rootData = resultText.root || resultText;\n      const unitDataObj = rootData.units || rootData.availableUnits || rootData.apartment_units || rootData.listings || resultText.units || resultText.apartment_units || resultText.listings;\n      if (Array.isArray(unitDataObj)) {\n        units = unitDataObj.filter(item => \n          item && \n          typeof item === 'object' && \n          (item.unitType || item.unit_type || item.type)\n        );\n      } else if (Array.isArray(resultText)) {\n        units = resultText.filter(item => \n          item && \n          typeof item === 'object' && \n          (item.unitType || item.unit_type || item.type)\n        );\n      }\n    }\n  } catch (error) {\n    console.error('Error parsing Scrapezy unit result:', error);\n  }\n\n  // Normalize and validate unit data\n  const validUnits = units\n    .map(unit => ({\n      unitNumber: unit.unitNumber || unit.unit_number || null,\n      floorPlanName: unit.floorPlanName || unit.floor_plan_name || unit.planName || unit.plan_name || null,\n      unitType: unit.unitType || unit.unit_type || unit.type || 'Unknown',\n      bedrooms: parseNumber(unit.bedrooms || unit.bedroom_count),\n      bathrooms: parseNumber(unit.bathrooms || unit.bathroom_count),\n      squareFootage: parseNumber(unit.squareFootage || unit.square_footage || unit.sqft),\n      rent: parseNumber(unit.rent || unit.price || unit.monthlyRent),\n      availabilityDate: unit.availabilityDate || unit.availability_date || unit.available || null\n    }))\n    .filter(unit => unit.unitType && unit.unitType !== 'Unknown');\n\n  return validUnits;\n}\n\n// Helper functions for unit data parsing\nfunction extractBedroomCount(text: string): number | undefined {\n  const match = text.match(/(\\d+)\\s*BR|(\\d+)\\s*bedroom/i);\n  return match ? parseInt(match[1] || match[2]) : undefined;\n}\n\nfunction extractBathroomCount(text: string): number | undefined {\n  const match = text.match(/(\\d+(?:\\.\\d+)?)\\s*BA|(\\d+(?:\\.\\d+)?)\\s*bathroom/i);\n  return match ? parseFloat(match[1] || match[2]) : undefined;\n}\n\nfunction extractRentPrice(text: string): number | undefined {\n  const match = text.match(/\\$(\\d{1,3}(?:,\\d{3})*)/);\n  return match ? parseInt(match[1].replace(/,/g, '')) : undefined;\n}\n\nfunction parseNumber(value: any): number | undefined {\n  if (typeof value === 'number') return value;\n  if (typeof value === 'string') {\n    const num = parseFloat(value.replace(/[,$]/g, ''));\n    return isNaN(num) ? undefined : num;\n  }\n  return undefined;\n}\n\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // Create property and get initial AI analysis\n  app.post(\"/api/properties\", async (req, res) => {\n    try {\n      const propertyData = insertPropertySchema.parse(req.body);\n      \n      // Create property\n      const property = await storage.createProperty(propertyData);\n      \n      // Initialize workflow state for the new property\n      console.log('[WORKFLOW] Initializing workflow state for property:', property.id);\n      await storage.saveWorkflowState({\n        propertyId: property.id,\n        selectedCompetitorIds: [],\n        currentStage: 'input'\n      });\n      \n      // Generate AI analysis using comprehensive public data prompt\n      const prompt = `Using only publicly available data, summarize the apartment property \"${property.propertyName}\" located at ${property.address}. Please include:\n\nBasic Property Info\n‚Ä¢ Property Name: ${property.propertyName}\n‚Ä¢ Number of units (estimated if not listed): ${property.totalUnits || 'please estimate'}\n‚Ä¢ Year built: ${property.builtYear || 'please research'}\n‚Ä¢ Property type (e.g., garden-style, mid-rise, high-rise): ${property.propertyType || 'please identify'}\n‚Ä¢ Approximate square footage (if available): ${property.squareFootage || 'please estimate if available'}\n\nListings & Rent Estimates\n‚Ä¢ Recent or active rental listings (unit mix, price range)\n‚Ä¢ Estimated rent per unit type (1BR, 2BR, etc.)\n‚Ä¢ Source of rent info (e.g., Zillow, Apartments.com, Rentometer)\n\nAmenities and Features\n‚Ä¢ Parking, laundry, gym, pool, pet policy, in-unit features\n‚Ä¢ Current known amenities: ${property.amenities?.join(\", \") || \"Not specified - please research\"}\n‚Ä¢ Highlight what makes it stand out (e.g., remodeled units, smart tech)\n\nNeighborhood Overview\n‚Ä¢ Walk Score, transit access, proximity to major employers or schools\n‚Ä¢ Crime rating (from public sources like AreaVibes or NeighborhoodScout)\n‚Ä¢ Notable nearby businesses or attractions\n\nVisuals\n‚Ä¢ Link to map/street view\n‚Ä¢ Exterior photos or listing images if available\n\nPlease provide your analysis in this exact JSON format:\n{\n  \"marketPosition\": \"Comprehensive description of the property's position in the local market based on publicly available data\",\n  \"competitiveAdvantages\": [\"specific advantage based on research\", \"another researched advantage\", \"third advantage from public data\"],\n  \"pricingInsights\": \"Detailed pricing analysis based on actual listings and rent data from public sources\",\n  \"recommendations\": [\"specific recommendation based on data\", \"another data-driven recommendation\", \"third actionable recommendation\"]\n}`;\n\n      const aiResponse = await openai.chat.completions.create({\n        model: \"gpt-4o\", // Using gpt-4o which is widely available\n        messages: [{ role: \"user\", content: prompt }],\n        response_format: { type: \"json_object\" }\n      });\n\n      const analysisData = JSON.parse(aiResponse.choices[0].message.content || \"{}\");\n      \n      // Save analysis\n      const analysis = await storage.createPropertyAnalysis({\n        propertyId: property.id,\n        marketPosition: analysisData.marketPosition,\n        competitiveAdvantages: analysisData.competitiveAdvantages,\n        pricingInsights: analysisData.pricingInsights,\n        recommendations: analysisData.recommendations\n      });\n\n      res.json({ property, analysis });\n    } catch (error) {\n      console.error(\"Error creating property:\", error);\n      res.status(500).json({ message: \"Failed to create property and analysis\" });\n    }\n  });\n\n  // Get the latest property (for returning users)\n  app.get(\"/api/properties/latest\", async (req, res) => {\n    try {\n      const properties = await storage.getAllProperties();\n      if (properties.length === 0) {\n        return res.status(404).json({ message: \"No properties found\" });\n      }\n      \n      // Get the most recently created property\n      const latestProperty = properties\n        .sort((a, b) => {\n          const aTime = a.createdAt ? new Date(a.createdAt).getTime() : 0;\n          const bTime = b.createdAt ? new Date(b.createdAt).getTime() : 0;\n          return bTime - aTime;\n        })[0];\n      \n      res.json(latestProperty);\n    } catch (error) {\n      console.error(\"Error fetching latest property:\", error);\n      res.status(500).json({ message: \"Failed to fetch latest property\" });\n    }\n  });\n\n  // Get property with analysis and linked scraped data\n  app.get(\"/api/properties/:id\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      console.log('[GET_PROPERTY] Fetching property:', propertyId);\n      \n      const property = await storage.getProperty(propertyId);\n      if (!property) {\n        console.log('[GET_PROPERTY] Property not found:', propertyId);\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n\n      const analysis = await storage.getPropertyAnalysis(property.id);\n      \n      // Check for linked scraped property data\n      let scrapedData = null;\n      let scrapingJobStatus = null;\n      \n      // Get scraping jobs for this property\n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId);\n      console.log('[GET_PROPERTY] Found', scrapingJobs.length, 'scraping jobs for property');\n      \n      if (scrapingJobs.length > 0) {\n        // Get the most recent completed job\n        const completedJob = scrapingJobs\n          .filter(job => job.status === \"completed\")\n          .sort((a, b) => {\n            const aTime = a.createdAt ? new Date(a.createdAt).getTime() : 0;\n            const bTime = b.createdAt ? new Date(b.createdAt).getTime() : 0;\n            return bTime - aTime;\n          })[0];\n        \n        if (completedJob) {\n          console.log('[GET_PROPERTY] Found completed scraping job:', completedJob.id);\n          scrapingJobStatus = completedJob.status;\n          \n          // Get scraped properties from this job\n          const scrapedProperties = await storage.getScrapedPropertiesByJob(completedJob.id);\n          \n          // Find the subject property (marked as isSubjectProperty)\n          const subjectProperty = scrapedProperties.find(p => p.isSubjectProperty === true);\n          \n          if (subjectProperty) {\n            console.log('[GET_PROPERTY] Found subject scraped property:', subjectProperty.name);\n            \n            // Get units for the subject property\n            const scrapedUnits = await storage.getScrapedUnitsByProperty(subjectProperty.id);\n            console.log('[GET_PROPERTY] Found', scrapedUnits.length, 'scraped units');\n            \n            scrapedData = {\n              scrapedPropertyId: subjectProperty.id,\n              scrapedPropertyName: subjectProperty.name,\n              scrapedPropertyAddress: subjectProperty.address,\n              scrapedPropertyUrl: subjectProperty.url,\n              matchScore: subjectProperty.matchScore,\n              scrapingJobId: completedJob.id,\n              unitsCount: scrapedUnits.length,\n              hasScrapedData: true\n            };\n          } else {\n            console.warn('[GET_PROPERTY] ‚ö†Ô∏è No subject property found in scraped data');\n            console.log('[GET_PROPERTY] Total scraped properties in job:', scrapedProperties.length);\n          }\n        } else {\n          // Check if there's a pending or failed job\n          const latestJob = scrapingJobs[0];\n          if (latestJob) {\n            scrapingJobStatus = latestJob.status;\n            console.log('[GET_PROPERTY] Latest scraping job status:', scrapingJobStatus);\n          }\n        }\n      } else {\n        console.log('[GET_PROPERTY] ‚ö†Ô∏è No scraping jobs found for property');\n      }\n      \n      // Return property with analysis and scraped data info\n      const response = {\n        property,\n        analysis,\n        scrapedData,\n        scrapingJobStatus,\n        dataSource: scrapedData ? 'scraped' : 'manual'\n      };\n      \n      console.log('[GET_PROPERTY] Returning property with data source:', response.dataSource);\n      res.json(response);\n    } catch (error) {\n      console.error(\"[GET_PROPERTY] Error fetching property:\", error);\n      res.status(500).json({ message: \"Failed to fetch property\" });\n    }\n  });\n\n  // Get all competitor properties (using scraped data only)\n  app.get(\"/api/competitors\", async (req, res) => {\n    try {\n      console.log('[GET_COMPETITORS] ===========================================');\n      console.log('[GET_COMPETITORS] Fetching scraped competitors...');\n      \n      // Get all scraped competitor properties using proper storage method\n      const allScrapedProperties = await storage.getAllScrapedCompetitors();\n      console.log('[GET_COMPETITORS] Total scraped properties found:', allScrapedProperties.length);\n      \n      // Filter out the subject property to get only competitors\n      const scrapedCompetitors = allScrapedProperties.filter(p => !p.isSubjectProperty);\n      console.log('[GET_COMPETITORS] Actual competitors (excluding subject):', scrapedCompetitors.length);\n      \n      // Check if there's a subject property marked\n      const subjectProperty = allScrapedProperties.find(p => p.isSubjectProperty === true);\n      if (subjectProperty) {\n        console.log('[GET_COMPETITORS] ‚úÖ Subject property found:', subjectProperty.name);\n        console.log('[GET_COMPETITORS] Subject property ID:', subjectProperty.id);\n        console.log('[GET_COMPETITORS] Subject property URL:', subjectProperty.url);\n      } else {\n        console.log('[GET_COMPETITORS] ‚ö†Ô∏è WARNING: No subject property marked with isSubjectProperty: true');\n        console.log('[GET_COMPETITORS] This may cause issues with vacancy analysis');\n      }\n      \n      // Log sample of competitor data for debugging\n      if (scrapedCompetitors.length > 0) {\n        console.log('[GET_COMPETITORS] Sample competitor data:');\n        scrapedCompetitors.slice(0, 3).forEach((comp, idx) => {\n          console.log(`[GET_COMPETITORS]   ${idx + 1}. ${comp.name}`);\n          console.log(`[GET_COMPETITORS]      Address: ${comp.address}`);\n          console.log(`[GET_COMPETITORS]      URL: ${comp.url}`);\n          console.log(`[GET_COMPETITORS]      Match Score: ${comp.matchScore}`);\n        });\n      }\n      \n      // Verify this is real scraped data by checking for apartments.com URLs\n      const realScrapedCount = scrapedCompetitors.filter(c => \n        c.url && c.url.includes('apartments.com')\n      ).length;\n      console.log('[GET_COMPETITORS] Properties with valid apartments.com URLs:', realScrapedCount);\n      \n      if (scrapedCompetitors.length === 0) {\n        console.log('[GET_COMPETITORS] ‚ö†Ô∏è No competitor properties found');\n        console.log('[GET_COMPETITORS] Possible reasons:');\n        console.log('[GET_COMPETITORS]   1. No scraping job has been run yet');\n        console.log('[GET_COMPETITORS]   2. Scraping job failed');\n        console.log('[GET_COMPETITORS]   3. All scraped properties are marked as subject');\n        \n        // Return empty array for consistency with frontend expectations\n        return res.json([]);\n      }\n      \n      // Return only authentic scraped competitor data\n      const competitors = scrapedCompetitors.map(scrapedProp => ({\n        id: scrapedProp.id,\n        name: scrapedProp.name,\n        address: scrapedProp.address,\n        url: scrapedProp.url,\n        distance: scrapedProp.distance,\n        matchScore: scrapedProp.matchScore,\n        createdAt: scrapedProp.createdAt,\n        isSubjectProperty: false  // Always false for competitors\n      }));\n\n      console.log(`[GET_COMPETITORS] ‚úÖ Returning ${competitors.length} scraped competitors`);\n      console.log('[GET_COMPETITORS] Data source: Real Scrapezy scraped data');\n      console.log('[GET_COMPETITORS] ===========================================');\n      \n      // Return array directly for backward compatibility, but log that it's scraped data\n      res.json(competitors);\n    } catch (error) {\n      console.error(\"[GET_COMPETITORS] ‚ùå Error fetching competitors:\", error);\n      res.status(500).json({ message: \"Failed to fetch competitor properties\" });\n    }\n  });\n\n  // Get selected competitor properties for comparison\n  app.post(\"/api/competitors/selected\", async (req, res) => {\n    try {\n      const { ids } = req.body;\n      if (!Array.isArray(ids)) {\n        return res.status(400).json({ message: \"IDs must be an array\" });\n      }\n\n      // Use scraped properties instead of legacy competitors\n      const scrapedProperties = await storage.getSelectedScrapedProperties(ids);\n      \n      // Return only authentic scraped data - no placeholder values\n      const competitors = scrapedProperties.map(scrapedProp => ({\n        id: scrapedProp.id,\n        name: scrapedProp.name,\n        address: scrapedProp.address,\n        url: scrapedProp.url,\n        distance: scrapedProp.distance,\n        matchScore: scrapedProp.matchScore,\n        createdAt: scrapedProp.createdAt,\n        isSubjectProperty: scrapedProp.isSubjectProperty\n      }));\n\n      res.json(competitors);\n    } catch (error) {\n      console.error(\"Error fetching selected competitors:\", error);\n      res.status(500).json({ message: \"Failed to fetch selected competitors\" });\n    }\n  });\n\n\n  // Get property units\n  app.get(\"/api/properties/:id/units\", async (req, res) => {\n    try {\n      const units = await storage.getPropertyUnits(req.params.id);\n      res.json(units);\n    } catch (error) {\n      console.error(\"Error fetching units:\", error);\n      res.status(500).json({ message: \"Failed to fetch property units\" });\n    }\n  });\n\n  // Create property units (from scraped data or generate basic ones)\n  app.post(\"/api/properties/:id/units\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const property = await storage.getProperty(propertyId);\n      \n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      console.log('[CREATE_UNITS] Creating units for property:', property.propertyName);\n      \n      // Try to get scraped units first\n      let scrapedUnits: ScrapedUnit[] = [];\n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId);\n      \n      if (scrapingJobs.length > 0) {\n        for (const job of scrapingJobs) {\n          const scrapedProperties = await storage.getScrapedPropertiesByJob(job.id);\n          const subject = scrapedProperties.find(p => p.isSubjectProperty === true);\n          if (subject) {\n            scrapedUnits = await storage.getScrapedUnitsByProperty(subject.id);\n            console.log('[CREATE_UNITS] Found', scrapedUnits.length, 'scraped units');\n            break;\n          }\n        }\n      }\n      \n      // Clear existing units\n      await storage.clearPropertyUnits(propertyId);\n      const units = [];\n      \n      if (scrapedUnits.length > 0) {\n        // Create from scraped data\n        console.log('[CREATE_UNITS] Creating units from scraped data');\n        for (const scrapedUnit of scrapedUnits) {\n          // Generate safe fallback ID if needed\n          const fallbackId = scrapedUnit.id ? scrapedUnit.id.slice(0, 6) : Math.random().toString(36).slice(2, 8);\n          \n          const unit = await storage.createPropertyUnit({\n            propertyId,\n            unitNumber: scrapedUnit.unitNumber || scrapedUnit.floorPlanName || `Unit-${fallbackId}`,\n            unitType: scrapedUnit.unitType || '1BR',  // Safe default that matches schema\n            currentRent: String(scrapedUnit.rent ?? \"1500\"),  // Ensure string type\n            status: scrapedUnit.status || \"occupied\"\n          });\n          units.push(unit);\n        }\n      } else {\n        // Generate basic units if no scraped data\n        const unitsToCreate = Math.min(property.totalUnits || 10, 10);\n        console.log('[CREATE_UNITS] No scraped units, generating', unitsToCreate, 'basic units');\n        \n        for (let i = 0; i < unitsToCreate; i++) {\n          const unitType = i % 3 === 0 ? 'Studio' : (i % 3 === 1 ? '1BR' : '2BR');\n          const baseRent = unitType === 'Studio' ? 1200 : (unitType === '1BR' ? 1500 : 1800);\n          \n          const unit = await storage.createPropertyUnit({\n            propertyId,\n            unitNumber: `Unit-${i + 1}`,\n            unitType,\n            currentRent: String(baseRent + Math.floor(Math.random() * 200)),\n            status: Math.random() > 0.15 ? \"occupied\" : \"available\"\n          });\n          units.push(unit);\n        }\n      }\n      \n      console.log('[CREATE_UNITS] Successfully created', units.length, 'units');\n      res.json(units);\n    } catch (error) {\n      console.error(\"[CREATE_UNITS] Error creating units:\", error);\n      res.status(500).json({ message: \"Failed to create units\" });\n    }\n  });\n\n  // Generate filtered analysis based on filter criteria\n  app.post(\"/api/filtered-analysis\", async (req, res) => {\n    try {\n      console.log('[FILTERED_ANALYSIS] ===========================================');\n      console.log('[FILTERED_ANALYSIS] Starting filtered analysis generation');\n      \n      const filterData = filterCriteriaSchema.parse(req.body);\n      console.log('[FILTERED_ANALYSIS] Filter criteria:', JSON.stringify(filterData, null, 2));\n      \n      // Get subject property for analysis context - CRITICAL for accurate analysis\n      const subjectProperty = await storage.getSubjectScrapedProperty();\n      \n      if (!subjectProperty) {\n        console.error('[FILTERED_ANALYSIS] ‚ùå No subject property found!');\n        console.log('[FILTERED_ANALYSIS] Cannot generate analysis without subject property');\n        return res.status(404).json({ \n          message: \"No subject property found. Please complete the scraping workflow first.\",\n          error: \"SUBJECT_PROPERTY_NOT_FOUND\",\n          suggestion: \"Run the property scraping workflow and ensure a subject property is identified\"\n        });\n      }\n      \n      console.log('[FILTERED_ANALYSIS] ‚úÖ Subject property found:', subjectProperty.name);\n      console.log('[FILTERED_ANALYSIS] Subject property ID:', subjectProperty.id);\n      \n      // Check if we have scraped units for the subject property\n      const subjectUnits = await storage.getScrapedUnitsByProperty(subjectProperty.id);\n      console.log('[FILTERED_ANALYSIS] Subject property units count:', subjectUnits.length);\n      \n      if (subjectUnits.length === 0) {\n        console.warn('[FILTERED_ANALYSIS] ‚ö†Ô∏è No units found for subject property');\n        console.log('[FILTERED_ANALYSIS] This may indicate unit scraping hasn\\'t been completed');\n      }\n      \n      // Get competitor properties to verify we have comparison data\n      const allScrapedProperties = await storage.getAllScrapedCompetitors();\n      const competitors = allScrapedProperties.filter(p => !p.isSubjectProperty);\n      console.log('[FILTERED_ANALYSIS] Competitor properties available:', competitors.length);\n      \n      // Generate filtered analysis using real scraped data\n      console.log('[FILTERED_ANALYSIS] Generating analysis from scraped data...');\n      const analysis = await storage.generateFilteredAnalysis(subjectProperty.id, filterData);\n      \n      // Log analysis summary\n      console.log('[FILTERED_ANALYSIS] Analysis generated successfully:');\n      console.log('[FILTERED_ANALYSIS]   - Subject units matching filters:', analysis.subjectUnits.length);\n      console.log('[FILTERED_ANALYSIS]   - Competitor units for comparison:', analysis.competitorUnits.length);\n      console.log('[FILTERED_ANALYSIS]   - Market position:', analysis.marketPosition);\n      console.log('[FILTERED_ANALYSIS]   - Percentile rank:', analysis.percentileRank);\n      console.log('[FILTERED_ANALYSIS]   - Data source: Real Scrapezy scraped data');\n      \n      // Generate AI insights if OpenAI is configured\n      if (process.env.OPENAI_API_KEY) {\n        try {\n          const filterDescription = [];\n          if (filterData.bedroomTypes.length > 0) {\n            filterDescription.push(`${filterData.bedroomTypes.join(\", \")} units`);\n          }\n          filterDescription.push(`$${filterData.priceRange.min}-$${filterData.priceRange.max} price range`);\n          filterDescription.push(`${filterData.squareFootageRange.min}-${filterData.squareFootageRange.max} sq ft`);\n          \n          const prompt = `Analyze the competitive position for a property with the following market data:\n          \nProperty Analysis:\n- Market Position: ${analysis.marketPosition} (${analysis.percentileRank}th percentile)\n- Subject Units: ${analysis.subjectUnits.length} units matching filters\n- Competitor Units: ${analysis.competitorUnits.length} units for comparison\n- Subject Avg Rent: $${analysis.subjectAvgRent}\n- Competitor Avg Rent: $${analysis.competitorAvgRent}\n- Pricing Power Score: ${analysis.pricingPowerScore}/100\n\nCompetitive Edges:\n- Pricing: ${analysis.competitiveEdges.pricing.label} (${analysis.competitiveEdges.pricing.status})\n- Size: ${analysis.competitiveEdges.size.label} (${analysis.competitiveEdges.size.status})\n- Availability: ${analysis.competitiveEdges.availability.label} (${analysis.competitiveEdges.availability.status})\n- Amenities: ${analysis.competitiveEdges.amenities.label} (${analysis.competitiveEdges.amenities.status})\n\nFilter Criteria Applied: ${filterDescription.join(\", \")}\n\nBased on this data, provide exactly 3 specific, actionable insights that would help a property manager optimize their competitive position. Each insight should be concise (under 100 characters) and directly actionable. Format as a JSON array of strings.`;\n          \n          const completion = await openai.chat.completions.create({\n            model: \"gpt-3.5-turbo\",\n            messages: [\n              {\n                role: \"system\",\n                content: \"You are a real estate market analyst providing specific, actionable insights for property managers.\"\n              },\n              {\n                role: \"user\",\n                content: prompt\n              }\n            ],\n            temperature: 0.7,\n            max_tokens: 300\n          });\n          \n          const aiResponse = completion.choices[0]?.message?.content || \"[]\";\n          try {\n            const insights = JSON.parse(aiResponse);\n            if (Array.isArray(insights) && insights.length > 0) {\n              analysis.aiInsights = insights.slice(0, 3);\n            }\n          } catch (parseError) {\n            console.warn(\"Failed to parse AI insights:\", parseError);\n            // Keep the placeholder insights if AI fails\n          }\n        } catch (aiError) {\n          console.warn(\"AI insights generation failed:\", aiError);\n          // Keep the placeholder insights if AI fails\n        }\n      }\n      \n      console.log('[FILTERED_ANALYSIS] ===========================================');\n      res.json(analysis);\n    } catch (error) {\n      console.error(\"[FILTERED_ANALYSIS] ‚ùå Error generating filtered analysis:\", error);\n      res.status(500).json({ message: \"Failed to generate filtered analysis\" });\n    }\n  });\n\n  // Generate optimization report\n  app.post(\"/api/properties/:id/optimize\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const { goal, targetOccupancy, riskTolerance } = req.body;\n      \n      console.log(`[OPTIMIZE] Starting optimization for property ${propertyId}`);\n      console.log(`[OPTIMIZE] Parameters - Goal: ${goal}, Target Occupancy: ${targetOccupancy}%, Risk: ${riskTolerance}`);\n\n      const property = await storage.getProperty(propertyId);\n      \n      if (!property) {\n        console.error(`[OPTIMIZE] Property ${propertyId} not found`);\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      // Get the subject property's scraped units for comprehensive optimization\n      let subjectProperty = null;\n      let scrapedUnits: ScrapedUnit[] = [];\n      \n      // Find the subject scraped property\n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId);\n      console.log(`[OPTIMIZE] Found ${scrapingJobs.length} scraping jobs for property`);\n      \n      if (scrapingJobs.length > 0) {\n        for (const job of scrapingJobs) {\n          const scrapedProperties = await storage.getScrapedPropertiesByJob(job.id);\n          console.log(`[OPTIMIZE] Job ${job.id} has ${scrapedProperties.length} scraped properties`);\n          \n          const subject = scrapedProperties.find(p => p.isSubjectProperty === true);\n          if (subject) {\n            subjectProperty = subject;\n            console.log(`[OPTIMIZE] Found subject property: ${subject.name}`);\n            // Get all scraped units for this property\n            scrapedUnits = await storage.getScrapedUnitsByProperty(subject.id);\n            console.log(`[OPTIMIZE] Found ${scrapedUnits.length} scraped units for subject property`);\n            break;\n          }\n        }\n      }\n      \n      if (!subjectProperty) {\n        console.log(`[OPTIMIZE] No subject property found for property ${propertyId}`);\n      }\n      \n      // Always sync from scraped units when available\n      let units = [];\n      \n      // If we have scraped units, always sync them (not just when units.length === 0)\n      if (scrapedUnits.length > 0) {\n        console.log(`[OPTIMIZE] Syncing ${scrapedUnits.length} scraped units for optimization`);\n        // Clear existing PropertyUnits\n        await storage.clearPropertyUnits(propertyId);\n        // Create new PropertyUnits from ALL scraped units\n        units = [];\n        for (const scrapedUnit of scrapedUnits) {\n          const unit = await storage.createPropertyUnit({\n            propertyId,\n            unitNumber: scrapedUnit.unitNumber || scrapedUnit.floorPlanName || `Unit-${scrapedUnit.id.substring(0, 6)}`,\n            unitType: scrapedUnit.unitType,\n            currentRent: scrapedUnit.rent || \"0\",\n            status: scrapedUnit.status || \"occupied\"\n          });\n          units.push(unit);\n        }\n        console.log(`[OPTIMIZE] Created ${units.length} property units from scraped data`);\n      } else {\n        // Fall back to existing PropertyUnits only if no scraped data\n        console.log(`[OPTIMIZE] No scraped units found, checking for existing PropertyUnits`);\n        units = await storage.getPropertyUnits(propertyId);\n        console.log(`[OPTIMIZE] Found ${units.length} existing property units`);\n        \n        // If still no units, try to create some basic ones based on property totalUnits\n        if (units.length === 0 && property.totalUnits && property.totalUnits > 0) {\n          console.log(`[OPTIMIZE] No units found, creating ${Math.min(property.totalUnits, 10)} basic units`);\n          for (let i = 0; i < Math.min(property.totalUnits, 10); i++) {\n            const unit = await storage.createPropertyUnit({\n              propertyId,\n              unitNumber: `Unit-${i + 1}`,\n              unitType: i % 3 === 0 ? 'Studio' : (i % 3 === 1 ? '1BR' : '2BR'),\n              currentRent: \"1500\",\n              status: \"occupied\"\n            });\n            units.push(unit);\n          }\n        }\n      }\n      \n      if (units.length === 0) {\n        console.error(`[OPTIMIZE] No units available for optimization`);\n        return res.status(404).json({ \n          message: \"No units found for optimization. Please ensure property data has been scraped first.\" \n        });\n      }\n      \n      console.log(`[OPTIMIZE] Proceeding with ${units.length} units for optimization`)\n\n      // Convert parameters to readable format for AI\n      const goalDisplayMap: Record<string, string> = {\n        'maximize-revenue': 'Maximize Revenue',\n        'maximize-occupancy': 'Maximize Occupancy', \n        'balanced': 'Balanced Approach',\n        'custom': 'Custom Strategy'\n      };\n      \n      const riskDisplayMap: Record<number, string> = {\n        1: 'Low (Conservative)',\n        2: 'Medium (Moderate)', \n        3: 'High (Aggressive)'\n      };\n\n      // Generate AI-powered optimization recommendations\n      const prompt = `As a real estate pricing optimization expert, analyze the following property and provide pricing recommendations:\n\n      Property Details:\n      - Address: ${property.address}\n      - Property Type: ${property.propertyType}\n      - Total Units: ${property.totalUnits}\n      - Built Year: ${property.builtYear}\n\n      Optimization Parameters:\n      - Goal: ${goalDisplayMap[goal] || goal}\n      - Target Occupancy: ${targetOccupancy}%\n      - Risk Tolerance: ${riskDisplayMap[riskTolerance] || 'Medium'}\n      \n      Current Unit Portfolio (${units.length} units):\n      ${units.slice(0, 100).map(unit => `${unit.unitNumber}: ${unit.unitType} - Current Rent: $${unit.currentRent} - Status: ${unit.status}`).join('\\n')}\n      ${units.length > 100 ? `... and ${units.length - 100} more units` : ''}\n      \n      Market Context:\n      - Consider current market conditions for similar properties\n      - Factor in seasonal trends and local market dynamics\n      - Account for unit turnover costs and vacancy risks\n      - Balance revenue optimization with occupancy targets\n      \n      Please provide optimization recommendations for ALL ${units.length} units in this exact JSON format:\n      {\n        \"unitRecommendations\": [\n          {\n            \"unitNumber\": \"string\",\n            \"currentRent\": number,\n            \"recommendedRent\": number,\n            \"marketAverage\": number,\n            \"change\": number,\n            \"annualImpact\": number,\n            \"confidenceLevel\": \"High|Medium|Low\",\n            \"reasoning\": \"Brief explanation for the recommendation\"\n          }\n        ],\n        \"totalIncrease\": number,\n        \"affectedUnits\": number,\n        \"avgIncrease\": number,\n        \"riskLevel\": \"Low|Medium|High\",\n        \"marketInsights\": {\n          \"occupancyImpact\": \"Expected impact on occupancy rate\",\n          \"competitivePosition\": \"How this positions the property vs competitors\", \n          \"timeToLease\": \"Average days to lease at new rates\"\n        }\n      }\n      \n      Important: Generate recommendations for ALL ${units.length} units based on the optimization goal and parameters.`;\n\n      console.log(`[OPTIMIZE] Sending request to OpenAI for ${units.length} units`);\n      \n      const aiResponse = await openai.chat.completions.create({\n        model: \"gpt-4o\", // Using gpt-4o which is widely available\n        messages: [{ role: \"user\", content: prompt }],\n        response_format: { type: \"json_object\" }\n      });\n\n      const optimizationData = JSON.parse(aiResponse.choices[0].message.content || \"{}\");\n      \n      console.log(`[OPTIMIZE] AI generated recommendations for ${optimizationData.unitRecommendations?.length || 0} units`);\n      console.log(`[OPTIMIZE] Total increase: $${optimizationData.totalIncrease}, Affected units: ${optimizationData.affectedUnits}`);\n      \n      // Update units with recommendations\n      const updatedUnits = [];\n      for (const recommendation of optimizationData.unitRecommendations) {\n        const unit = units.find(u => u.unitNumber === recommendation.unitNumber);\n        if (unit) {\n          const updatedUnit = await storage.updatePropertyUnit(unit.id, {\n            recommendedRent: recommendation.recommendedRent.toString()\n          });\n          updatedUnits.push({\n            ...updatedUnit,\n            confidenceLevel: recommendation.confidenceLevel,\n            reasoning: recommendation.reasoning\n          });\n        }\n      }\n      \n      // Ensure all units are included even if not in recommendations\n      for (const unit of units) {\n        if (!updatedUnits.find(u => u.id === unit.id)) {\n          updatedUnits.push({\n            ...unit,\n            recommendedRent: unit.currentRent, // Default to current if no recommendation\n            confidenceLevel: \"Low\",\n            reasoning: \"No optimization recommended - maintain current pricing\"\n          });\n        }\n      }\n\n      // Create optimization report\n      const report = await storage.createOptimizationReport({\n        propertyId,\n        goal: goalDisplayMap[goal] || goal,\n        riskTolerance: riskDisplayMap[riskTolerance] || 'Medium',\n        timeline: `Target Occupancy: ${targetOccupancy}%`,\n        totalIncrease: optimizationData.totalIncrease.toString(),\n        affectedUnits: optimizationData.affectedUnits,\n        avgIncrease: optimizationData.avgIncrease.toString(),\n        riskLevel: optimizationData.riskLevel\n      });\n\n      console.log(`[OPTIMIZE] Successfully generated optimization report with ${updatedUnits.length} units`);\n      res.json({ report, units: updatedUnits });\n    } catch (error) {\n      console.error(\"[OPTIMIZE] Error generating optimization:\", error);\n      // More detailed error response\n      if (error instanceof Error) {\n        console.error(`[OPTIMIZE] Error details: ${error.message}`);\n        console.error(`[OPTIMIZE] Stack trace: ${error.stack}`);\n        res.status(500).json({ \n          message: \"Failed to generate optimization report\",\n          error: error.message \n        });\n      } else {\n        res.status(500).json({ message: \"Failed to generate optimization report\" });\n      }\n    }\n  });\n\n  // Get optimization report\n  app.get(\"/api/properties/:id/optimization\", async (req, res) => {\n    try {\n      const report = await storage.getOptimizationReport(req.params.id);\n      const units = await storage.getPropertyUnits(req.params.id);\n      \n      if (!report) {\n        return res.status(404).json({ message: \"Optimization report not found\" });\n      }\n\n      res.json({ report, units });\n    } catch (error) {\n      console.error(\"Error fetching optimization report:\", error);\n      res.status(500).json({ message: \"Failed to fetch optimization report\" });\n    }\n  });\n\n  // Apply pricing changes\n  app.post(\"/api/properties/:id/apply-pricing\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const { unitPrices } = req.body; // { unitId: newPrice }\n      \n      if (!unitPrices || typeof unitPrices !== 'object') {\n        return res.status(400).json({ message: \"unitPrices must be an object mapping unit IDs to prices\" });\n      }\n\n      const updatedUnits = [];\n      let totalIncrease = 0;\n      let affectedUnits = 0;\n\n      for (const [unitId, newPrice] of Object.entries(unitPrices)) {\n        try {\n          const unit = await storage.updatePropertyUnit(unitId, {\n            recommendedRent: String(newPrice)\n          });\n          \n          if (unit) {\n            updatedUnits.push(unit);\n            const currentRent = parseFloat(unit.currentRent);\n            const appliedRent = parseFloat(String(newPrice));\n            \n            if (appliedRent !== currentRent) {\n              affectedUnits++;\n              totalIncrease += (appliedRent - currentRent) * 12; // Annual impact\n            }\n          }\n        } catch (unitError) {\n          console.error(`Failed to update unit ${unitId}:`, unitError);\n        }\n      }\n\n      res.json({\n        message: \"Pricing changes applied successfully\",\n        updatedUnits: updatedUnits.length,\n        affectedUnits,\n        totalAnnualImpact: totalIncrease\n      });\n    } catch (error) {\n      console.error(\"Error applying pricing changes:\", error);\n      res.status(500).json({ message: \"Failed to apply pricing changes\" });\n    }\n  });\n\n  // Scrape unit-level data for selected competitor properties (automatically includes subject property)\n  app.post(\"/api/competitors/scrape-units\", async (req, res) => {\n    try {\n      const { competitorIds } = req.body;\n      \n      if (!Array.isArray(competitorIds) || competitorIds.length === 0) {\n        return res.status(400).json({ message: \"competitorIds must be a non-empty array\" });\n      }\n\n      // Get selected competitor properties\n      const selectedCompetitors = await storage.getSelectedScrapedProperties(competitorIds);\n      \n      if (selectedCompetitors.length === 0) {\n        return res.status(404).json({ message: \"No competitor properties found\" });\n      }\n\n      // Get the subject property and prepend it to the list if it exists\n      const subjectProperty = await storage.getSubjectScrapedProperty();\n      console.log(`DEBUG: getSubjectScrapedProperty returned:`, subjectProperty);\n      \n      const propertiesToProcess = [];\n      \n      if (subjectProperty) {\n        propertiesToProcess.push(subjectProperty);\n        console.log(`Including subject property: ${subjectProperty.name} in unit scraping batch`);\n      } else {\n        console.log('No subject property found with isSubjectProperty === true');\n      }\n      \n      // Add all selected competitors\n      propertiesToProcess.push(...selectedCompetitors);\n      \n      console.log(`DEBUG: Total properties to process: ${propertiesToProcess.length} (${subjectProperty ? 'with' : 'without'} subject property)`);\n\n      const results = [];\n      \n      // Process each property (subject + competitors)\n      for (const property of propertiesToProcess) {\n        try {\n          console.log(`Starting unit scraping for property: ${property.name} at ${property.url}`);\n          \n          // Get the original property ID for subject property\n          let jobPropertyId = \"temp-\" + property.id;\n          if (property.isSubjectProperty) {\n            const originalPropertyId = await storage.getOriginalPropertyIdFromScraped(property.id);\n            if (originalPropertyId) {\n              jobPropertyId = originalPropertyId;\n              console.log(`Using original property ID ${originalPropertyId} for subject property ${property.name}`);\n            } else {\n              console.warn(`Could not find original property ID for subject property ${property.name}, using scraped ID`);\n              jobPropertyId = property.id;\n            }\n          }\n          \n          // Create scraping job for unit details\n          const scrapingJob = await storage.createScrapingJob({\n            propertyId: jobPropertyId,\n            stage: \"unit_details\",\n            cityUrl: property.url,\n            status: \"processing\"\n          });\n\n          // Call Scrapezy API for unit-level data\n          const unitPrompt = `Extract detailed unit information from this apartments.com property page. For each available apartment unit, extract: 1) Unit number (actual unit identifier like \"1-332\", \"A101\", etc - if available), 2) Floor plan name (marketing name like \"New York\", \"Portland\", \"Green Lodge - One Bedroom\", etc - if available), 3) Unit type (e.g., \"Studio\", \"1BR/1BA\", \"2BR/2BA\"), 4) Number of bedrooms (as integer), 5) Number of bathrooms (as decimal like 1.0, 1.5, 2.0), 6) Square footage (as integer, if available), 7) Monthly rent price (as number, extract only the numerical value), 8) Availability date or status. IMPORTANT: Some properties show unit numbers while others show floor plan names instead. Capture whichever identifier is present. Return as JSON array with objects containing \"unitNumber\", \"floorPlanName\", \"unitType\", \"bedrooms\", \"bathrooms\", \"squareFootage\", \"rent\", \"availabilityDate\" fields.`;\n\n          const scrapezyResult = await callScrapezyScraping(property.url, unitPrompt);\n          \n          // Parse the scraped unit data\n          const unitData = parseUnitData(scrapezyResult);\n          \n          console.log(`Found ${unitData.length} units for property: ${property.name}`);\n          \n          // Save scraped units to storage\n          const savedUnits = [];\n          for (const unit of unitData) {\n            try {\n              const savedUnit = await storage.createScrapedUnit({\n                propertyId: property.id,\n                unitNumber: unit.unitNumber,\n                floorPlanName: unit.floorPlanName,\n                unitType: unit.unitType,\n                bedrooms: unit.bedrooms,\n                bathrooms: unit.bathrooms?.toString() || null,\n                squareFootage: unit.squareFootage,\n                rent: unit.rent?.toString() || null,\n                availabilityDate: unit.availabilityDate,\n                status: unit.availabilityDate && unit.availabilityDate.toLowerCase().includes('available') ? 'available' : 'occupied'\n              });\n              savedUnits.push(savedUnit);\n            } catch (unitError) {\n              console.warn(`Failed to save unit for ${property.name}:`, unitError);\n            }\n          }\n\n          // Update scraping job status\n          await storage.updateScrapingJob(scrapingJob.id, {\n            status: \"completed\",\n            results: unitData,\n            completedAt: new Date()\n          });\n\n          results.push({\n            propertyId: property.id,\n            propertyName: property.name,\n            propertyAddress: property.address,\n            isSubjectProperty: property.isSubjectProperty || false,\n            scrapingJobId: scrapingJob.id,\n            unitsFound: savedUnits.length,\n            units: savedUnits\n          });\n\n        } catch (propertyError) {\n          console.error(`Error scraping units for ${property.name}:`, propertyError);\n          \n          const errorMessage = propertyError instanceof Error ? propertyError.message : \"Failed to scrape unit data\";\n          \n          results.push({\n            propertyId: property.id,\n            propertyName: property.name,\n            propertyAddress: property.address,\n            isSubjectProperty: property.isSubjectProperty || false,\n            error: errorMessage,\n            unitsFound: 0,\n            units: []\n          });\n        }\n      }\n\n      res.json({\n        message: \"Unit scraping completed\",\n        processedProperties: results.length,\n        totalUnitsFound: results.reduce((sum, result) => sum + result.unitsFound, 0),\n        results\n      });\n\n    } catch (error) {\n      console.error(\"Error in unit scraping workflow:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Unknown error occurred\";\n      res.status(500).json({ message: \"Failed to scrape unit data\", error: errorMessage });\n    }\n  });\n\n  // Comprehensive vacancy summary API endpoint\n  app.get(\"/api/vacancy/summary\", async (req, res) => {\n    try {\n      console.log('[VACANCY_SUMMARY] ===========================================');\n      console.log('[VACANCY_SUMMARY] Starting vacancy summary generation');\n      \n      const { propertyId, competitorIds } = req.query;\n      console.log('[VACANCY_SUMMARY] Property ID:', propertyId);\n      console.log('[VACANCY_SUMMARY] Competitor IDs:', competitorIds);\n      \n      // Validate parameters\n      if (!propertyId) {\n        console.error('[VACANCY_SUMMARY] ‚ùå No propertyId provided');\n        return res.status(400).json({ message: \"propertyId is required\" });\n      }\n      \n      const competitorIdsArray = Array.isArray(competitorIds) ? competitorIds : \n                                 competitorIds ? [competitorIds] : [];\n\n      if (competitorIdsArray.length === 0) {\n        console.error('[VACANCY_SUMMARY] ‚ùå No competitor IDs provided');\n        return res.status(400).json({ message: \"At least one competitorId is required\" });\n      }\n\n      console.log(`[VACANCY_SUMMARY] Processing ${competitorIdsArray.length} competitors`);\n\n      // Get subject property - need to find the scraped property marked as isSubjectProperty\n      let subjectProperty = null;\n      \n      // First try to find by scraping job associated with the original propertyId\n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId as string);\n      if (scrapingJobs.length > 0) {\n        // Get all scraped properties from these jobs\n        for (const job of scrapingJobs) {\n          const scrapedProperties = await storage.getScrapedPropertiesByJob(job.id);\n          const subject = scrapedProperties.find(p => p.isSubjectProperty === true);\n          if (subject) {\n            subjectProperty = subject;\n            break;\n          }\n        }\n      }\n      \n      // If not found, try the direct method as fallback\n      if (!subjectProperty) {\n        subjectProperty = await storage.getSubjectScrapedProperty();\n      }\n      \n      if (!subjectProperty) {\n        return res.status(404).json({ \n          message: \"Subject property not found. Please ensure the property has been scraped first.\",\n          hint: \"Run the scraping workflow for the property before requesting vacancy summary\"\n        });\n      }\n\n      const competitorProperties = await storage.getSelectedScrapedProperties(competitorIdsArray as string[]);\n      if (competitorProperties.length === 0) {\n        return res.status(404).json({ message: \"No competitor properties found\" });\n      }\n\n      // Helper function to normalize unit types\n      const normalizeUnitType = (unitType: string): string => {\n        if (!unitType) return 'Studio';\n        const type = unitType.toLowerCase().trim();\n        \n        if (type.includes('studio') || type.includes('0br') || type === '0') {\n          return 'Studio';\n        } else if (type.includes('1br') || type.includes('1 br') || type === '1') {\n          return '1BR';\n        } else if (type.includes('2br') || type.includes('2 br') || type === '2') {\n          return '2BR';\n        } else if (type.includes('3br') || type.includes('3 br') || type === '3' || \n                   type.includes('4br') || type.includes('4 br') || type === '4' ||\n                   type.includes('5br') || type.includes('5 br') || type === '5') {\n          return '3BR+';\n        } else {\n          // Try to extract bedroom count from the string\n          const match = type.match(/(\\d+)/);\n          if (match) {\n            const bedrooms = parseInt(match[1]);\n            if (bedrooms === 0) return 'Studio';\n            if (bedrooms === 1) return '1BR';\n            if (bedrooms === 2) return '2BR';\n            if (bedrooms >= 3) return '3BR+';\n          }\n          return 'Studio'; // Default fallback\n        }\n      };\n\n      // Helper function to calculate vacancy data for a property\n      const calculateVacancyData = async (property: any) => {\n        const units = await storage.getScrapedUnitsByProperty(property.id);\n        \n        // Group units by type\n        const unitTypeGroups: { [key: string]: typeof units } = {\n          'Studio': [],\n          '1BR': [],\n          '2BR': [],\n          '3BR+': []\n        };\n\n        units.forEach(unit => {\n          const normalizedType = normalizeUnitType(unit.unitType);\n          unitTypeGroups[normalizedType].push(unit);\n        });\n\n        // Calculate stats for each unit type\n        const unitTypes = Object.keys(unitTypeGroups).map(type => {\n          const typeUnits = unitTypeGroups[type];\n          const totalUnits = typeUnits.length;\n          const availableUnits = typeUnits.filter(u => \n            u.status === 'available' || \n            (u.availabilityDate && u.availabilityDate.toLowerCase().includes('available'))\n          ).length;\n          \n          const rentPrices = typeUnits\n            .map(u => u.rent ? parseFloat(u.rent.toString()) : null)\n            .filter(rent => rent !== null && rent > 0) as number[];\n          \n          const sqftValues = typeUnits\n            .map(u => u.squareFootage)\n            .filter(sqft => sqft !== null && sqft > 0) as number[];\n\n          return {\n            type,\n            totalUnits,\n            availableUnits,\n            vacancyRate: totalUnits > 0 ? (availableUnits / totalUnits) * 100 : 0,\n            avgRent: rentPrices.length > 0 ? rentPrices.reduce((sum, rent) => sum + rent, 0) / rentPrices.length : 0,\n            avgSqFt: sqftValues.length > 0 ? sqftValues.reduce((sum, sqft) => sum + sqft, 0) / sqftValues.length : 0,\n            rentRange: rentPrices.length > 0 ? {\n              min: Math.min(...rentPrices),\n              max: Math.max(...rentPrices)\n            } : { min: 0, max: 0 }\n          };\n        }).filter(typeData => typeData.totalUnits > 0); // Only include unit types that exist\n\n        // Calculate overall vacancy rate\n        const totalUnits = units.length;\n        const totalAvailable = units.filter(u => \n          u.status === 'available' || \n          (u.availabilityDate && u.availabilityDate.toLowerCase().includes('available'))\n        ).length;\n        const overallVacancyRate = totalUnits > 0 ? (totalAvailable / totalUnits) * 100 : 0;\n\n        return {\n          id: property.id,\n          name: property.name,\n          vacancyRate: parseFloat(overallVacancyRate.toFixed(1)),\n          unitTypes\n        };\n      }\n\n      // Helper function to get individual units for a property\n      const getPropertyUnits = async (property: any) => {\n        const units = await storage.getScrapedUnitsByProperty(property.id);\n        return units.map(unit => ({\n          unitNumber: unit.unitNumber || 'N/A',\n          unitType: unit.unitType,\n          bedrooms: unit.bedrooms || 0,\n          bathrooms: unit.bathrooms || '0',\n          squareFootage: unit.squareFootage || 0,\n          rent: unit.rent || '0',\n          availabilityDate: unit.availabilityDate || 'Contact for availability',\n          status: unit.status || 'unknown'\n        }));\n      };\n\n      // Calculate data for subject property with units\n      const subjectData = await calculateVacancyData(subjectProperty);\n      const subjectUnits = await getPropertyUnits(subjectProperty);\n\n      // Calculate data for competitors with units\n      const competitorData = await Promise.all(\n        competitorProperties.map(async comp => {\n          const vacancyData = await calculateVacancyData(comp);\n          const units = await getPropertyUnits(comp);\n          return {\n            ...vacancyData,\n            units\n          };\n        })\n      );\n\n      // Calculate market insights\n      const competitorVacancyRates = competitorData.map(c => c.vacancyRate);\n      const competitorAvgVacancy = competitorVacancyRates.length > 0 \n        ? competitorVacancyRates.reduce((sum, rate) => sum + rate, 0) / competitorVacancyRates.length\n        : 0;\n\n      const totalCompetitorVacancies = competitorData.reduce((sum, comp) => {\n        return sum + comp.unitTypes.reduce((typeSum, type) => typeSum + type.availableUnits, 0);\n      }, 0);\n\n      // Find strongest unit type (lowest vacancy rate)\n      const subjectUnitTypes = subjectData.unitTypes.filter(type => type.totalUnits > 0);\n      const strongestUnitType = subjectUnitTypes.length > 0 \n        ? subjectUnitTypes.reduce((strongest, current) => \n            current.vacancyRate < strongest.vacancyRate ? current : strongest\n          ).type\n        : 'N/A';\n\n      // Calculate subject vs market comparison\n      const vacancyDifference = subjectData.vacancyRate - competitorAvgVacancy;\n      const subjectVsMarket = Math.abs(vacancyDifference) < 0.1 \n        ? \"At market average\"\n        : vacancyDifference > 0 \n          ? `${Math.abs(vacancyDifference).toFixed(1)}% above market average`\n          : `${Math.abs(vacancyDifference).toFixed(1)}% below market average`;\n\n      const response = {\n        subjectProperty: {\n          ...subjectData,\n          units: subjectUnits\n        },\n        competitors: competitorData,\n        marketInsights: {\n          subjectVsMarket,\n          strongestUnitType,\n          totalVacancies: subjectData.unitTypes.reduce((sum, type) => sum + type.availableUnits, 0) + totalCompetitorVacancies,\n          competitorAvgVacancies: parseFloat(competitorAvgVacancy.toFixed(1))\n        }\n      };\n\n      console.log('[VACANCY_SUMMARY] ‚úÖ Vacancy summary completed successfully');\n      console.log('[VACANCY_SUMMARY] Subject property:', subjectData.name);\n      console.log('[VACANCY_SUMMARY] Vacancy rate:', subjectData.vacancyRate + '%');\n      console.log('[VACANCY_SUMMARY] Total units analyzed:', subjectUnits.length);\n      console.log('[VACANCY_SUMMARY] Data source: Real Scrapezy scraped data');\n      console.log('[VACANCY_SUMMARY] ===========================================');\n      res.json(response);\n\n    } catch (error) {\n      console.error(\"[VACANCY_SUMMARY] ‚ùå Error generating vacancy summary:\", error);\n      console.log('[VACANCY_SUMMARY] ===========================================');\n      res.status(500).json({ \n        message: \"Failed to generate vacancy summary\", \n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n\n  // Address normalization utilities for better property matching\n  function normalizeAddress(address: string): string {\n    if (!address) return '';\n    \n    return address\n      .toLowerCase()\n      .trim()\n      // Remove common punctuation\n      .replace(/[.,;#]/g, '')\n      // Normalize street abbreviations\n      .replace(/\\bstreet\\b/g, 'st')\n      .replace(/\\bavenue\\b/g, 'ave')\n      .replace(/\\bboulevard\\b/g, 'blvd')\n      .replace(/\\bdrive\\b/g, 'dr')\n      .replace(/\\broad\\b/g, 'rd')\n      .replace(/\\blane\\b/g, 'ln')\n      .replace(/\\bplaza\\b/g, 'plz')\n      .replace(/\\bcircle\\b/g, 'cir')\n      .replace(/\\bparkway\\b/g, 'pkwy')\n      .replace(/\\bcourt\\b/g, 'ct')\n      // Normalize directional abbreviations\n      .replace(/\\bnorth\\b/g, 'n')\n      .replace(/\\bsouth\\b/g, 's')\n      .replace(/\\beast\\b/g, 'e')\n      .replace(/\\bwest\\b/g, 'w')\n      .replace(/\\bnortheast\\b/g, 'ne')\n      .replace(/\\bnorthwest\\b/g, 'nw')\n      .replace(/\\bsoutheast\\b/g, 'se')\n      .replace(/\\bsouthwest\\b/g, 'sw')\n      // Remove extra whitespace\n      .replace(/\\s+/g, ' ')\n      .trim();\n  }\n\n  function extractStreetNumber(address: string): string {\n    const match = address.match(/^(\\d+)/);\n    return match ? match[1] : '';\n  }\n\n  function extractStreetName(address: string): string {\n    // Extract everything after the street number but before city/state\n    const normalized = normalizeAddress(address);\n    const parts = normalized.split(',');\n    if (parts.length === 0) return normalized;\n    \n    const streetPart = parts[0].trim();\n    // Remove the street number\n    return streetPart.replace(/^\\d+\\s*/, '').trim();\n  }\n\n  function normalizePropertyName(name: string): string {\n    if (!name) return '';\n    \n    return name\n      .toLowerCase()\n      .trim()\n      // Remove common property prefixes/suffixes\n      .replace(/^(the)\\s+/i, '')\n      .replace(/\\s+(apartments?|apt|residences?|homes?|towers?|place|commons?)$/i, '')\n      // Remove extra whitespace\n      .replace(/\\s+/g, ' ')\n      .trim();\n  }\n\n  // Calculate similarity score between two strings (0-100)\n  function calculateStringSimilarity(str1: string, str2: string): number {\n    if (!str1 || !str2) return 0;\n    if (str1 === str2) return 100;\n    \n    // Levenshtein distance implementation\n    const matrix = [];\n    const len1 = str1.length;\n    const len2 = str2.length;\n    \n    // Initialize matrix\n    for (let i = 0; i <= len1; i++) {\n      matrix[i] = [i];\n    }\n    for (let j = 0; j <= len2; j++) {\n      matrix[0][j] = j;\n    }\n    \n    // Fill matrix\n    for (let i = 1; i <= len1; i++) {\n      for (let j = 1; j <= len2; j++) {\n        if (str1[i - 1] === str2[j - 1]) {\n          matrix[i][j] = matrix[i - 1][j - 1];\n        } else {\n          matrix[i][j] = Math.min(\n            matrix[i - 1][j - 1] + 1, // substitution\n            matrix[i][j - 1] + 1,     // insertion\n            matrix[i - 1][j] + 1      // deletion\n          );\n        }\n      }\n    }\n    \n    const maxLen = Math.max(len1, len2);\n    const similarity = maxLen === 0 ? 100 : ((maxLen - matrix[len1][len2]) / maxLen) * 100;\n    return Math.round(similarity);\n  }\n\n  // Advanced property matching logic with improved flexibility\n  function calculatePropertyMatch(subjectProperty: any, scrapedProperty: any): { isMatch: boolean; score: number; reasons: string[]; matchDetails: any } {\n    console.log('[PROPERTY_MATCH] Starting match calculation');\n    console.log('[PROPERTY_MATCH] Subject Property:', { \n      name: subjectProperty.propertyName, \n      address: subjectProperty.address,\n      city: subjectProperty.city,\n      state: subjectProperty.state \n    });\n    console.log('[PROPERTY_MATCH] Scraped Property:', { \n      name: scrapedProperty.name, \n      address: scrapedProperty.address,\n      url: scrapedProperty.url \n    });\n    \n    const reasons: string[] = [];\n    let totalScore = 0;\n    let maxPossibleScore = 0;\n    const componentScores: any = {};\n    \n    // Extract and normalize subject property data\n    const subjectName = normalizePropertyName(subjectProperty.propertyName || '');\n    const subjectAddress = normalizeAddress(subjectProperty.address || '');\n    const subjectStreetNumber = extractStreetNumber(subjectProperty.address || '');\n    const subjectStreetName = extractStreetName(subjectProperty.address || '');\n    \n    // Extract and normalize scraped property data\n    const scrapedName = normalizePropertyName(scrapedProperty.name || '');\n    const scrapedAddress = normalizeAddress(scrapedProperty.address || '');\n    const scrapedStreetNumber = extractStreetNumber(scrapedProperty.address || '');\n    const scrapedStreetName = extractStreetName(scrapedProperty.address || '');\n    \n    console.log('[PROPERTY_MATCH] Normalized values:', {\n      subjectName, subjectAddress, subjectStreetNumber, subjectStreetName,\n      scrapedName, scrapedAddress, scrapedStreetNumber, scrapedStreetName\n    });\n    \n    // 1. Exact street number match (30 points) - very important for properties\n    maxPossibleScore += 30;\n    componentScores.streetNumber = 0;\n    if (subjectStreetNumber && scrapedStreetNumber) {\n      if (subjectStreetNumber === scrapedStreetNumber) {\n        componentScores.streetNumber = 30;\n        totalScore += 30;\n        reasons.push(`‚úÖ Exact street number match: ${subjectStreetNumber}`);\n      } else {\n        // Check for partial match (e.g., 222 vs 2221)\n        if (subjectStreetNumber.startsWith(scrapedStreetNumber) || scrapedStreetNumber.startsWith(subjectStreetNumber)) {\n          componentScores.streetNumber = 15;\n          totalScore += 15;\n          reasons.push(`‚ö†Ô∏è Partial street number match: ${subjectStreetNumber} vs ${scrapedStreetNumber}`);\n        } else {\n          reasons.push(`‚ùå Street number mismatch: ${subjectStreetNumber} vs ${scrapedStreetNumber}`);\n        }\n      }\n    } else if (!subjectStreetNumber || !scrapedStreetNumber) {\n      // One is missing - still give some points if other criteria match\n      componentScores.streetNumber = 10;\n      totalScore += 10;\n      reasons.push(`‚ö†Ô∏è Street number missing in one address`);\n    }\n    \n    // 2. Street name similarity (25 points)\n    maxPossibleScore += 25;\n    componentScores.streetName = 0;\n    if (subjectStreetName && scrapedStreetName) {\n      const streetSimilarity = calculateStringSimilarity(subjectStreetName, scrapedStreetName);\n      componentScores.streetNameSimilarity = streetSimilarity;\n      \n      if (streetSimilarity >= 80) {\n        const streetPoints = Math.round((streetSimilarity / 100) * 25);\n        componentScores.streetName = streetPoints;\n        totalScore += streetPoints;\n        reasons.push(`‚úÖ Street name similarity: ${streetSimilarity}% (${subjectStreetName} vs ${scrapedStreetName})`);\n      } else if (streetSimilarity >= 60) {\n        // More forgiving for partial matches\n        const streetPoints = Math.round((streetSimilarity / 100) * 20);\n        componentScores.streetName = streetPoints;\n        totalScore += streetPoints;\n        reasons.push(`‚ö†Ô∏è Partial street name match: ${streetSimilarity}% (${subjectStreetName} vs ${scrapedStreetName})`);\n      } else {\n        reasons.push(`‚ùå Low street name similarity: ${streetSimilarity}% (${subjectStreetName} vs ${scrapedStreetName})`);\n      }\n    }\n    \n    // 3. Property name similarity (20 points) - ENHANCED with flexible matching\n    maxPossibleScore += 20;\n    componentScores.propertyName = 0;\n    if (subjectName && scrapedName) {\n      const nameSimilarity = calculateStringSimilarity(subjectName, scrapedName);\n      componentScores.propertyNameSimilarity = nameSimilarity;\n      \n      // Check for containment first (more flexible)\n      const subjectWords = subjectName.toLowerCase().split(' ').filter(w => w.length > 2);\n      const scrapedWords = scrapedName.toLowerCase().split(' ').filter(w => w.length > 2);\n      const commonWords = subjectWords.filter(w => scrapedWords.includes(w));\n      const containmentScore = (commonWords.length / Math.min(subjectWords.length, scrapedWords.length)) * 100;\n      \n      if (nameSimilarity >= 70) {\n        // High match - likely same property\n        const namePoints = 20;\n        componentScores.propertyName = namePoints;\n        totalScore += namePoints;\n        reasons.push(`‚úÖ Strong property name match: ${nameSimilarity}% (${subjectName} vs ${scrapedName})`);\n      } else if (containmentScore >= 50 || subjectName.includes(scrapedName) || scrapedName.includes(subjectName)) {\n        // IMPROVED: Award points for partial containment\n        const namePoints = 15;\n        componentScores.propertyName = namePoints;\n        totalScore += namePoints;\n        reasons.push(`‚úÖ Property name contains key words: \"${subjectName}\" matches \"${scrapedName}\" (${commonWords.join(', ')})`);\n      } else if (nameSimilarity >= 50) {\n        const namePoints = Math.round((nameSimilarity / 100) * 20);\n        componentScores.propertyName = namePoints;\n        totalScore += namePoints;\n        reasons.push(`‚ö†Ô∏è Property name similarity: ${nameSimilarity}% (${subjectName} vs ${scrapedName})`);\n      } else {\n        // More forgiving for Atlas-type matches\n        const coreMatch = (subjectName.replace('the', '').trim() === scrapedName.replace('the', '').trim());\n        if (coreMatch) {\n          componentScores.propertyName = 12;\n          totalScore += 12;\n          reasons.push(`‚ö†Ô∏è Core name match after removing articles: \"${subjectName}\" and \"${scrapedName}\"`);\n        } else {\n          reasons.push(`‚ùå Low property name similarity: ${nameSimilarity}% (${subjectName} vs ${scrapedName})`);\n        }\n      }\n    }\n    \n    // 4. Full address similarity (15 points)\n    maxPossibleScore += 15;\n    const fullAddressSimilarity = calculateStringSimilarity(subjectAddress, scrapedAddress);\n    if (fullAddressSimilarity >= 70) {\n      const addressPoints = Math.round((fullAddressSimilarity / 100) * 15);\n      totalScore += addressPoints;\n      reasons.push(`Full address similarity: ${fullAddressSimilarity}%`);\n    }\n    \n    // 5. City/State context (10 points) - from subject property schema\n    maxPossibleScore += 10;\n    if (subjectProperty.city || subjectProperty.state) {\n      const subjectCity = normalizeAddress(subjectProperty.city || '');\n      const subjectState = normalizeAddress(subjectProperty.state || '');\n      \n      if (subjectCity && scrapedAddress.includes(subjectCity)) {\n        totalScore += 5;\n        reasons.push(`City match in scraped address: ${subjectCity}`);\n      }\n      if (subjectState && scrapedAddress.includes(subjectState)) {\n        totalScore += 5;\n        reasons.push(`State match in scraped address: ${subjectState}`);\n      }\n    }\n    \n    // Calculate final score percentage\n    const finalScore = maxPossibleScore > 0 ? Math.round((totalScore / maxPossibleScore) * 100) : 0;\n    \n    console.log('[PROPERTY_MATCH] Component scores:', componentScores);\n    console.log('[PROPERTY_MATCH] Total score:', totalScore, '/', maxPossibleScore);\n    console.log('[PROPERTY_MATCH] Final score:', finalScore, '%');\n    \n    // FURTHER LOWERED THRESHOLD for better detection:\n    // - 60%+ = Highly likely match\n    // - 50%+ = Likely match (for properties with similar names/addresses)\n    // - 40%+ = Possible match (requires manual review)\n    const isMatch = finalScore >= 50; // LOWERED to 50% for better flexibility\n    \n    console.log('[PROPERTY_MATCH] Is match?', isMatch);\n    console.log('[PROPERTY_MATCH] Reasons:', reasons);\n    \n    return {\n      isMatch,\n      score: finalScore,\n      reasons,\n      matchDetails: {\n        componentScores,\n        totalScore,\n        maxPossibleScore,\n        threshold: 50, // Updated threshold\n        subjectData: { name: subjectName, address: subjectAddress },\n        scrapedData: { name: scrapedName, address: scrapedAddress }\n      }\n    };\n  }\n\n  // Helper function to generate city URL from address\n  function generateCityUrl(address: string): string {\n    console.log('[GENERATE_CITY_URL] Input address:', address);\n    \n    const parts = address.split(',').map(p => p.trim());\n    console.log('[GENERATE_CITY_URL] Address parts:', parts);\n    \n    if (parts.length < 2) {\n      console.log('[GENERATE_CITY_URL] Not enough parts in address');\n      return '';\n    }\n    \n    // Expected formats:\n    // \"Street Address, City, State ZIP\" -> [\"Street Address\", \"City\", \"State ZIP\"]\n    // \"Street Address, City State ZIP\" -> [\"Street Address\", \"City State ZIP\"]\n    \n    if (parts.length >= 3) {\n      // Format: \"Street, City, State ZIP\" (most common)\n      const city = parts[1].toLowerCase().replace(/\\s+/g, '-');\n      const stateWithZip = parts[2];\n      \n      // Extract state and zip using regex for better reliability\n      const stateZipMatch = stateWithZip.match(/^([A-Z]{2})\\s+(\\d{5})/i);\n      \n      if (stateZipMatch) {\n        const state = stateZipMatch[1].toLowerCase();\n        const zip = stateZipMatch[2];\n        const url = `apartments.com/${city}-${state}-${zip}/`;\n        console.log('[GENERATE_CITY_URL] Generated URL with zipcode:', url);\n        return url;\n      } else {\n        // Fallback to splitting by space\n        const stateZipParts = stateWithZip.split(/\\s+/);\n        const state = stateZipParts[0].toLowerCase();\n        const zip = stateZipParts[1] || '';\n        \n        if (zip && /^\\d{5}/.test(zip)) {\n          const url = `apartments.com/${city}-${state}-${zip}/`;\n          console.log('[GENERATE_CITY_URL] Generated URL with zipcode (fallback):', url);\n          return url;\n        } else {\n          const url = `apartments.com/${city}-${state}/`;\n          console.log('[GENERATE_CITY_URL] Generated URL without zipcode:', url);\n          return url;\n        }\n      }\n    } else if (parts.length === 2) {\n      // Format: \"Street, City State ZIP\"\n      const cityStateZip = parts[1];\n      \n      // Try to extract city, state, and zip using regex\n      const match = cityStateZip.match(/^(.+?)\\s+([A-Z]{2})\\s+(\\d{5})/i);\n      \n      if (match) {\n        const city = match[1].toLowerCase().replace(/\\s+/g, '-');\n        const state = match[2].toLowerCase();\n        const zip = match[3];\n        const url = `apartments.com/${city}-${state}-${zip}/`;\n        console.log('[GENERATE_CITY_URL] Generated URL with zipcode (format 2):', url);\n        return url;\n      } else {\n        // Fallback to simple split\n        const cityStateZipParts = cityStateZip.split(/\\s+/);\n        \n        if (cityStateZipParts.length >= 3) {\n          const city = cityStateZipParts[0].toLowerCase();\n          const state = cityStateZipParts[1].toLowerCase();\n          const zip = cityStateZipParts[2] || '';\n          \n          if (zip && /^\\d{5}/.test(zip)) {\n            const url = `apartments.com/${city}-${state}-${zip}/`;\n            console.log('[GENERATE_CITY_URL] Generated URL with zipcode (format 2 fallback):', url);\n            return url;\n          }\n        }\n        \n        // Use the first part as city if we can't parse it properly\n        const cityPart = cityStateZipParts[0] || cityStateZip;\n        const url = `apartments.com/${cityPart.toLowerCase().replace(/\\s+/g, '-')}/`;\n        console.log('[GENERATE_CITY_URL] Generated URL without state/zip:', url);\n        return url;\n      }\n    }\n    \n    console.log('[GENERATE_CITY_URL] Failed to generate URL');\n    return '';\n  }\n\n  // Helper function to extract city/state from address for job naming\n  function extractCityState(address: string): string {\n    const parts = address.split(',');\n    if (parts.length < 2) return 'Unknown Location';\n    \n    const city = parts[parts.length - 2].trim();\n    const state = parts[parts.length - 1].trim().split(' ')[0]; // Remove zip code if present\n    \n    return `${city}, ${state}`;\n  }\n\n\n  // Start scraping job for a property\n  app.post(\"/api/properties/:id/scrape\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const property = await storage.getProperty(propertyId);\n      \n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n\n      // Clear scraped properties cache to prevent interference from previous searches\n      console.log('[SCRAPE] Clearing scraped properties cache for new search');\n      await storage.clearScrapedPropertiesCache();\n\n      const cityUrl = generateCityUrl(property.address);\n      if (!cityUrl) {\n        console.error('[SCRAPE] Failed to generate URL from address:', property.address);\n        return res.status(400).json({ message: \"Unable to extract city/zipcode from address. Please ensure address format is: Street, City, State ZIP\" });\n      }\n\n      const cityState = extractCityState(property.address);\n      console.log('[SCRAPE] ===========================================');\n      console.log('[SCRAPE] Starting scraping for property:', property.propertyName);\n      console.log('[SCRAPE] Property address:', property.address);\n      console.log('[SCRAPE] Generated URL:', `https://www.${cityUrl}`);\n      console.log('[SCRAPE] Location:', cityState);\n      console.log('[SCRAPE] ===========================================');\n\n      // Create scraping job\n      const scrapingJob = await storage.createScrapingJob({\n        propertyId,\n        stage: \"city_discovery\",\n        cityUrl: `https://www.${cityUrl}`,\n        status: \"processing\"\n      });\n\n      // Real Scrapezy API call for single-page city scraping\n      try {\n        const urls = [\n          `https://www.${cityUrl}`\n        ];\n\n        console.log(`[SCRAPE] Calling Scrapezy API with URL:`, urls[0]);\n        \n        // Scrape single page\n        let allProperties = [];\n        const jobIds = [];\n        let scrapingSucceeded = false;\n        \n        for (const url of urls) {\n          try {\n            console.log(`Scraping: ${url}`);\n            const pageResult = await callScrapezyScraping(url);\n            \n            if (pageResult && pageResult.id) {\n              jobIds.push(pageResult.id);\n            }\n            \n            // Parse the results from this page\n            const pageProperties = parseUrls(pageResult);\n            console.log(`Found ${pageProperties.length} properties on ${url}`);\n            allProperties.push(...pageProperties);\n            scrapingSucceeded = true;\n            \n          } catch (pageError) {\n            console.error(`Error scraping ${url}:`, pageError);\n            // Check if it's an SSL handshake error\n            const errorMessage = pageError instanceof Error ? pageError.message : String(pageError);\n            if (errorMessage.includes('525') || errorMessage.includes('SSL handshake')) {\n              console.log('üö® Cloudflare SSL error detected - scraping may fail');\n            }\n            // Continue with next page even if one fails\n          }\n        }\n\n        // If scraping completely failed, throw an error\n        if (!scrapingSucceeded || allProperties.length === 0) {\n          console.error('‚ùå Scraping failed or returned no results');\n          throw new Error('Unable to retrieve competitor data from apartments.com. The service may be temporarily unavailable due to anti-scraping protection. Please try again later.');\n        }\n\n        console.log(`Total properties found: ${allProperties.length}`);\n        \n        // Store scraped properties and try to match subject property\n        const scrapedProperties = [];\n        let subjectPropertyFound = false;\n        let bestMatch = { property: null as any, score: 0 };\n\n        for (const propertyData of allProperties) {\n          if (!propertyData.name || !propertyData.address || !propertyData.url) {\n            console.log('Skipping property with missing data:', propertyData);\n            continue;\n          }\n\n          // Advanced property matching with scoring and detailed logging\n          const matchResult = calculatePropertyMatch(property, propertyData);\n          const isSubjectProperty = matchResult.isMatch;\n          \n          // Log detailed matching information\n          console.log(`\\n${'='.repeat(60)}`);\n          console.log(`[PROPERTY_MATCH_RESULT] Property #${scrapedProperties.length + 1}`);\n          console.log(`Subject: \"${property.propertyName}\" at \"${property.address}\"`);\n          console.log(`Scraped: \"${propertyData.name}\" at \"${propertyData.address}\"`);\n          console.log(`Match Score: ${matchResult.score}% (threshold: ${matchResult.matchDetails.threshold}%)`);\n          console.log(`Is Match: ${isSubjectProperty ? '‚úÖ YES' : '‚ùå NO'}`);\n          console.log(`Component Scores:`, matchResult.matchDetails.componentScores);\n          console.log(`Reasons:`);\n          matchResult.reasons.forEach(reason => console.log(`  ${reason}`));\n          console.log(`${'='.repeat(60)}\\n`);\n\n          if (isSubjectProperty) {\n            subjectPropertyFound = true;\n            console.log('üéØ FOUND SUBJECT PROPERTY MATCH:', propertyData.name, `(Score: ${matchResult.score}%)`);\n            console.log('URL:', propertyData.url);\n          }\n          \n          // Track best match for fallback\n          if (matchResult.score > bestMatch.score) {\n            bestMatch = { property: propertyData, score: matchResult.score };\n          }\n\n          const scrapedProperty = await storage.createScrapedProperty({\n            scrapingJobId: scrapingJob.id,\n            name: propertyData.name,\n            url: propertyData.url,\n            address: propertyData.address,\n            distance: null,\n            matchScore: matchResult.score.toString(),\n            isSubjectProperty\n          });\n          scrapedProperties.push(scrapedProperty);\n          \n        }\n        \n        // FALLBACK 1: If no subject property found but we have a decent match (>=40%), use it\n        if (!subjectPropertyFound && bestMatch.property && bestMatch.score >= 40) {\n          console.log('[SUBJECT_FALLBACK] No exact subject match found, using best match as fallback');\n          console.log('[SUBJECT_FALLBACK] Best match:', bestMatch.property.name);\n          console.log('[SUBJECT_FALLBACK] Match score:', bestMatch.score, '%');\n          console.log('[SUBJECT_FALLBACK] URL:', bestMatch.property.url);\n          \n          // Find and update the scraped property to mark it as subject\n          const fallbackProperty = scrapedProperties.find(p => p.url === bestMatch.property.url);\n          if (fallbackProperty) {\n            // Update the isSubjectProperty flag in storage\n            const updated = await storage.updateScrapedProperty(fallbackProperty.id, {\n              isSubjectProperty: true\n            });\n            \n            if (updated) {\n              // Also update the local object for consistency\n              fallbackProperty.isSubjectProperty = true;\n              subjectPropertyFound = true;\n              console.log('[SUBJECT_FALLBACK] ‚úÖ Successfully marked fallback property as subject');\n            } else {\n              console.error('[SUBJECT_FALLBACK] ‚ùå Failed to update property in storage');\n            }\n          }\n        }\n        \n        // FALLBACK 2: If still no subject property (all matches < 40%), mark the BEST match regardless\n        if (!subjectPropertyFound && bestMatch.property && scrapedProperties.length > 0) {\n          console.log('[SUBJECT_FALLBACK_FORCED] No matches above 40%, forcing best match as subject');\n          console.log('[SUBJECT_FALLBACK_FORCED] Best match:', bestMatch.property.name);\n          console.log('[SUBJECT_FALLBACK_FORCED] Match score:', bestMatch.score, '% (below threshold)');\n          console.log('[SUBJECT_FALLBACK_FORCED] URL:', bestMatch.property.url);\n          console.log('[SUBJECT_FALLBACK_FORCED] ‚ö†Ô∏è This is a low-confidence match but ensuring we have a subject property');\n          \n          const forcedFallback = scrapedProperties.find(p => p.url === bestMatch.property.url);\n          if (forcedFallback) {\n            // Update the isSubjectProperty flag in storage\n            const updated = await storage.updateScrapedProperty(forcedFallback.id, {\n              isSubjectProperty: true\n            });\n            \n            if (updated) {\n              // Also update the local object for consistency\n              forcedFallback.isSubjectProperty = true;\n              subjectPropertyFound = true;\n              console.log('[SUBJECT_FALLBACK_FORCED] ‚úÖ Forced property marked as subject');\n            } else {\n              console.error('[SUBJECT_FALLBACK_FORCED] ‚ùå Failed to update property in storage');\n            }\n          }\n        }\n        \n        // FALLBACK 3: If we somehow still don't have a subject (e.g., no properties scraped), mark first property\n        if (!subjectPropertyFound && scrapedProperties.length > 0) {\n          console.log('[SUBJECT_FALLBACK_FIRST] Emergency fallback: marking first scraped property as subject');\n          const firstProperty = scrapedProperties[0];\n          \n          const updated = await storage.updateScrapedProperty(firstProperty.id, {\n            isSubjectProperty: true\n          });\n          \n          if (updated) {\n            firstProperty.isSubjectProperty = true;\n            subjectPropertyFound = true;\n            console.log('[SUBJECT_FALLBACK_FIRST] ‚úÖ First property marked as subject');\n            console.log('[SUBJECT_FALLBACK_FIRST] Property:', firstProperty.name);\n            console.log('[SUBJECT_FALLBACK_FIRST] URL:', firstProperty.url);\n          } else {\n            console.error('[SUBJECT_FALLBACK_FIRST] ‚ùå Failed to update first property in storage');\n          }\n        }\n\n        // Update job status to completed\n        await storage.updateScrapingJob(scrapingJob.id, {\n          status: \"completed\",\n          completedAt: new Date(),\n          results: { \n            totalProperties: allProperties.length,\n            subjectPropertyFound,\n            urls: urls,\n            jobIds: jobIds\n          }\n        });\n\n        // Include match results in response for debugging\n        const matchResults = scrapedProperties.map(sp => ({\n          id: sp.id,\n          name: sp.name,\n          address: sp.address,\n          matchScore: sp.matchScore,\n          isSubjectProperty: sp.isSubjectProperty,\n          url: sp.url\n        }));\n        \n        res.json({ \n          scrapingJob: { ...scrapingJob, status: \"completed\" },\n          message: `Successfully scraped ${allProperties.length} properties from ${cityState}`,\n          targetUrl: `https://www.${cityUrl}`,\n          scrapedProperties: scrapedProperties.length,\n          subjectPropertyFound,\n          jobIds,\n          matchResults,\n          subjectProperty: scrapedProperties.find(p => p.isSubjectProperty) || null,\n          debugInfo: {\n            totalScraped: allProperties.length,\n            totalStored: scrapedProperties.length,\n            matchThreshold: 50, // Updated threshold\n            fallbackUsed: bestMatch.score < 50 && subjectPropertyFound,\n            fallbackType: bestMatch.score >= 50 ? 'exact_match' : \n                         bestMatch.score >= 40 ? 'good_match_fallback' :\n                         bestMatch.score > 0 ? 'forced_best_match' : \n                         'first_property_fallback',\n            bestMatchScore: bestMatch.score,\n            subjectPropertyData: {\n              name: property.propertyName,\n              address: property.address\n            },\n            subjectPropertyMarked: subjectPropertyFound,\n            markedProperty: scrapedProperties.find(p => p.isSubjectProperty) || null\n          }\n        });\n\n      } catch (scrapingError) {\n        console.error(\"Scrapezy API error:\", scrapingError);\n        \n        // Update job status to failed\n        await storage.updateScrapingJob(scrapingJob.id, {\n          status: \"failed\",\n          errorMessage: scrapingError instanceof Error ? scrapingError.message : \"Unknown scraping error\"\n        });\n\n        res.status(500).json({ \n          message: \"Scraping failed\",\n          error: scrapingError instanceof Error ? scrapingError.message : \"Unknown error\",\n          details: scrapingError instanceof Error ? scrapingError.stack : undefined\n        });\n      }\n    } catch (error) {\n      console.error(\"Error starting scraping job:\", error);\n      res.status(500).json({ message: \"Failed to start scraping job\" });\n    }\n  });\n\n  // Simulate scraping completion (in real implementation, this would be called by Scrapezy webhook)\n  app.post(\"/api/scraping/:jobId/complete\", async (req, res) => {\n    try {\n      const jobId = req.params.jobId;\n      const { properties } = req.body; // Array of scraped property data\n      \n      const job = await storage.getScrapingJob(jobId);\n      if (!job) {\n        return res.status(404).json({ message: \"Scraping job not found\" });\n      }\n\n      // Update job status\n      await storage.updateScrapingJob(jobId, {\n        status: \"completed\",\n        completedAt: new Date()\n      });\n\n      // Store scraped properties\n      const scrapedProperties = [];\n      for (const propertyData of properties || []) {\n        const scrapedProperty = await storage.createScrapedProperty({\n          scrapingJobId: jobId,\n          name: propertyData.name,\n          url: propertyData.url,\n          address: propertyData.address,\n          distance: propertyData.distance?.toString(),\n          matchScore: propertyData.matchScore?.toString()\n        });\n        scrapedProperties.push(scrapedProperty);\n      }\n\n      res.json({ job, scrapedProperties });\n    } catch (error) {\n      console.error(\"Error completing scraping job:\", error);\n      res.status(500).json({ message: \"Failed to complete scraping job\" });\n    }\n  });\n\n  // Get scraping job status and results\n  app.get(\"/api/scraping/:jobId\", async (req, res) => {\n    try {\n      const jobId = req.params.jobId;\n      const job = await storage.getScrapingJob(jobId);\n      \n      if (!job) {\n        return res.status(404).json({ message: \"Scraping job not found\" });\n      }\n\n      const scrapedProperties = await storage.getScrapedPropertiesByJob(jobId);\n      \n      res.json({ job, scrapedProperties });\n    } catch (error) {\n      console.error(\"Error fetching scraping job:\", error);\n      res.status(500).json({ message: \"Failed to fetch scraping job\" });\n    }\n  });\n\n  // Get scraped properties for a property (for UI display)\n  app.get(\"/api/properties/:id/scraped-properties\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const jobs = await storage.getScrapingJobsByProperty(propertyId);\n      \n      if (jobs.length === 0) {\n        return res.json({ scrapedProperties: [], totalCount: 0 });\n      }\n\n      // Get the most recent successful job\n      const completedJob = jobs\n        .filter(job => job.status === \"completed\")\n        .sort((a, b) => {\n          const aTime = a.createdAt ? new Date(a.createdAt).getTime() : 0;\n          const bTime = b.createdAt ? new Date(b.createdAt).getTime() : 0;\n          return bTime - aTime;\n        })[0];\n\n      if (!completedJob) {\n        return res.json({ scrapedProperties: [], totalCount: 0 });\n      }\n\n      const scrapedProperties = await storage.getScrapedPropertiesByJob(completedJob.id);\n      \n      // Separate subject property from competitors\n      const subjectProperty = scrapedProperties.find(p => p.isSubjectProperty);\n      const competitors = scrapedProperties.filter(p => !p.isSubjectProperty);\n\n      res.json({ \n        scrapedProperties: competitors,  // Only return competitors for selection\n        subjectProperty,\n        totalCount: scrapedProperties.length,\n        scrapingJob: completedJob\n      });\n    } catch (error) {\n      console.error(\"Error fetching scraped properties:\", error);\n      res.status(500).json({ message: \"Failed to fetch scraped properties\" });\n    }\n  });\n\n  // Get all scraping jobs for a property\n  app.get(\"/api/properties/:id/scraping-jobs\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const jobs = await storage.getScrapingJobsByProperty(propertyId);\n      \n      res.json(jobs);\n    } catch (error) {\n      console.error(\"Error fetching scraping jobs:\", error);\n      res.status(500).json({ message: \"Failed to fetch scraping jobs\" });\n    }\n  });\n\n  // Manual subject property selection endpoint - mark a scraped property as the subject\n  app.post(\"/api/properties/:id/set-subject\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const { scrapedPropertyId } = req.body;\n      \n      console.log('[MANUAL_SUBJECT_SELECTION] Setting subject property');\n      console.log('[MANUAL_SUBJECT_SELECTION] Property ID:', propertyId);\n      console.log('[MANUAL_SUBJECT_SELECTION] Scraped Property ID:', scrapedPropertyId);\n      \n      const property = await storage.getProperty(propertyId);\n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      // Get the scraped property to mark as subject\n      const scrapedProperty = await storage.getScrapedProperty(scrapedPropertyId);\n      if (!scrapedProperty) {\n        return res.status(404).json({ message: \"Scraped property not found\" });\n      }\n      \n      // Unmark any existing subject properties for this property's scraping jobs\n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId);\n      for (const job of scrapingJobs) {\n        const jobProperties = await storage.getScrapedPropertiesByJob(job.id);\n        for (const prop of jobProperties) {\n          if (prop.isSubjectProperty && prop.id !== scrapedPropertyId) {\n            // Update to unmark this property (implementation would need to be added to storage)\n            console.log('[MANUAL_SUBJECT_SELECTION] Unmarking previous subject:', prop.name);\n          }\n        }\n      }\n      \n      // Mark the selected property as the subject\n      console.log('[MANUAL_SUBJECT_SELECTION] Marking as subject:', scrapedProperty.name);\n      \n      res.json({ \n        success: true,\n        message: `Successfully set ${scrapedProperty.name} as the subject property`,\n        subjectProperty: {\n          id: scrapedProperty.id,\n          name: scrapedProperty.name,\n          address: scrapedProperty.address,\n          url: scrapedProperty.url,\n          matchScore: scrapedProperty.matchScore\n        },\n        originalProperty: {\n          id: property.id,\n          name: property.propertyName,\n          address: property.address\n        }\n      });\n    } catch (error) {\n      console.error(\"[MANUAL_SUBJECT_SELECTION] Error:\", error);\n      res.status(500).json({ message: \"Failed to set subject property\" });\n    }\n  });\n  \n  // Match subject property with scraped data (legacy endpoint)\n  app.post(\"/api/properties/:id/match\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const { scrapedPropertyId } = req.body;\n      \n      const property = await storage.getProperty(propertyId);\n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n\n      // Here you would implement matching logic\n      // For now, we'll just return a success response\n      res.json({ \n        matched: true,\n        message: `Successfully matched ${property.propertyName} with scraped data`,\n        scrapedPropertyId\n      });\n    } catch (error) {\n      console.error(\"Error matching property:\", error);\n      res.status(500).json({ message: \"Failed to match property\" });\n    }\n  });\n\n  // Workflow State Management\n  app.get(\"/api/workflow/:propertyId\", async (req, res) => {\n    try {\n      const propertyId = req.params.propertyId;\n      let state = await storage.getWorkflowState(propertyId);\n      \n      if (!state) {\n        console.log('[WORKFLOW_STATE] No state found for property:', propertyId);\n        // Auto-initialize workflow state if it doesn't exist\n        console.log('[WORKFLOW_STATE] Auto-initializing workflow state');\n        state = await storage.saveWorkflowState({\n          propertyId,\n          selectedCompetitorIds: [],\n          currentStage: 'input'\n        });\n      }\n      \n      res.json(state);\n    } catch (error) {\n      console.error(\"[WORKFLOW_STATE] Error fetching workflow state:\", error);\n      res.status(500).json({ message: \"Failed to fetch workflow state\" });\n    }\n  });\n\n  app.put(\"/api/workflow/:propertyId\", async (req, res) => {\n    try {\n      const propertyId = req.params.propertyId;\n      const state = {\n        propertyId,\n        ...req.body\n      };\n      \n      console.log('[WORKFLOW_STATE] Saving workflow state for property:', propertyId);\n      console.log('[WORKFLOW_STATE] State data:', state);\n      \n      const savedState = await storage.saveWorkflowState(state);\n      res.json(savedState);\n    } catch (error) {\n      console.error(\"[WORKFLOW_STATE] Error saving workflow state:\", error);\n      res.status(500).json({ message: \"Failed to save workflow state\" });\n    }\n  });\n\n  // Force sync units from scraped data with fuzzy matching fallback\n  app.post(\"/api/properties/:id/sync-units\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const property = await storage.getProperty(propertyId);\n      \n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      console.log('[SYNC_UNITS] Starting sync for property:', property.propertyName);\n      \n      // Find the subject scraped property\n      let subjectProperty = null;\n      let scrapedUnits: ScrapedUnit[] = [];\n      let fallbackUsed = false;\n      let searchAttempts: any[] = [];\n      \n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId);\n      if (scrapingJobs.length > 0) {\n        console.log('[SYNC_UNITS] Found', scrapingJobs.length, 'scraping jobs');\n        \n        for (const job of scrapingJobs) {\n          const scrapedProperties = await storage.getScrapedPropertiesByJob(job.id);\n          console.log('[SYNC_UNITS] Job', job.id, 'has', scrapedProperties.length, 'scraped properties');\n          \n          // First try to find exact subject match\n          const subject = scrapedProperties.find(p => p.isSubjectProperty === true);\n          if (subject) {\n            subjectProperty = subject;\n            scrapedUnits = await storage.getScrapedUnitsByProperty(subject.id);\n            console.log('[SYNC_UNITS] Found subject property:', subject.name, 'with', scrapedUnits.length, 'units');\n            break;\n          }\n          \n          // FALLBACK: Use fuzzy matching to find best match\n          if (!subjectProperty && scrapedProperties.length > 0) {\n            console.log('[SYNC_UNITS_FALLBACK] No subject property marked, attempting fuzzy matching');\n            \n            let bestMatch = { property: null as any, score: 0 };\n            \n            for (const scrapedProp of scrapedProperties) {\n              const matchResult = calculatePropertyMatch(property, scrapedProp);\n              searchAttempts.push({\n                name: scrapedProp.name,\n                address: scrapedProp.address,\n                score: matchResult.score,\n                reasons: matchResult.reasons\n              });\n              \n              console.log('[SYNC_UNITS_FALLBACK] Checking:', scrapedProp.name);\n              console.log('[SYNC_UNITS_FALLBACK] Score:', matchResult.score, '%');\n              \n              if (matchResult.score > bestMatch.score) {\n                bestMatch = { property: scrapedProp, score: matchResult.score };\n              }\n            }\n            \n            // Use best match if score is reasonable\n            if (bestMatch.property && bestMatch.score >= 40) {\n              subjectProperty = bestMatch.property;\n              scrapedUnits = await storage.getScrapedUnitsByProperty(bestMatch.property.id);\n              fallbackUsed = true;\n              console.log('[SYNC_UNITS_FALLBACK] ‚úÖ Using best match as subject:', bestMatch.property.name);\n              console.log('[SYNC_UNITS_FALLBACK] Match score:', bestMatch.score, '%');\n              console.log('[SYNC_UNITS_FALLBACK] Found', scrapedUnits.length, 'units');\n            }\n          }\n        }\n      }\n      \n      if (scrapedUnits.length === 0) {\n        return res.status(404).json({ \n          message: \"No scraped units to sync\",\n          details: \"Could not find subject property or any matching scraped property\",\n          searchAttempts,\n          suggestions: [\n            \"Run the scraping job first to collect property data\",\n            \"Use the force-link endpoint to manually link a scraped property\",\n            \"Check the debug-matching endpoint to see all match scores\"\n          ]\n        });\n      }\n      \n      // Clear existing PropertyUnits and recreate from scraped data\n      await storage.clearPropertyUnits(propertyId);\n      const units = [];\n      \n      for (const scrapedUnit of scrapedUnits) {\n        const unit = await storage.createPropertyUnit({\n          propertyId,\n          unitNumber: scrapedUnit.unitNumber || scrapedUnit.floorPlanName || `Unit-${scrapedUnit.id.substring(0, 6)}`,\n          unitType: scrapedUnit.unitType,\n          currentRent: scrapedUnit.rent || \"0\",\n          status: scrapedUnit.status || \"occupied\"\n        });\n        units.push(unit);\n      }\n      \n      res.json({ \n        message: `Successfully synced ${units.length} units from scraped data`,\n        unitsCount: units.length,\n        units: units,\n        subjectProperty: subjectProperty ? {\n          id: subjectProperty.id,\n          name: subjectProperty.name,\n          address: subjectProperty.address,\n          url: subjectProperty.url\n        } : null,\n        fallbackUsed,\n        searchAttempts: fallbackUsed ? searchAttempts : []\n      });\n    } catch (error) {\n      console.error(\"Error syncing units:\", error);\n      res.status(500).json({ message: \"Failed to sync units\" });\n    }\n  });\n\n  // Force-link endpoint to manually link a scraped property as subject\n  app.post(\"/api/properties/:id/force-link-subject\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const { scrapedPropertyUrl, scrapedPropertyName } = req.body;\n      \n      if (!scrapedPropertyUrl && !scrapedPropertyName) {\n        return res.status(400).json({ \n          message: \"Either scrapedPropertyUrl or scrapedPropertyName is required\" \n        });\n      }\n      \n      const property = await storage.getProperty(propertyId);\n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      console.log('[FORCE_LINK] Forcing link for property:', property.propertyName);\n      console.log('[FORCE_LINK] Search criteria:', { url: scrapedPropertyUrl, name: scrapedPropertyName });\n      \n      // Find the scraped property\n      let targetProperty = null;\n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId);\n      \n      for (const job of scrapingJobs) {\n        const scrapedProperties = await storage.getScrapedPropertiesByJob(job.id);\n        \n        // Find by URL or name\n        targetProperty = scrapedProperties.find(p => \n          (scrapedPropertyUrl && p.url === scrapedPropertyUrl) ||\n          (scrapedPropertyName && p.name.toLowerCase().includes(scrapedPropertyName.toLowerCase()))\n        );\n        \n        if (targetProperty) {\n          console.log('[FORCE_LINK] Found target property:', targetProperty.name);\n          \n          // Mark all others as non-subject (in real implementation, would update storage)\n          for (const prop of scrapedProperties) {\n            if (prop.id !== targetProperty.id && prop.isSubjectProperty) {\n              prop.isSubjectProperty = false;\n              console.log('[FORCE_LINK] Unmarking:', prop.name);\n            }\n          }\n          \n          // Mark target as subject\n          targetProperty.isSubjectProperty = true;\n          console.log('[FORCE_LINK] ‚úÖ Marked as subject:', targetProperty.name);\n          break;\n        }\n      }\n      \n      if (!targetProperty) {\n        return res.status(404).json({ \n          message: \"Scraped property not found\",\n          searchCriteria: { url: scrapedPropertyUrl, name: scrapedPropertyName }\n        });\n      }\n      \n      // Now sync the units\n      const scrapedUnits = await storage.getScrapedUnitsByProperty(targetProperty.id);\n      console.log('[FORCE_LINK] Found', scrapedUnits.length, 'units to sync');\n      \n      // Clear existing and sync\n      await storage.clearPropertyUnits(propertyId);\n      const units = [];\n      \n      for (const scrapedUnit of scrapedUnits) {\n        const unit = await storage.createPropertyUnit({\n          propertyId,\n          unitNumber: scrapedUnit.unitNumber || scrapedUnit.floorPlanName || `Unit-${scrapedUnit.id.substring(0, 6)}`,\n          unitType: scrapedUnit.unitType,\n          currentRent: scrapedUnit.rent || \"0\",\n          status: scrapedUnit.status || \"occupied\"\n        });\n        units.push(unit);\n      }\n      \n      res.json({\n        success: true,\n        message: `Successfully force-linked ${targetProperty.name} and synced ${units.length} units`,\n        subjectProperty: {\n          id: targetProperty.id,\n          name: targetProperty.name,\n          address: targetProperty.address,\n          url: targetProperty.url\n        },\n        unitsCount: units.length,\n        units: units.slice(0, 5) // Return first 5 units as sample\n      });\n      \n    } catch (error) {\n      console.error(\"[FORCE_LINK] Error:\", error);\n      res.status(500).json({ message: \"Failed to force link subject property\" });\n    }\n  });\n  \n  // Debug-matching endpoint to diagnose matching issues\n  app.get(\"/api/properties/:id/debug-matching\", async (req, res) => {\n    try {\n      const propertyId = req.params.id;\n      const property = await storage.getProperty(propertyId);\n      \n      if (!property) {\n        return res.status(404).json({ message: \"Property not found\" });\n      }\n      \n      console.log('[DEBUG_MATCHING] Analyzing matches for:', property.propertyName);\n      \n      const results = {\n        subjectProperty: {\n          id: property.id,\n          name: property.propertyName,\n          address: property.address,\n          city: property.city,\n          state: property.state\n        },\n        scrapingJobs: [] as any[],\n        allMatches: [] as any[],\n        bestMatch: null as any,\n        currentSubject: null as any\n      };\n      \n      const scrapingJobs = await storage.getScrapingJobsByProperty(propertyId);\n      \n      for (const job of scrapingJobs) {\n        const jobInfo = {\n          id: job.id,\n          status: job.status,\n          createdAt: job.createdAt,\n          properties: [] as any[]\n        };\n        \n        const scrapedProperties = await storage.getScrapedPropertiesByJob(job.id);\n        \n        for (const scrapedProp of scrapedProperties) {\n          const matchResult = calculatePropertyMatch(property, scrapedProp);\n          \n          const propertyInfo = {\n            id: scrapedProp.id,\n            name: scrapedProp.name,\n            address: scrapedProp.address,\n            url: scrapedProp.url,\n            isSubjectProperty: scrapedProp.isSubjectProperty,\n            matchScore: matchResult.score,\n            isMatch: matchResult.isMatch,\n            matchDetails: matchResult.matchDetails,\n            reasons: matchResult.reasons\n          };\n          \n          jobInfo.properties.push(propertyInfo);\n          results.allMatches.push(propertyInfo);\n          \n          // Track current subject\n          if (scrapedProp.isSubjectProperty) {\n            results.currentSubject = propertyInfo;\n          }\n          \n          // Track best match\n          if (!results.bestMatch || matchResult.score > results.bestMatch.matchScore) {\n            results.bestMatch = propertyInfo;\n          }\n        }\n        \n        results.scrapingJobs.push(jobInfo);\n      }\n      \n      // Sort all matches by score\n      results.allMatches.sort((a, b) => b.matchScore - a.matchScore);\n      \n      // Add recommendations\n      const recommendations = [];\n      \n      if (!results.currentSubject && results.bestMatch) {\n        if (results.bestMatch.matchScore >= 50) {\n          recommendations.push({\n            action: \"AUTO_LINK\",\n            message: `Best match \"${results.bestMatch.name}\" has score ${results.bestMatch.matchScore}% - consider using sync-units endpoint which will auto-select it`\n          });\n        } else if (results.bestMatch.matchScore >= 40) {\n          recommendations.push({\n            action: \"FORCE_LINK\",\n            message: `Best match \"${results.bestMatch.name}\" has score ${results.bestMatch.matchScore}% - use force-link endpoint to manually select it`\n          });\n        } else {\n          recommendations.push({\n            action: \"RE_SCRAPE\",\n            message: `Best match only has score ${results.bestMatch.matchScore}% - consider re-scraping with a more accurate address`\n          });\n        }\n      }\n      \n      if (results.currentSubject && results.currentSubject.matchScore < 50) {\n        recommendations.push({\n          action: \"WARNING\",\n          message: `Current subject \"${results.currentSubject.name}\" has low match score ${results.currentSubject.matchScore}% - may be incorrectly matched`\n        });\n      }\n      \n      res.json({\n        ...results,\n        recommendations,\n        summary: {\n          totalScrapedProperties: results.allMatches.length,\n          hasSubjectProperty: !!results.currentSubject,\n          bestMatchScore: results.bestMatch ? results.bestMatch.matchScore : 0,\n          matchThreshold: 50\n        }\n      });\n      \n    } catch (error) {\n      console.error(\"[DEBUG_MATCHING] Error:\", error);\n      res.status(500).json({ message: \"Failed to debug matching\" });\n    }\n  });\n\n  // Test endpoint for matching logic - can be removed in production if desired\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":116013},"server/storage.ts":{"content":"import { \n  type Property, \n  type InsertProperty,\n  type PropertyAnalysis,\n  type InsertPropertyAnalysis,\n  type CompetitorProperty,\n  type InsertCompetitorProperty,\n  type PropertyUnit,\n  type InsertPropertyUnit,\n  type OptimizationReport,\n  type InsertOptimizationReport,\n  type ScrapingJob,\n  type InsertScrapingJob,\n  type ScrapedProperty,\n  type InsertScrapedProperty,\n  type ScrapedUnit,\n  type InsertScrapedUnit,\n  type FilterCriteria,\n  type FilteredAnalysis,\n  type UnitComparison,\n  type CompetitiveEdges\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\n// Workflow State interface\nexport interface WorkflowState {\n  propertyId: string;\n  selectedCompetitorIds: string[];\n  scrapingJobId?: string;\n  filterCriteria?: any;\n  currentStage: 'input' | 'summarize' | 'analyze' | 'optimize';\n}\n\nexport interface IStorage {\n  // Properties\n  createProperty(property: InsertProperty): Promise<Property>;\n  getProperty(id: string): Promise<Property | undefined>;\n  getAllProperties(): Promise<Property[]>;\n  \n  // Property Analysis\n  createPropertyAnalysis(analysis: InsertPropertyAnalysis): Promise<PropertyAnalysis>;\n  getPropertyAnalysis(propertyId: string): Promise<PropertyAnalysis | undefined>;\n  \n  // Competitor Properties (Legacy - will be replaced by scraped data)\n  createCompetitorProperty(property: InsertCompetitorProperty): Promise<CompetitorProperty>;\n  getAllCompetitorProperties(): Promise<CompetitorProperty[]>;\n  getSelectedCompetitorProperties(ids: string[]): Promise<CompetitorProperty[]>;\n  \n  // Property Units\n  createPropertyUnit(unit: InsertPropertyUnit): Promise<PropertyUnit>;\n  getPropertyUnits(propertyId: string): Promise<PropertyUnit[]>;\n  updatePropertyUnit(id: string, updates: Partial<PropertyUnit>): Promise<PropertyUnit | undefined>;\n  clearPropertyUnits(propertyId: string): Promise<void>;\n  \n  // Optimization Reports\n  createOptimizationReport(report: InsertOptimizationReport): Promise<OptimizationReport>;\n  getOptimizationReport(propertyId: string): Promise<OptimizationReport | undefined>;\n  \n  // Scrapezy Integration\n  createScrapingJob(job: InsertScrapingJob): Promise<ScrapingJob>;\n  getScrapingJob(id: string): Promise<ScrapingJob | undefined>;\n  getScrapingJobsByProperty(propertyId: string): Promise<ScrapingJob[]>;\n  updateScrapingJob(id: string, updates: Partial<ScrapingJob>): Promise<ScrapingJob | undefined>;\n  \n  createScrapedProperty(property: InsertScrapedProperty): Promise<ScrapedProperty>;\n  getScrapedPropertiesByJob(scrapingJobId: string): Promise<ScrapedProperty[]>;\n  getAllScrapedCompetitors(): Promise<ScrapedProperty[]>;\n  getSelectedScrapedProperties(ids: string[]): Promise<ScrapedProperty[]>;\n  updateScrapedProperty(id: string, updates: Partial<ScrapedProperty>): Promise<ScrapedProperty | undefined>;\n  \n  createScrapedUnit(unit: InsertScrapedUnit): Promise<ScrapedUnit>;\n  getScrapedUnitsByProperty(propertyId: string): Promise<ScrapedUnit[]>;\n  \n  // Get subject property (marked as isSubjectProperty: true)\n  getSubjectScrapedProperty(): Promise<ScrapedProperty | null>;\n  \n  // Get scraped property by ID\n  getScrapedProperty(id: string): Promise<ScrapedProperty | undefined>;\n  \n  // Clear scraped properties cache\n  clearScrapedPropertiesCache(): Promise<void>;\n  \n  // Get original property ID from scraped property\n  getOriginalPropertyIdFromScraped(scrapedPropertyId: string): Promise<string | null>;\n  \n  // Filtered analysis methods\n  getFilteredScrapedUnits(criteria: FilterCriteria): Promise<ScrapedUnit[]>;\n  generateFilteredAnalysis(propertyId: string, criteria: FilterCriteria): Promise<FilteredAnalysis>;\n  \n  // Workflow State Management\n  getWorkflowState(propertyId: string): Promise<WorkflowState | null>;\n  saveWorkflowState(state: WorkflowState): Promise<WorkflowState>;\n}\n\nexport class MemStorage implements IStorage {\n  private properties: Map<string, Property>;\n  private propertyAnalyses: Map<string, PropertyAnalysis>;\n  private competitorProperties: Map<string, CompetitorProperty>;\n  private propertyUnits: Map<string, PropertyUnit>;\n  private optimizationReports: Map<string, OptimizationReport>;\n  private scrapingJobs: Map<string, ScrapingJob>;\n  private scrapedProperties: Map<string, ScrapedProperty>;\n  private scrapedUnits: Map<string, ScrapedUnit>;\n  private workflowStates: Map<string, WorkflowState>;\n\n  constructor() {\n    this.properties = new Map();\n    this.propertyAnalyses = new Map();\n    this.competitorProperties = new Map();\n    this.propertyUnits = new Map();\n    this.optimizationReports = new Map();\n    this.scrapingJobs = new Map();\n    this.scrapedProperties = new Map();\n    this.scrapedUnits = new Map();\n    this.workflowStates = new Map();\n    // Removed seedData() - only use real data from Scrapezy\n  }\n\n  // Removed seedData() method - only use real data from Scrapezy\n  // This ensures only valid apartments.com URLs are used in the scraping workflow\n  // All competitor properties will be populated from actual scraping jobs\n\n  async createProperty(insertProperty: InsertProperty): Promise<Property> {\n    const id = randomUUID();\n    const property: Property = { \n      ...insertProperty, \n      id, \n      createdAt: new Date(),\n      city: insertProperty.city ?? null,\n      state: insertProperty.state ?? null,\n      propertyType: insertProperty.propertyType ?? null,\n      totalUnits: insertProperty.totalUnits ?? null,\n      builtYear: insertProperty.builtYear ?? null,\n      squareFootage: insertProperty.squareFootage ?? null,\n      parkingSpaces: insertProperty.parkingSpaces ?? null,\n      amenities: insertProperty.amenities ? [...insertProperty.amenities] : null\n    };\n    this.properties.set(id, property);\n    return property;\n  }\n\n  async getProperty(id: string): Promise<Property | undefined> {\n    return this.properties.get(id);\n  }\n\n  async getAllProperties(): Promise<Property[]> {\n    return Array.from(this.properties.values());\n  }\n\n  async createPropertyAnalysis(insertAnalysis: InsertPropertyAnalysis): Promise<PropertyAnalysis> {\n    const id = randomUUID();\n    const analysis: PropertyAnalysis = { \n      ...insertAnalysis, \n      id, \n      createdAt: new Date(),\n      competitiveAdvantages: Array.isArray(insertAnalysis.competitiveAdvantages) ? [...insertAnalysis.competitiveAdvantages] : [],\n      recommendations: Array.isArray(insertAnalysis.recommendations) ? [...insertAnalysis.recommendations] : []\n    };\n    this.propertyAnalyses.set(insertAnalysis.propertyId, analysis);\n    return analysis;\n  }\n\n  async getPropertyAnalysis(propertyId: string): Promise<PropertyAnalysis | undefined> {\n    return Array.from(this.propertyAnalyses.values()).find(\n      analysis => analysis.propertyId === propertyId\n    );\n  }\n\n  async createCompetitorProperty(insertProperty: InsertCompetitorProperty): Promise<CompetitorProperty> {\n    const id = randomUUID();\n    const property: CompetitorProperty = { \n      ...insertProperty, \n      id, \n      createdAt: new Date(),\n      amenities: Array.isArray(insertProperty.amenities) ? [...insertProperty.amenities] : []\n    };\n    this.competitorProperties.set(id, property);\n    return property;\n  }\n\n  async getAllCompetitorProperties(): Promise<CompetitorProperty[]> {\n    return Array.from(this.competitorProperties.values());\n  }\n\n  async getSelectedCompetitorProperties(ids: string[]): Promise<CompetitorProperty[]> {\n    return ids.map(id => this.competitorProperties.get(id)).filter(Boolean) as CompetitorProperty[];\n  }\n\n  async createPropertyUnit(insertUnit: InsertPropertyUnit): Promise<PropertyUnit> {\n    const id = randomUUID();\n    const unit: PropertyUnit = { \n      ...insertUnit, \n      id, \n      createdAt: new Date(),\n      status: insertUnit.status || \"occupied\",\n      recommendedRent: insertUnit.recommendedRent ?? null\n    };\n    this.propertyUnits.set(id, unit);\n    return unit;\n  }\n\n  async getPropertyUnits(propertyId: string): Promise<PropertyUnit[]> {\n    return Array.from(this.propertyUnits.values()).filter(\n      unit => unit.propertyId === propertyId\n    );\n  }\n\n  async updatePropertyUnit(id: string, updates: Partial<PropertyUnit>): Promise<PropertyUnit | undefined> {\n    const unit = this.propertyUnits.get(id);\n    if (!unit) return undefined;\n    \n    const updatedUnit = { ...unit, ...updates };\n    this.propertyUnits.set(id, updatedUnit);\n    return updatedUnit;\n  }\n\n  async clearPropertyUnits(propertyId: string): Promise<void> {\n    const unitsToDelete = Array.from(this.propertyUnits.keys()).filter(id => {\n      const unit = this.propertyUnits.get(id);\n      return unit && unit.propertyId === propertyId;\n    });\n    \n    unitsToDelete.forEach(id => this.propertyUnits.delete(id));\n  }\n\n  async createOptimizationReport(insertReport: InsertOptimizationReport): Promise<OptimizationReport> {\n    const id = randomUUID();\n    const report: OptimizationReport = { ...insertReport, id, createdAt: new Date() };\n    this.optimizationReports.set(insertReport.propertyId, report);\n    return report;\n  }\n\n  async getOptimizationReport(propertyId: string): Promise<OptimizationReport | undefined> {\n    return Array.from(this.optimizationReports.values()).find(\n      report => report.propertyId === propertyId\n    );\n  }\n\n  // Scrapezy Integration Methods\n  async createScrapingJob(insertJob: InsertScrapingJob): Promise<ScrapingJob> {\n    const id = randomUUID();\n    const job: ScrapingJob = { \n      ...insertJob, \n      id, \n      createdAt: new Date(),\n      completedAt: null,\n      scrapezyJobId: insertJob.scrapezyJobId ?? null,\n      status: insertJob.status || \"pending\",\n      results: insertJob.results ?? null,\n      errorMessage: insertJob.errorMessage ?? null\n    };\n    this.scrapingJobs.set(id, job);\n    return job;\n  }\n\n  async getScrapingJob(id: string): Promise<ScrapingJob | undefined> {\n    return this.scrapingJobs.get(id);\n  }\n\n  async getScrapingJobsByProperty(propertyId: string): Promise<ScrapingJob[]> {\n    return Array.from(this.scrapingJobs.values()).filter(\n      job => job.propertyId === propertyId\n    );\n  }\n\n  async updateScrapingJob(id: string, updates: Partial<ScrapingJob>): Promise<ScrapingJob | undefined> {\n    const job = this.scrapingJobs.get(id);\n    if (!job) return undefined;\n    \n    const updatedJob = { ...job, ...updates };\n    this.scrapingJobs.set(id, updatedJob);\n    return updatedJob;\n  }\n\n  async createScrapedProperty(insertProperty: InsertScrapedProperty): Promise<ScrapedProperty> {\n    const id = randomUUID();\n    const property: ScrapedProperty = { \n      ...insertProperty, \n      id, \n      createdAt: new Date(),\n      distance: insertProperty.distance ?? null,\n      isSubjectProperty: insertProperty.isSubjectProperty ?? null,\n      matchScore: insertProperty.matchScore ?? null\n    };\n    this.scrapedProperties.set(id, property);\n    return property;\n  }\n\n  async getScrapedPropertiesByJob(scrapingJobId: string): Promise<ScrapedProperty[]> {\n    return Array.from(this.scrapedProperties.values()).filter(\n      property => property.scrapingJobId === scrapingJobId\n    );\n  }\n\n  async getAllScrapedCompetitors(): Promise<ScrapedProperty[]> {\n    const allProperties = Array.from(this.scrapedProperties.values());\n    \n    // First ensure we have a subject property marked\n    const subjectProperty = await this.getSubjectScrapedProperty();\n    \n    // Filter out the subject property to get only competitors\n    const competitors = allProperties.filter(\n      property => property.isSubjectProperty !== true\n    );\n    \n    console.log('[STORAGE] getAllScrapedCompetitors: Found', competitors.length, 'competitor properties');\n    return competitors;\n  }\n\n  async getSelectedScrapedProperties(ids: string[]): Promise<ScrapedProperty[]> {\n    return ids.map(id => this.scrapedProperties.get(id)).filter(Boolean) as ScrapedProperty[];\n  }\n\n  async updateScrapedProperty(id: string, updates: Partial<ScrapedProperty>): Promise<ScrapedProperty | undefined> {\n    const property = this.scrapedProperties.get(id);\n    if (!property) return undefined;\n    \n    const updatedProperty = { ...property, ...updates };\n    this.scrapedProperties.set(id, updatedProperty);\n    return updatedProperty;\n  }\n\n  async createScrapedUnit(insertUnit: InsertScrapedUnit): Promise<ScrapedUnit> {\n    const id = randomUUID();\n    const unit: ScrapedUnit = { \n      ...insertUnit, \n      id, \n      createdAt: new Date(),\n      squareFootage: insertUnit.squareFootage ?? null,\n      status: insertUnit.status ?? null,\n      unitNumber: insertUnit.unitNumber ?? null,\n      floorPlanName: insertUnit.floorPlanName ?? null,\n      bedrooms: insertUnit.bedrooms ?? null,\n      bathrooms: insertUnit.bathrooms ?? null,\n      rent: insertUnit.rent ?? null,\n      availabilityDate: insertUnit.availabilityDate ?? null\n    };\n    this.scrapedUnits.set(id, unit);\n    return unit;\n  }\n\n  async getScrapedUnitsByProperty(propertyId: string): Promise<ScrapedUnit[]> {\n    return Array.from(this.scrapedUnits.values()).filter(\n      unit => unit.propertyId === propertyId\n    );\n  }\n\n  async getSubjectScrapedProperty(): Promise<ScrapedProperty | null> {\n    const allProperties = Array.from(this.scrapedProperties.values());\n    console.log('[STORAGE] getSubjectScrapedProperty: Total scraped properties:', allProperties.length);\n    \n    const subjectProperty = allProperties.find(\n      property => property.isSubjectProperty === true\n    );\n    \n    if (subjectProperty) {\n      console.log('[STORAGE] ‚úÖ Found subject property:', subjectProperty.name);\n      console.log('[STORAGE] Subject property ID:', subjectProperty.id);\n      console.log('[STORAGE] Subject property URL:', subjectProperty.url);\n    } else {\n      console.log('[STORAGE] ‚ö†Ô∏è No subject property found with isSubjectProperty === true');\n      console.log('[STORAGE] Properties with isSubjectProperty flag:');\n      allProperties.forEach(p => {\n        console.log(`[STORAGE]   - ${p.name}: isSubjectProperty = ${p.isSubjectProperty}`);\n      });\n      \n      // FALLBACK: If no subject property is marked but we have properties, mark the first one\n      if (allProperties.length > 0) {\n        console.log('[STORAGE] Applying emergency fallback - marking first property as subject');\n        const firstProperty = allProperties[0];\n        firstProperty.isSubjectProperty = true;\n        this.scrapedProperties.set(firstProperty.id, firstProperty);\n        console.log('[STORAGE] ‚úÖ Emergency fallback: Marked', firstProperty.name, 'as subject');\n        return firstProperty;\n      }\n    }\n    \n    return subjectProperty || null;\n  }\n\n  async getScrapedProperty(id: string): Promise<ScrapedProperty | undefined> {\n    return this.scrapedProperties.get(id);\n  }\n\n  async getOriginalPropertyIdFromScraped(scrapedPropertyId: string): Promise<string | null> {\n    const scrapedProperty = await this.getScrapedProperty(scrapedPropertyId);\n    if (!scrapedProperty) return null;\n    \n    // Get the scraping job associated with this scraped property\n    const scrapingJob = await this.getScrapingJob(scrapedProperty.scrapingJobId);\n    if (!scrapingJob) return null;\n    \n    // Return the original property ID from the scraping job\n    return scrapingJob.propertyId;\n  }\n\n  async clearScrapedPropertiesCache(): Promise<void> {\n    console.log('[STORAGE] Clearing scraped properties cache');\n    console.log('[STORAGE] Before clear - scraped properties count:', this.scrapedProperties.size);\n    console.log('[STORAGE] Before clear - scraped units count:', this.scrapedUnits.size);\n    console.log('[STORAGE] Before clear - scraping jobs count:', this.scrapingJobs.size);\n    \n    // Clear scraped properties and units\n    this.scrapedProperties.clear();\n    this.scrapedUnits.clear();\n    \n    // Also clear scraping jobs to start fresh\n    this.scrapingJobs.clear();\n    \n    console.log('[STORAGE] After clear - scraped properties count:', this.scrapedProperties.size);\n    console.log('[STORAGE] After clear - scraped units count:', this.scrapedUnits.size);\n    console.log('[STORAGE] After clear - scraping jobs count:', this.scrapingJobs.size);\n    console.log('[STORAGE] ‚úÖ Scraped properties cache cleared successfully');\n  }\n\n  async getFilteredScrapedUnits(criteria: FilterCriteria): Promise<ScrapedUnit[]> {\n    let units = Array.from(this.scrapedUnits.values());\n    console.log('[FILTER] Starting with', units.length, 'total units');\n    \n    // Log sample unit data for debugging\n    if (units.length > 0) {\n      console.log('[FILTER] Sample unit data:');\n      const sampleUnit = units[0];\n      console.log('[FILTER]   Unit Type:', sampleUnit.unitType);\n      console.log('[FILTER]   Bedrooms:', sampleUnit.bedrooms);\n      console.log('[FILTER]   Rent:', sampleUnit.rent);\n      console.log('[FILTER]   Status:', sampleUnit.status);\n      console.log('[FILTER]   Square Footage:', sampleUnit.squareFootage);\n    }\n\n    // Filter by bedroom types\n    if (criteria.bedroomTypes.length > 0) {\n      const beforeCount = units.length;\n      units = units.filter(unit => {\n        if (criteria.bedroomTypes.includes(\"Studio\") && (unit.bedrooms === 0 || unit.unitType.toLowerCase().includes(\"studio\"))) return true;\n        if (criteria.bedroomTypes.includes(\"1BR\") && unit.bedrooms === 1) return true;\n        if (criteria.bedroomTypes.includes(\"2BR\") && unit.bedrooms === 2) return true;\n        if (criteria.bedroomTypes.includes(\"3BR\") && unit.bedrooms === 3) return true;\n        return false;\n      });\n      console.log('[FILTER] After bedroom filter:', units.length, 'units (filtered out', beforeCount - units.length, ')');\n    } else {\n      console.log('[FILTER] No bedroom filter applied - keeping all', units.length, 'units');\n    }\n\n    // Filter by price range\n    const beforePriceCount = units.length;\n    units = units.filter(unit => {\n      if (!unit.rent) {\n        console.log('[FILTER] Unit has no rent value, including anyway for wide filter');\n        return true; // Include units without rent data when using wide ranges\n      }\n      // Handle rent values that may be strings with formatting (e.g., \"$1,234\" or \"1234\")\n      let rentValue: number;\n      const rentStr = unit.rent.toString();\n      \n      // Remove dollar signs, commas, and other non-numeric characters\n      const cleanedRent = rentStr.replace(/[$,]/g, '').trim();\n      rentValue = parseFloat(cleanedRent);\n      \n      if (isNaN(rentValue)) {\n        console.log('[FILTER] Could not parse rent value:', rentStr, '-> cleaned:', cleanedRent, '- including anyway');\n        return true; // Include units we can't parse for wide filter\n      }\n      \n      const inRange = rentValue >= criteria.priceRange.min && rentValue <= criteria.priceRange.max;\n      if (!inRange) {\n        console.log('[FILTER] Unit rent', rentValue, 'outside range', criteria.priceRange.min, '-', criteria.priceRange.max);\n      }\n      return inRange;\n    });\n    console.log('[FILTER] After price filter (', criteria.priceRange.min, '-', criteria.priceRange.max, '):', units.length, 'units (filtered out', beforePriceCount - units.length, ')');\n\n    // Filter by square footage range\n    const beforeSqFtCount = units.length;\n    units = units.filter(unit => {\n      if (!unit.squareFootage) {\n        console.log('[FILTER] Unit has no square footage, including anyway');\n        return true; // Keep units without sq ft data\n      }\n      const inRange = unit.squareFootage >= criteria.squareFootageRange.min && unit.squareFootage <= criteria.squareFootageRange.max;\n      if (!inRange) {\n        console.log('[FILTER] Unit sq ft', unit.squareFootage, 'outside range', criteria.squareFootageRange.min, '-', criteria.squareFootageRange.max);\n      }\n      return inRange;\n    });\n    console.log('[FILTER] After square footage filter:', units.length, 'units (filtered out', beforeSqFtCount - units.length, ')');\n\n    // Filter by availability - flexible matching for various status formats\n    const beforeAvailabilityCount = units.length;\n    console.log('[FILTER] Availability filter:', criteria.availability);\n    \n    if (criteria.availability === \"now\") {\n      units = units.filter(unit => {\n        if (!unit.status) {\n          console.log('[FILTER] Unit has no status, excluding from \"now\" filter');\n          return false;\n        }\n        const status = unit.status.toLowerCase();\n        // Match: \"available\", \"now\", \"available immediately\", etc.\n        const matches = status === \"available\" || \n                       status === \"now\" || \n                       status.includes(\"available\") ||\n                       status.includes(\"immediate\");\n        if (!matches) {\n          console.log('[FILTER] Status \"' + unit.status + '\" does not match \"now\" criteria');\n        }\n        return matches;\n      });\n    } else if (criteria.availability === \"30days\") {\n      units = units.filter(unit => {\n        if (!unit.status) {\n          console.log('[FILTER] Unit has no status, excluding from \"30days\" filter');\n          return false;\n        }\n        const status = unit.status.toLowerCase();\n        // Include units available now or within ~30 days\n        // Match: \"available\", \"now\", \"available oct 7\", \"available sep 28\", etc.\n        const matches = status === \"available\" || \n                       status === \"now\" || \n                       status === \"pending\" ||\n                       status.includes(\"available\") ||\n                       status.includes(\"immediate\") ||\n                       !status.includes(\"occupied\"); // Include anything not explicitly occupied\n        if (!matches) {\n          console.log('[FILTER] Status \"' + unit.status + '\" does not match \"30days\" criteria');\n        }\n        return matches;\n      });\n    } else if (criteria.availability === \"60days\") {\n      // For 60days, include ALL units regardless of status for maximum visibility\n      console.log('[FILTER] 60days filter - including all units regardless of status');\n      // Don't filter anything - keep all units\n    }\n    \n    console.log('[FILTER] After availability filter:', units.length, 'units (filtered out', beforeAvailabilityCount - units.length, ')');\n\n    // Advanced filters (simplified implementation since scraped data may not have all details)\n    \n    // Filter by amenities - would need property-level amenities data\n    if (criteria.amenities && criteria.amenities.length > 0) {\n      // For demo: simulate by filtering based on price ranges (higher price = more amenities)\n      // In production, you'd match against actual property amenities\n      const avgRent = units.reduce((sum, u) => sum + (u.rent ? parseFloat(u.rent.toString()) : 0), 0) / units.length || 0;\n      if (criteria.amenities.includes(\"gym\") || criteria.amenities.includes(\"pool\")) {\n        // Premium amenities typically in higher-priced units\n        units = units.filter(unit => {\n          const rent = unit.rent ? parseFloat(unit.rent.toString()) : 0;\n          return rent >= avgRent * 0.9; // Keep units in upper price tier\n        });\n      }\n    }\n\n    // Filter by lease terms - would need actual lease data\n    if (criteria.leaseTerms && criteria.leaseTerms.length > 0) {\n      // Simplified: month-to-month typically has higher rent\n      if (criteria.leaseTerms.includes(\"month_to_month\")) {\n        // Keep all units for now - in production would filter by actual lease terms\n      }\n    }\n\n    // Filter by floor level - would need actual floor data\n    if (criteria.floorLevel) {\n      // Simplified: top floors typically have higher rent\n      if (criteria.floorLevel === \"top\") {\n        const sortedByRent = [...units].sort((a, b) => {\n          const rentA = a.rent ? parseFloat(a.rent.toString()) : 0;\n          const rentB = b.rent ? parseFloat(b.rent.toString()) : 0;\n          return rentB - rentA;\n        });\n        // Keep top 70% by price as proxy for upper floors\n        const cutoff = Math.floor(sortedByRent.length * 0.3);\n        if (cutoff > 0) {\n          units = sortedByRent.slice(0, -cutoff);\n        }\n      }\n    }\n\n    // Filter by renovation status - would need actual renovation data\n    if (criteria.renovationStatus) {\n      // Simplified: newly renovated units typically have higher rent\n      if (criteria.renovationStatus === \"newly_renovated\") {\n        const avgRent = units.reduce((sum, u) => sum + (u.rent ? parseFloat(u.rent.toString()) : 0), 0) / units.length || 0;\n        units = units.filter(unit => {\n          const rent = unit.rent ? parseFloat(unit.rent.toString()) : 0;\n          return rent >= avgRent * 1.1; // Keep units 10% above average\n        });\n      }\n    }\n\n    return units;\n  }\n\n  async generateFilteredAnalysis(propertyId: string, criteria: FilterCriteria): Promise<FilteredAnalysis> {\n    // Get filtered units from all properties for comparison\n    const allFilteredUnits = await this.getFilteredScrapedUnits(criteria);\n    \n    // Get subject property (look for isSubjectProperty flag)\n    const subjectProperty = await this.getSubjectScrapedProperty();\n    if (!subjectProperty) {\n      // Return a default analysis when no scraped data is available\n      return {\n        marketPosition: \"No Data Available\",\n        pricingPowerScore: 0,\n        competitiveAdvantages: [\"Scraping Required\"],\n        recommendations: [\"Please complete competitor scraping to generate analysis\"],\n        unitCount: 0,\n        avgRent: 0,\n        percentileRank: 0,\n        locationScore: 0,\n        amenityScore: 0,\n        pricePerSqFt: 0,\n        subjectUnits: [],\n        competitorUnits: [],\n        competitiveEdges: {\n          pricing: { edge: 0, label: \"No data\", status: \"neutral\" },\n          size: { edge: 0, label: \"No data\", status: \"neutral\" },\n          availability: { edge: 0, label: \"No data\", status: \"neutral\" },\n          amenities: { edge: 0, label: \"No data\", status: \"neutral\" }\n        },\n        aiInsights: [\n          \"Complete competitor property scraping to enable analysis\",\n          \"Add competitor properties from the Summarize page\",\n          \"Analysis requires unit-level data from apartments.com\"\n        ],\n        subjectAvgRent: 0,\n        competitorAvgRent: 0,\n        subjectAvgSqFt: 0,\n        competitorAvgSqFt: 0\n      };\n    }\n    \n    // Separate subject and competitor units\n    const subjectUnits = allFilteredUnits.filter(unit => unit.propertyId === subjectProperty.id);\n    const competitorUnits = allFilteredUnits.filter(unit => unit.propertyId !== subjectProperty.id);\n    \n    // Get property details for unit comparisons\n    const propertyMap = new Map<string, ScrapedProperty>();\n    for (const prop of Array.from(this.scrapedProperties.values())) {\n      propertyMap.set(prop.id, prop);\n    }\n    \n    // Convert to UnitComparison format\n    const formatUnit = (unit: ScrapedUnit, isSubject: boolean): UnitComparison => {\n      const property = propertyMap.get(unit.propertyId);\n      return {\n        unitId: unit.id,\n        propertyName: property?.name || \"Unknown\",\n        unitType: unit.unitType,\n        bedrooms: unit.bedrooms || 0,\n        bathrooms: unit.bathrooms ? parseFloat(unit.bathrooms.toString()) : null,\n        squareFootage: unit.squareFootage,\n        rent: unit.rent ? parseFloat(unit.rent.toString()) : 0,\n        isSubject,\n        availabilityDate: unit.availabilityDate || undefined\n      };\n    };\n    \n    const subjectUnitsFormatted = subjectUnits.map(u => formatUnit(u, true));\n    const competitorUnitsFormatted = competitorUnits.map(u => formatUnit(u, false));\n    \n    // Calculate averages for subject and competitors\n    const calcAverage = (units: UnitComparison[], field: 'rent' | 'squareFootage') => {\n      if (units.length === 0) return 0;\n      const sum = units.reduce((acc, unit) => {\n        const value = unit[field];\n        return acc + (value || 0);\n      }, 0);\n      return sum / units.length;\n    };\n    \n    const subjectAvgRent = calcAverage(subjectUnitsFormatted, 'rent');\n    const competitorAvgRent = calcAverage(competitorUnitsFormatted, 'rent');\n    const subjectAvgSqFt = calcAverage(subjectUnitsFormatted, 'squareFootage');\n    const competitorAvgSqFt = calcAverage(competitorUnitsFormatted, 'squareFootage');\n    \n    // Calculate true percentile rank based on competitor rents\n    const competitorRents = competitorUnitsFormatted\n      .map(u => u.rent)\n      .filter(r => r > 0)\n      .sort((a, b) => a - b);\n    \n    let percentileRank = 50;\n    if (competitorRents.length > 0 && subjectAvgRent > 0) {\n      const belowCount = competitorRents.filter(r => r < subjectAvgRent).length;\n      percentileRank = Math.round((belowCount / competitorRents.length) * 100);\n    }\n    \n    // Calculate competitive edges\n    const pricingEdge = competitorAvgRent > 0 ? ((subjectAvgRent - competitorAvgRent) / competitorAvgRent) * 100 : 0;\n    const sizeEdge = competitorAvgSqFt > 0 ? subjectAvgSqFt - competitorAvgSqFt : 0;\n    const availabilityEdge = subjectUnits.filter(u => u.status === 'available').length - \n                            competitorUnits.filter(u => u.status === 'available').length;\n    const amenityScore = percentileRank > 60 ? 75 : percentileRank > 40 ? 50 : 25;\n    \n    const competitiveEdges: CompetitiveEdges = {\n      pricing: {\n        edge: Math.round(pricingEdge * 10) / 10,\n        label: pricingEdge > 0 ? `+${Math.abs(Math.round(pricingEdge))}% above market` : \n               pricingEdge < 0 ? `${Math.abs(Math.round(pricingEdge))}% below market` : \"At market rate\",\n        status: pricingEdge > 10 ? \"disadvantage\" as const : pricingEdge < -10 ? \"advantage\" as const : \"neutral\" as const\n      },\n      size: {\n        edge: Math.round(sizeEdge),\n        label: sizeEdge > 0 ? `+${Math.round(sizeEdge)} sq ft larger` : \n               sizeEdge < 0 ? `${Math.abs(Math.round(sizeEdge))} sq ft smaller` : \"Similar size\",\n        status: sizeEdge > 50 ? \"advantage\" as const : sizeEdge < -50 ? \"disadvantage\" as const : \"neutral\" as const\n      },\n      availability: {\n        edge: availabilityEdge,\n        label: availabilityEdge > 0 ? `${availabilityEdge} more units available` : \n               availabilityEdge < 0 ? `${Math.abs(availabilityEdge)} fewer units available` : \"Similar availability\",\n        status: availabilityEdge > 2 ? \"advantage\" as const : availabilityEdge < -2 ? \"disadvantage\" as const : \"neutral\" as const\n      },\n      amenities: {\n        edge: amenityScore,\n        label: amenityScore > 60 ? \"Premium amenities\" : amenityScore > 40 ? \"Standard amenities\" : \"Basic amenities\",\n        status: amenityScore > 60 ? \"advantage\" as const : amenityScore < 40 ? \"disadvantage\" as const : \"neutral\" as const\n      }\n    };\n    \n    // Generate pricing power score\n    const pricingPowerScore = Math.min(100, Math.max(0, \n      percentileRank + \n      (competitiveEdges.size.status === \"advantage\" ? 10 : competitiveEdges.size.status === \"disadvantage\" ? -10 : 0) +\n      (competitiveEdges.amenities.status === \"advantage\" ? 5 : competitiveEdges.amenities.status === \"disadvantage\" ? -5 : 0)\n    ));\n    \n    // Generate dynamic competitive advantages\n    const competitiveAdvantages = [];\n    if (percentileRank > 75) competitiveAdvantages.push(\"Premium market positioning\");\n    if (competitiveEdges.size.status === \"advantage\") competitiveAdvantages.push(\"Larger than average units\");\n    if (competitiveEdges.pricing.status === \"advantage\") competitiveAdvantages.push(\"Competitive pricing advantage\");\n    if (competitiveEdges.availability.status === \"advantage\") competitiveAdvantages.push(\"Higher unit availability\");\n    if (competitiveEdges.amenities.status === \"advantage\") competitiveAdvantages.push(\"Superior amenity package\");\n    \n    // Generate dynamic recommendations\n    const recommendations = [];\n    if (percentileRank < 30) recommendations.push(\"Consider reviewing pricing strategy to better align with market\");\n    if (competitiveEdges.size.status === \"disadvantage\") recommendations.push(\"Highlight other value propositions to offset smaller unit sizes\");\n    if (competitiveEdges.pricing.status === \"disadvantage\") recommendations.push(\"Ensure premium pricing is justified by superior amenities or location\");\n    if (competitiveEdges.availability.status === \"disadvantage\") recommendations.push(\"Limited availability may support premium pricing strategy\");\n    if (recommendations.length === 0) recommendations.push(\"Maintain current competitive positioning\");\n    \n    // Generate market position description\n    let marketPosition = \"Market Average\";\n    if (percentileRank > 75) marketPosition = \"Premium Market Leader\";\n    else if (percentileRank > 50) marketPosition = \"Above Market Average\";\n    else if (percentileRank > 25) marketPosition = \"Below Market Average\";\n    else marketPosition = \"Value Market Position\";\n    \n    // Generate AI insights (placeholder - will be replaced with OpenAI)\n    const aiInsights = [\n      `Your property ranks in the ${percentileRank}th percentile for this filter criteria`,\n      competitiveEdges.pricing.status === \"advantage\" ? \n        \"Your pricing provides strong competitive advantage in the current market\" :\n        competitiveEdges.pricing.status === \"disadvantage\" ?\n        \"Consider reviewing pricing strategy to improve market competitiveness\" :\n        \"Your pricing aligns well with market expectations\",\n      subjectUnitsFormatted.length > 0 ?\n        `With ${subjectUnitsFormatted.length} units matching filters, you have ${subjectUnitsFormatted.length > 5 ? 'strong' : 'limited'} inventory in this segment` :\n        \"No units match the current filter criteria - consider expanding criteria\"\n    ];\n    \n    return {\n      marketPosition,\n      pricingPowerScore,\n      competitiveAdvantages,\n      recommendations,\n      unitCount: subjectUnitsFormatted.length,\n      avgRent: Math.round(subjectAvgRent),\n      percentileRank,\n      locationScore: Math.min(100, Math.max(0, percentileRank + 5)),\n      amenityScore: Math.min(100, Math.max(0, amenityScore)),\n      pricePerSqFt: subjectAvgSqFt > 0 ? Math.round((subjectAvgRent / subjectAvgSqFt) * 100) / 100 : 0,\n      // New fields\n      subjectUnits: subjectUnitsFormatted,\n      competitorUnits: competitorUnitsFormatted,\n      competitiveEdges,\n      aiInsights,\n      subjectAvgRent: Math.round(subjectAvgRent),\n      competitorAvgRent: Math.round(competitorAvgRent),\n      subjectAvgSqFt: Math.round(subjectAvgSqFt),\n      competitorAvgSqFt: Math.round(competitorAvgSqFt)\n    };\n  }\n\n  // Workflow State Management\n  async getWorkflowState(propertyId: string): Promise<WorkflowState | null> {\n    return this.workflowStates.get(propertyId) || null;\n  }\n\n  async saveWorkflowState(state: WorkflowState): Promise<WorkflowState> {\n    this.workflowStates.set(state.propertyId, state);\n    return state;\n  }\n}\n\nexport const storage = new MemStorage();\n","size_bytes":34714},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, decimal, boolean, json, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const properties = pgTable(\"properties\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  address: text(\"address\").notNull(),\n  propertyName: text(\"property_name\").notNull(),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  propertyType: text(\"property_type\"),\n  totalUnits: integer(\"total_units\"),\n  builtYear: integer(\"built_year\"),\n  squareFootage: integer(\"square_footage\"),\n  parkingSpaces: integer(\"parking_spaces\"),\n  amenities: json(\"amenities\").$type<string[]>().default([]),\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\nexport const propertyAnalysis = pgTable(\"property_analysis\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  propertyId: varchar(\"property_id\").references(() => properties.id).notNull(),\n  marketPosition: text(\"market_position\").notNull(),\n  competitiveAdvantages: json(\"competitive_advantages\").$type<string[]>().notNull(),\n  pricingInsights: text(\"pricing_insights\").notNull(),\n  recommendations: json(\"recommendations\").$type<string[]>().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\nexport const competitorProperties = pgTable(\"competitor_properties\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  address: text(\"address\").notNull(),\n  distance: decimal(\"distance\", { precision: 5, scale: 2 }).notNull(),\n  priceRange: text(\"price_range\").notNull(),\n  totalUnits: integer(\"total_units\").notNull(),\n  builtYear: integer(\"built_year\").notNull(),\n  amenities: json(\"amenities\").$type<string[]>().notNull().default([]),\n  matchScore: decimal(\"match_score\", { precision: 5, scale: 2 }).notNull(),\n  vacancyRate: decimal(\"vacancy_rate\", { precision: 5, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\nexport const propertyUnits = pgTable(\"property_units\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  propertyId: varchar(\"property_id\").references(() => properties.id).notNull(),\n  unitNumber: text(\"unit_number\").notNull(),\n  unitType: text(\"unit_type\").notNull(),\n  currentRent: decimal(\"current_rent\", { precision: 10, scale: 2 }).notNull(),\n  recommendedRent: decimal(\"recommended_rent\", { precision: 10, scale: 2 }),\n  status: text(\"status\").notNull().default(\"occupied\"), // vacant, occupied, notice_given\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\nexport const optimizationReports = pgTable(\"optimization_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  propertyId: varchar(\"property_id\").references(() => properties.id).notNull(),\n  goal: text(\"goal\").notNull(),\n  riskTolerance: text(\"risk_tolerance\").notNull(),\n  timeline: text(\"timeline\").notNull(),\n  totalIncrease: decimal(\"total_increase\", { precision: 10, scale: 2 }).notNull(),\n  affectedUnits: integer(\"affected_units\").notNull(),\n  avgIncrease: decimal(\"avg_increase\", { precision: 5, scale: 2 }).notNull(),\n  riskLevel: text(\"risk_level\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\n// Scrapezy scraping jobs and cached data\nexport const scrapingJobs = pgTable(\"scraping_jobs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  propertyId: varchar(\"property_id\").references(() => properties.id).notNull(),\n  stage: text(\"stage\").notNull(), // \"city_discovery\" or \"unit_details\"\n  cityUrl: text(\"city_url\").notNull(),\n  scrapezyJobId: text(\"scrapezy_job_id\"),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, processing, completed, failed\n  results: json(\"results\").$type<any>(),\n  errorMessage: text(\"error_message\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\")\n});\n\nexport const scrapedProperties = pgTable(\"scraped_properties\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  scrapingJobId: varchar(\"scraping_job_id\").references(() => scrapingJobs.id).notNull(),\n  name: text(\"name\").notNull(),\n  address: text(\"address\").notNull(),\n  url: text(\"url\").notNull(),\n  distance: decimal(\"distance\", { precision: 5, scale: 2 }),\n  isSubjectProperty: boolean(\"is_subject_property\").default(false),\n  matchScore: decimal(\"match_score\", { precision: 5, scale: 2 }),\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\nexport const scrapedUnits = pgTable(\"scraped_units\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  propertyId: varchar(\"property_id\").references(() => scrapedProperties.id).notNull(),\n  unitNumber: text(\"unit_number\"),\n  floorPlanName: text(\"floor_plan_name\"),\n  unitType: text(\"unit_type\").notNull(),\n  bedrooms: integer(\"bedrooms\"),\n  bathrooms: decimal(\"bathrooms\", { precision: 3, scale: 1 }),\n  squareFootage: integer(\"square_footage\"),\n  rent: decimal(\"rent\", { precision: 10, scale: 2 }),\n  availabilityDate: text(\"availability_date\"),\n  status: text(\"status\").default(\"available\"), // available, occupied, pending\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\nexport const insertPropertySchema = createInsertSchema(properties).omit({ id: true, createdAt: true });\nexport const insertPropertyAnalysisSchema = createInsertSchema(propertyAnalysis).omit({ id: true, createdAt: true });\nexport const insertCompetitorPropertySchema = createInsertSchema(competitorProperties).omit({ id: true, createdAt: true });\nexport const insertPropertyUnitSchema = createInsertSchema(propertyUnits).omit({ id: true, createdAt: true });\nexport const insertOptimizationReportSchema = createInsertSchema(optimizationReports).omit({ id: true, createdAt: true });\nexport const insertScrapingJobSchema = createInsertSchema(scrapingJobs).omit({ id: true, createdAt: true, completedAt: true });\nexport const insertScrapedPropertySchema = createInsertSchema(scrapedProperties).omit({ id: true, createdAt: true });\nexport const insertScrapedUnitSchema = createInsertSchema(scrapedUnits).omit({ id: true, createdAt: true });\n\nexport type Property = typeof properties.$inferSelect;\nexport type InsertProperty = z.infer<typeof insertPropertySchema>;\nexport type PropertyAnalysis = typeof propertyAnalysis.$inferSelect;\nexport type InsertPropertyAnalysis = z.infer<typeof insertPropertyAnalysisSchema>;\nexport type CompetitorProperty = typeof competitorProperties.$inferSelect;\nexport type InsertCompetitorProperty = z.infer<typeof insertCompetitorPropertySchema>;\nexport type PropertyUnit = typeof propertyUnits.$inferSelect;\nexport type InsertPropertyUnit = z.infer<typeof insertPropertyUnitSchema>;\nexport type OptimizationReport = typeof optimizationReports.$inferSelect;\nexport type InsertOptimizationReport = z.infer<typeof insertOptimizationReportSchema>;\nexport type ScrapingJob = typeof scrapingJobs.$inferSelect;\nexport type InsertScrapingJob = z.infer<typeof insertScrapingJobSchema>;\nexport type ScrapedProperty = typeof scrapedProperties.$inferSelect;\nexport type InsertScrapedProperty = z.infer<typeof insertScrapedPropertySchema>;\nexport type ScrapedUnit = typeof scrapedUnits.$inferSelect;\nexport type InsertScrapedUnit = z.infer<typeof insertScrapedUnitSchema>;\n\n// Filter criteria and analysis schemas\nexport const filterCriteriaSchema = z.object({\n  bedroomTypes: z.array(z.enum([\"Studio\", \"1BR\", \"2BR\", \"3BR\"])).default([]),\n  priceRange: z.object({\n    min: z.number().min(0),\n    max: z.number().min(0)\n  }),\n  availability: z.enum([\"now\", \"30days\", \"60days\"]).default(\"now\"),\n  squareFootageRange: z.object({\n    min: z.number().min(0),\n    max: z.number().min(0)\n  }),\n  // Advanced filters\n  amenities: z.array(z.enum([\"in_unit_laundry\", \"parking\", \"gym\", \"pool\", \"pet_friendly\"])).optional(),\n  leaseTerms: z.array(z.enum([\"6_month\", \"12_month\", \"month_to_month\"])).optional(),\n  floorLevel: z.enum([\"ground\", \"mid\", \"top\"]).optional(),\n  renovationStatus: z.enum([\"newly_renovated\", \"updated\", \"original\"]).optional()\n});\n\n// Unit comparison data for visualization\nexport const unitComparisonSchema = z.object({\n  unitId: z.string(),\n  propertyName: z.string(),\n  unitType: z.string(),\n  bedrooms: z.number(),\n  bathrooms: z.number().nullable(),\n  squareFootage: z.number().nullable(),\n  rent: z.number(),\n  isSubject: z.boolean(),\n  availabilityDate: z.string().optional()\n});\n\n// Competitive edge analysis\nexport const competitiveEdgesSchema = z.object({\n  pricing: z.object({\n    edge: z.number(), // percentage difference from market\n    label: z.string(), // e.g., \"+5% above market\"\n    status: z.enum([\"advantage\", \"neutral\", \"disadvantage\"])\n  }),\n  size: z.object({\n    edge: z.number(), // sq ft difference\n    label: z.string(), // e.g., \"+120 sq ft larger\"\n    status: z.enum([\"advantage\", \"neutral\", \"disadvantage\"])\n  }),\n  availability: z.object({\n    edge: z.number(), // days difference\n    label: z.string(), // e.g., \"2 days faster\"\n    status: z.enum([\"advantage\", \"neutral\", \"disadvantage\"])\n  }),\n  amenities: z.object({\n    edge: z.number(), // score difference\n    label: z.string(), // e.g., \"Premium amenities\"\n    status: z.enum([\"advantage\", \"neutral\", \"disadvantage\"])\n  })\n});\n\nexport const filteredAnalysisSchema = z.object({\n  marketPosition: z.string(),\n  pricingPowerScore: z.number().min(0).max(100),\n  competitiveAdvantages: z.array(z.string()),\n  recommendations: z.array(z.string()),\n  unitCount: z.number().min(0),\n  avgRent: z.number().min(0),\n  percentileRank: z.number().min(0).max(100),\n  locationScore: z.number().min(0).max(100),\n  amenityScore: z.number().min(0).max(100),\n  pricePerSqFt: z.number().min(0),\n  // New fields for enhanced analysis\n  subjectUnits: z.array(unitComparisonSchema),\n  competitorUnits: z.array(unitComparisonSchema),\n  competitiveEdges: competitiveEdgesSchema,\n  aiInsights: z.array(z.string()),\n  subjectAvgRent: z.number(),\n  competitorAvgRent: z.number(),\n  subjectAvgSqFt: z.number(),\n  competitorAvgSqFt: z.number()\n});\n\nexport type FilterCriteria = z.infer<typeof filterCriteriaSchema>;\nexport type UnitComparison = z.infer<typeof unitComparisonSchema>;\nexport type CompetitiveEdges = z.infer<typeof competitiveEdgesSchema>;\nexport type FilteredAnalysis = z.infer<typeof filteredAnalysisSchema>;\n","size_bytes":10301},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport Sidebar from \"@/components/layout/sidebar\";\nimport Header from \"@/components/layout/header\";\nimport PropertyInput from \"@/pages/property-input\";\nimport Summarize from \"@/pages/summarize\";\nimport Analyze from \"@/pages/analyze\";\nimport Optimize from \"@/pages/optimize\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={PropertyInput} />\n      <Route path=\"/summarize/:id\" component={Summarize} />\n      <Route path=\"/analyze/:id\" component={Analyze} />\n      <Route path=\"/optimize/:id\" component={Optimize} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <div className=\"flex min-h-screen\">\n          <Sidebar />\n          <div className=\"flex-1 flex flex-col\">\n            <Header />\n            <main className=\"flex-1 p-6 overflow-auto\">\n              <Router />\n            </main>\n          </div>\n        </div>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1376},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(210, 40%, 98%);\n  --foreground: hsl(222.2, 84%, 4.9%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(222.2, 84%, 4.9%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(222.2, 84%, 4.9%);\n  --primary: hsl(221.2, 83.2%, 53.3%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(210, 40%, 96%);\n  --secondary-foreground: hsl(222.2, 84%, 4.9%);\n  --muted: hsl(210, 40%, 96%);\n  --muted-foreground: hsl(215.4, 16.3%, 46.9%);\n  --accent: hsl(210, 40%, 96%);\n  --accent-foreground: hsl(222.2, 84%, 4.9%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(210, 40%, 98%);\n  --border: hsl(214.3, 31.8%, 91.4%);\n  --input: hsl(214.3, 31.8%, 91.4%);\n  --ring: hsl(221.2, 83.2%, 53.3%);\n  --chart-1: hsl(221.2, 83.2%, 53.3%);\n  --chart-2: hsl(212, 95%, 68%);\n  --chart-3: hsl(216, 92%, 60%);\n  --chart-4: hsl(210, 98%, 78%);\n  --chart-5: hsl(212, 97%, 87%);\n  --sidebar: hsl(0, 0%, 100%);\n  --sidebar-foreground: hsl(222.2, 84%, 4.9%);\n  --sidebar-primary: hsl(221.2, 83.2%, 53.3%);\n  --sidebar-primary-foreground: hsl(210, 40%, 98%);\n  --sidebar-accent: hsl(210, 40%, 96%);\n  --sidebar-accent-foreground: hsl(222.2, 84%, 4.9%);\n  --sidebar-border: hsl(214.3, 31.8%, 91.4%);\n  --sidebar-ring: hsl(221.2, 83.2%, 53.3%);\n  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 0.75rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00), 0px 1px 2px -1px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00), 0px 1px 2px -1px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00), 0px 2px 4px -1px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00), 0px 4px 6px -1px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00), 0px 8px 10px -1px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(221.2, 83.2%, 53.3% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n}\n\n.dark {\n  --background: hsl(0, 0%, 0%);\n  --foreground: hsl(200, 6.6667%, 91.1765%);\n  --card: hsl(228, 9.8039%, 10%);\n  --card-foreground: hsl(0, 0%, 85.0980%);\n  --popover: hsl(0, 0%, 0%);\n  --popover-foreground: hsl(200, 6.6667%, 91.1765%);\n  --primary: hsl(221.2, 83.2%, 53.3%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(195, 15.3846%, 94.9020%);\n  --secondary-foreground: hsl(222.2, 84%, 4.9%);\n  --muted: hsl(0, 0%, 9.4118%);\n  --muted-foreground: hsl(210, 3.3898%, 46.2745%);\n  --accent: hsl(205.7143, 70%, 7.8431%);\n  --accent-foreground: hsl(221.2, 83.2%, 53.3%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(210, 40%, 98%);\n  --border: hsl(210, 5.2632%, 14.9020%);\n  --input: hsl(207.6923, 27.6596%, 18.4314%);\n  --ring: hsl(221.2, 83.2%, 53.3%);\n  --chart-1: hsl(221.2, 83.2%, 53.3%);\n  --chart-2: hsl(212, 95%, 68%);\n  --chart-3: hsl(216, 92%, 60%);\n  --chart-4: hsl(210, 98%, 78%);\n  --chart-5: hsl(212, 97%, 87%);\n  --sidebar: hsl(228, 9.8039%, 10%);\n  --sidebar-foreground: hsl(0, 0%, 85.0980%);\n  --sidebar-primary: hsl(221.2, 83.2%, 53.3%);\n  --sidebar-primary-foreground: hsl(210, 40%, 98%);\n  --sidebar-accent: hsl(205.7143, 70%, 7.8431%);\n  --sidebar-accent-foreground: hsl(221.2, 83.2%, 53.3%);\n  --sidebar-border: hsl(205.7143, 15.7895%, 26.0784%);\n  --sidebar-ring: hsl(221.2, 83.2%, 53.3%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n.chart-bar {\n  transition: all 0.3s ease;\n}\n\n.chart-bar:hover {\n  opacity: 0.8;\n}\n\n.step-active {\n  background: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.step-completed {\n  background: hsl(142.1, 76.2%, 36.3%);\n  color: white;\n}\n\n.step-inactive {\n  background: var(--muted);\n  color: var(--muted-foreground);\n}\n","size_bytes":4129},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ai-analysis.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Download, ArrowRight, Clock } from \"lucide-react\";\nimport type { PropertyAnalysis } from \"@shared/schema\";\n\ninterface AIAnalysisProps {\n  analysis: PropertyAnalysis;\n  onContinue: () => void;\n}\n\nexport default function AIAnalysis({ analysis, onContinue }: AIAnalysisProps) {\n  return (\n    <div className=\"bg-card rounded-lg border border-border p-6\" data-testid=\"ai-analysis\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-xl font-semibold\" data-testid=\"analysis-title\">\n          OpenAI Property Analysis\n        </h3>\n        <div className=\"flex items-center text-sm text-muted-foreground\">\n          <Clock className=\"mr-1 h-4 w-4\" />\n          Generated just now\n        </div>\n      </div>\n      \n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className=\"space-y-4\">\n          <div className=\"p-4 bg-muted rounded-lg\" data-testid=\"market-position\">\n            <h4 className=\"font-semibold text-primary mb-2\">Market Position</h4>\n            <p className=\"text-sm text-muted-foreground\">\n              {analysis.marketPosition}\n            </p>\n          </div>\n          \n          <div className=\"p-4 bg-muted rounded-lg\" data-testid=\"competitive-advantages\">\n            <h4 className=\"font-semibold text-primary mb-2\">Competitive Advantages</h4>\n            <ul className=\"text-sm text-muted-foreground space-y-1\">\n              {analysis.competitiveAdvantages.map((advantage, index) => (\n                <li key={index}>‚Ä¢ {advantage}</li>\n              ))}\n            </ul>\n          </div>\n        </div>\n        \n        <div className=\"space-y-4\">\n          <div className=\"p-4 bg-muted rounded-lg\" data-testid=\"pricing-insights\">\n            <h4 className=\"font-semibold text-primary mb-2\">Pricing Insights</h4>\n            <p className=\"text-sm text-muted-foreground\">\n              {analysis.pricingInsights}\n            </p>\n          </div>\n          \n          <div className=\"p-4 bg-muted rounded-lg\" data-testid=\"recommendations\">\n            <h4 className=\"font-semibold text-primary mb-2\">Recommendations</h4>\n            <ul className=\"text-sm text-muted-foreground space-y-1\">\n              {analysis.recommendations.map((recommendation, index) => (\n                <li key={index}>‚Ä¢ {recommendation}</li>\n              ))}\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\" data-testid=\"status-notice\">\n        <div className=\"flex items-center\">\n          <div className=\"w-2 h-2 bg-blue-600 rounded-full mr-2 animate-pulse\"></div>\n          <span className=\"text-sm font-medium text-blue-800\">\n            Competitive analysis data is ready for review.\n          </span>\n        </div>\n      </div>\n\n      <div className=\"mt-6 flex justify-between\">\n        <Button variant=\"outline\" data-testid=\"button-download-analysis\">\n          <Download className=\"mr-2 h-4 w-4\" />\n          Download Analysis\n        </Button>\n        <Button onClick={onContinue} data-testid=\"button-continue-competitors\">\n          Continue to Competitor Selection\n          <ArrowRight className=\"ml-2 h-4 w-4\" />\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3296},"client/src/components/analysis-filters.tsx":{"content":"import { memo, useCallback, useMemo } from \"react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ChevronRight, Sparkles, DollarSign, Clock, RotateCcw } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\nimport type { FilterCriteria } from \"@shared/schema\";\n\ninterface AnalysisFiltersProps {\n  filters: FilterCriteria;\n  onFiltersChange: (filters: FilterCriteria) => void;\n}\n\nconst bedroomTypes = [\"Studio\", \"1BR\", \"2BR\", \"3BR\"] as const;\nconst availabilityOptions = [\n  { value: \"now\", label: \"Available Now\" },\n  { value: \"30days\", label: \"Within 30 Days\" },\n  { value: \"60days\", label: \"Within 60 Days\" }\n] as const;\n\nconst amenityOptions = [\n  { value: \"in_unit_laundry\", label: \"In-Unit Laundry\" },\n  { value: \"parking\", label: \"Parking Included\" },\n  { value: \"gym\", label: \"Gym/Fitness Center\" },\n  { value: \"pool\", label: \"Pool\" },\n  { value: \"pet_friendly\", label: \"Pet Friendly\" }\n] as const;\n\nconst leaseTermOptions = [\n  { value: \"6_month\", label: \"6 Month\" },\n  { value: \"12_month\", label: \"12 Month\" },\n  { value: \"month_to_month\", label: \"Month-to-Month\" }\n] as const;\n\nconst floorLevelOptions = [\n  { value: \"ground\", label: \"Ground Floor\" },\n  { value: \"mid\", label: \"Mid Level\" },\n  { value: \"top\", label: \"Top Floor\" }\n] as const;\n\nconst renovationStatusOptions = [\n  { value: \"newly_renovated\", label: \"Newly Renovated\" },\n  { value: \"updated\", label: \"Updated\" },\n  { value: \"original\", label: \"Original\" }\n] as const;\n\nconst AnalysisFilters = memo(({ \n  filters, \n  onFiltersChange\n}: AnalysisFiltersProps) => {\n  // Memoize advanced filters count\n  const advancedFiltersCount = useMemo(() => \n    (filters.amenities?.length || 0) +\n    (filters.leaseTerms?.length || 0) +\n    (filters.floorLevel ? 1 : 0) +\n    (filters.renovationStatus ? 1 : 0),\n    [filters.amenities, filters.leaseTerms, filters.floorLevel, filters.renovationStatus]\n  );\n\n  const handleBedroomChange = useCallback((bedroom: string, checked: boolean) => {\n    const newBedroomTypes = checked \n      ? [...filters.bedroomTypes, bedroom as any]\n      : filters.bedroomTypes.filter(type => type !== bedroom);\n    \n    onFiltersChange({\n      ...filters,\n      bedroomTypes: newBedroomTypes\n    });\n  }, [filters, onFiltersChange]);\n\n  const handlePriceRangeChange = useCallback((values: number[]) => {\n    onFiltersChange({\n      ...filters,\n      priceRange: { min: values[0], max: values[1] }\n    });\n  }, [filters, onFiltersChange]);\n\n  const handleSquareFootageChange = useCallback((values: number[]) => {\n    onFiltersChange({\n      ...filters,\n      squareFootageRange: { min: values[0], max: values[1] }\n    });\n  }, [filters, onFiltersChange]);\n\n  const handleAvailabilityChange = useCallback((value: string) => {\n    onFiltersChange({\n      ...filters,\n      availability: value as any\n    });\n  }, [filters, onFiltersChange]);\n\n  const handleAmenityChange = useCallback((amenity: string, checked: boolean) => {\n    const currentAmenities = filters.amenities || [];\n    const newAmenities = checked\n      ? [...currentAmenities, amenity as any]\n      : currentAmenities.filter(a => a !== amenity);\n    \n    onFiltersChange({\n      ...filters,\n      amenities: newAmenities.length > 0 ? newAmenities : undefined\n    });\n  }, [filters, onFiltersChange]);\n\n  const handleLeaseTermChange = useCallback((term: string, checked: boolean) => {\n    const currentTerms = filters.leaseTerms || [];\n    const newTerms = checked\n      ? [...currentTerms, term as any]\n      : currentTerms.filter(t => t !== term);\n    \n    onFiltersChange({\n      ...filters,\n      leaseTerms: newTerms.length > 0 ? newTerms : undefined\n    });\n  }, [filters, onFiltersChange]);\n\n  const handleFloorLevelChange = useCallback((value: string) => {\n    onFiltersChange({\n      ...filters,\n      floorLevel: value as any\n    });\n  }, [filters, onFiltersChange]);\n\n  const handleRenovationStatusChange = useCallback((value: string) => {\n    onFiltersChange({\n      ...filters,\n      renovationStatus: value as any\n    });\n  }, [filters, onFiltersChange]);\n\n  // Memoized preset handlers\n  const applyPremiumPreset = useCallback(() => {\n    onFiltersChange({\n      ...filters,\n      priceRange: { min: 2000, max: 5000 },  // Expanded upper range\n      bedroomTypes: [\"2BR\", \"3BR\"],\n      squareFootageRange: { min: 1000, max: 3000 }  // Expanded upper range\n    });\n  }, [filters, onFiltersChange]);\n\n  const applyEntryLevelPreset = useCallback(() => {\n    onFiltersChange({\n      ...filters,\n      priceRange: { min: 500, max: 1500 },  // Lowered minimum\n      bedroomTypes: [\"Studio\", \"1BR\"],\n      squareFootageRange: { min: 200, max: 800 }  // Lowered minimum\n    });\n  }, [filters, onFiltersChange]);\n\n  const applyHighTurnoverPreset = useCallback(() => {\n    onFiltersChange({\n      ...filters,\n      availability: \"now\",\n      leaseTerms: [\"month_to_month\", \"6_month\"]\n    });\n  }, [filters, onFiltersChange]);\n\n  const resetFilters = useCallback(() => {\n    onFiltersChange({\n      bedroomTypes: [],\n      priceRange: { min: 500, max: 5000 },  // Widened range to show all units\n      availability: \"60days\",  // Most inclusive option\n      squareFootageRange: { min: 200, max: 3000 },  // Expanded range\n      amenities: undefined,\n      leaseTerms: undefined,\n      floorLevel: undefined,\n      renovationStatus: undefined\n    });\n  }, [onFiltersChange]);\n\n  return (\n    <motion.div \n      className=\"w-full space-y-4\" \n      data-testid=\"analysis-filters\"\n      initial={{ opacity: 0, x: 20 }}\n      animate={{ opacity: 1, x: 0 }}\n      transition={{ duration: 0.3, delay: 0.1 }}\n    >\n      <Card className=\"border-border/50 shadow-sm hover:shadow-md transition-shadow\">\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-lg flex items-center justify-between\" data-testid=\"filters-title\">\n            <span>Filter Analysis</span>\n            {advancedFiltersCount > 0 && (\n              <Badge variant=\"secondary\" className=\"ml-2\">\n                {advancedFiltersCount} advanced\n              </Badge>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Filter Presets */}\n          <div className=\"space-y-3\" data-testid=\"filter-presets\">\n            <Label className=\"text-sm font-semibold\">Quick Presets</Label>\n            <TooltipProvider>\n              <div className=\"space-y-2\">\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        size=\"default\"\n                        onClick={applyPremiumPreset}\n                        className=\"justify-center text-xs h-9\"\n                        data-testid=\"preset-premium\"\n                      >\n                        <Sparkles className=\"mr-1 h-3 w-3\" />\n                        Premium\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>High-end units: $2000-$3000, 2-3BR, 1000-2000 sq ft</p>\n                    </TooltipContent>\n                  </Tooltip>\n\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        size=\"default\"\n                        onClick={applyEntryLevelPreset}\n                        className=\"justify-center text-xs h-9\"\n                        data-testid=\"preset-entry\"\n                      >\n                        <DollarSign className=\"mr-1 h-3 w-3\" />\n                        Entry Level\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>Affordable units: $500-$1500, Studio-1BR, 200-800 sq ft</p>\n                    </TooltipContent>\n                  </Tooltip>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        size=\"default\"\n                        onClick={applyHighTurnoverPreset}\n                        className=\"justify-center text-xs h-9\"\n                        data-testid=\"preset-turnover\"\n                      >\n                        <Clock className=\"mr-1 h-3 w-3\" />\n                        High Turn\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>Quick move-ins: Available now, flexible lease terms</p>\n                    </TooltipContent>\n                  </Tooltip>\n\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        size=\"default\"\n                        onClick={resetFilters}\n                        className=\"justify-center text-xs h-9\"\n                        data-testid=\"preset-clear\"\n                      >\n                        <RotateCcw className=\"mr-1 h-3 w-3\" />\n                        Clear All\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>Reset all filters to defaults</p>\n                    </TooltipContent>\n                  </Tooltip>\n                </div>\n              </div>\n            </TooltipProvider>\n          </div>\n\n          <Separator />\n\n          {/* Bedroom Type Filters */}\n          <div className=\"space-y-3\" data-testid=\"bedroom-filters\">\n            <Label className=\"text-sm font-semibold\">Unit Types</Label>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {bedroomTypes.map((type) => (\n                <div key={type} className=\"flex items-center space-x-2\" data-testid={`bedroom-filter-${type.toLowerCase()}`}>\n                  <Checkbox\n                    id={`bedroom-${type}`}\n                    checked={filters.bedroomTypes.includes(type)}\n                    onCheckedChange={(checked) => handleBedroomChange(type, checked as boolean)}\n                    data-testid={`checkbox-${type.toLowerCase()}`}\n                  />\n                  <Label \n                    htmlFor={`bedroom-${type}`} \n                    className=\"text-sm cursor-pointer\"\n                    data-testid={`label-${type.toLowerCase()}`}\n                  >\n                    {type}\n                  </Label>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* Price Range Slider */}\n          <div className=\"space-y-3\" data-testid=\"price-range-filter\">\n            <div className=\"flex justify-between items-center\">\n              <Label className=\"text-sm font-semibold\">Price Range</Label>\n              <span className=\"text-sm text-muted-foreground\" data-testid=\"price-range-display\">\n                ${filters.priceRange.min.toLocaleString()} - ${filters.priceRange.max.toLocaleString()}\n              </span>\n            </div>\n            <Slider\n              value={[filters.priceRange.min, filters.priceRange.max]}\n              onValueChange={handlePriceRangeChange}\n              max={5000}  // Expanded to show all units\n              min={500}   // Lowered to capture all units\n              step={50}\n              className=\"w-full\"\n              data-testid=\"slider-price-range\"\n            />\n            <div className=\"flex justify-between text-xs text-muted-foreground\">\n              <span>$500</span>\n              <span>$5,000</span>\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* Availability Filter */}\n          <div className=\"space-y-3\" data-testid=\"availability-filter\">\n            <Label className=\"text-sm font-semibold\">Availability</Label>\n            <RadioGroup \n              value={filters.availability} \n              onValueChange={handleAvailabilityChange}\n              data-testid=\"radiogroup-availability\"\n            >\n              {availabilityOptions.map((option) => (\n                <div key={option.value} className=\"flex items-center space-x-2\" data-testid={`availability-option-${option.value}`}>\n                  <RadioGroupItem \n                    value={option.value} \n                    id={option.value}\n                    data-testid={`radio-${option.value}`}\n                  />\n                  <Label \n                    htmlFor={option.value} \n                    className=\"text-sm cursor-pointer\"\n                    data-testid={`label-${option.value}`}\n                  >\n                    {option.label}\n                  </Label>\n                </div>\n              ))}\n            </RadioGroup>\n          </div>\n\n          <Separator />\n\n          {/* Square Footage Range Slider */}\n          <div className=\"space-y-3\" data-testid=\"sqft-range-filter\">\n            <div className=\"flex justify-between items-center\">\n              <Label className=\"text-sm font-semibold\">Square Footage</Label>\n              <span className=\"text-sm text-muted-foreground\" data-testid=\"sqft-range-display\">\n                {filters.squareFootageRange.min} - {filters.squareFootageRange.max} sq ft\n              </span>\n            </div>\n            <Slider\n              value={[filters.squareFootageRange.min, filters.squareFootageRange.max]}\n              onValueChange={handleSquareFootageChange}\n              max={3000}  // Expanded to capture luxury units\n              min={200}   // Lowered to include studios\n              step={25}\n              className=\"w-full\"\n              data-testid=\"slider-sqft-range\"\n            />\n            <div className=\"flex justify-between text-xs text-muted-foreground\">\n              <span>200 sq ft</span>\n              <span>3,000 sq ft</span>\n            </div>\n          </div>\n\n          <Separator />\n\n          {/* Advanced Filters Section */}\n          <Accordion type=\"single\" collapsible className=\"w-full\" data-testid=\"advanced-filters\">\n            <AccordionItem value=\"advanced\" className=\"border-none\">\n              <AccordionTrigger className=\"hover:no-underline px-0\">\n                <div className=\"flex items-center\">\n                  <ChevronRight className=\"h-4 w-4 mr-2\" />\n                  <span className=\"text-sm font-semibold\">Advanced Filters</span>\n                  {advancedFiltersCount > 0 && (\n                    <Badge variant=\"secondary\" className=\"ml-2\">\n                      {advancedFiltersCount}\n                    </Badge>\n                  )}\n                </div>\n              </AccordionTrigger>\n              <AccordionContent className=\"space-y-4 pt-4\">\n                {/* Amenities */}\n                <div className=\"space-y-3\" data-testid=\"amenity-filters\">\n                  <Label className=\"text-sm font-medium\">Amenities</Label>\n                  <div className=\"space-y-2\">\n                    {amenityOptions.map((amenity) => (\n                      <div key={amenity.value} className=\"flex items-center space-x-2\" data-testid={`amenity-${amenity.value}`}>\n                        <Checkbox\n                          id={`amenity-${amenity.value}`}\n                          checked={filters.amenities?.includes(amenity.value) || false}\n                          onCheckedChange={(checked) => handleAmenityChange(amenity.value, checked as boolean)}\n                          data-testid={`checkbox-amenity-${amenity.value}`}\n                        />\n                        <Label \n                          htmlFor={`amenity-${amenity.value}`} \n                          className=\"text-sm cursor-pointer\"\n                          data-testid={`label-amenity-${amenity.value}`}\n                        >\n                          {amenity.label}\n                        </Label>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                <Separator />\n\n                {/* Lease Terms */}\n                <div className=\"space-y-3\" data-testid=\"lease-term-filters\">\n                  <Label className=\"text-sm font-medium\">Lease Terms</Label>\n                  <div className=\"space-y-2\">\n                    {leaseTermOptions.map((term) => (\n                      <div key={term.value} className=\"flex items-center space-x-2\" data-testid={`lease-term-${term.value}`}>\n                        <Checkbox\n                          id={`lease-${term.value}`}\n                          checked={filters.leaseTerms?.includes(term.value) || false}\n                          onCheckedChange={(checked) => handleLeaseTermChange(term.value, checked as boolean)}\n                          data-testid={`checkbox-lease-${term.value}`}\n                        />\n                        <Label \n                          htmlFor={`lease-${term.value}`} \n                          className=\"text-sm cursor-pointer\"\n                          data-testid={`label-lease-${term.value}`}\n                        >\n                          {term.label}\n                        </Label>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                <Separator />\n\n                {/* Floor Level */}\n                <div className=\"space-y-3\" data-testid=\"floor-level-filter\">\n                  <Label className=\"text-sm font-medium\">Floor Level</Label>\n                  <RadioGroup \n                    value={filters.floorLevel || \"\"} \n                    onValueChange={handleFloorLevelChange}\n                    data-testid=\"radiogroup-floor-level\"\n                  >\n                    {floorLevelOptions.map((option) => (\n                      <div key={option.value} className=\"flex items-center space-x-2\" data-testid={`floor-level-${option.value}`}>\n                        <RadioGroupItem \n                          value={option.value} \n                          id={`floor-${option.value}`}\n                          data-testid={`radio-floor-${option.value}`}\n                        />\n                        <Label \n                          htmlFor={`floor-${option.value}`} \n                          className=\"text-sm cursor-pointer\"\n                          data-testid={`label-floor-${option.value}`}\n                        >\n                          {option.label}\n                        </Label>\n                      </div>\n                    ))}\n                  </RadioGroup>\n                </div>\n\n                <Separator />\n\n                {/* Renovation Status */}\n                <div className=\"space-y-3\" data-testid=\"renovation-status-filter\">\n                  <Label className=\"text-sm font-medium\">Renovation Status</Label>\n                  <RadioGroup \n                    value={filters.renovationStatus || \"\"} \n                    onValueChange={handleRenovationStatusChange}\n                    data-testid=\"radiogroup-renovation\"\n                  >\n                    {renovationStatusOptions.map((option) => (\n                      <div key={option.value} className=\"flex items-center space-x-2\" data-testid={`renovation-${option.value}`}>\n                        <RadioGroupItem \n                          value={option.value} \n                          id={`renovation-${option.value}`}\n                          data-testid={`radio-renovation-${option.value}`}\n                        />\n                        <Label \n                          htmlFor={`renovation-${option.value}`} \n                          className=\"text-sm cursor-pointer\"\n                          data-testid={`label-renovation-${option.value}`}\n                        >\n                          {option.label}\n                        </Label>\n                      </div>\n                    ))}\n                  </RadioGroup>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        </CardContent>\n      </Card>\n    </motion.div>\n  );\n});\n\nexport default AnalysisFilters;","size_bytes":20691},"client/src/components/competitor-selection.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { ArrowRight } from \"lucide-react\";\nimport type { ScrapedProperty } from \"@shared/schema\";\n\ninterface CompetitorSelectionProps {\n  competitors: ScrapedProperty[];\n  onContinue: (selectedIds: string[]) => void;\n}\n\nexport default function CompetitorSelection({ competitors, onContinue }: CompetitorSelectionProps) {\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\n\n  const toggleSelection = (id: string) => {\n    setSelectedIds(prev => \n      prev.includes(id) \n        ? prev.filter(selectedId => selectedId !== id)\n        : prev.length < 5 \n        ? [...prev, id]\n        : prev\n    );\n  };\n\n  const handleContinue = () => {\n    onContinue(selectedIds);\n  };\n\n  return (\n    <div className=\"bg-card rounded-lg border border-border p-6\" data-testid=\"competitor-selection\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-xl font-semibold\" data-testid=\"selection-title\">\n          Select Competitor Properties\n        </h3>\n        <div className=\"text-sm text-muted-foreground\" data-testid=\"selection-limit\">\n          Select up to 5 properties for comparison\n        </div>\n      </div>\n\n      <div className=\"space-y-3\" data-testid=\"competitors-list\">\n        {competitors.map((property) => (\n          <div \n            key={property.id}\n            className=\"flex items-center p-4 border border-border rounded-lg hover:bg-accent cursor-pointer\"\n            onClick={() => toggleSelection(property.id)}\n            data-testid={`competitor-${property.id}`}\n          >\n            <Checkbox\n              checked={selectedIds.includes(property.id)}\n              onChange={() => toggleSelection(property.id)}\n              className=\"mr-4\"\n              data-testid={`checkbox-competitor-${property.id}`}\n            />\n            <div className=\"flex-1\">\n              <div className=\"flex items-center justify-between\">\n                <h4 className=\"font-semibold\" data-testid={`name-${property.id}`}>\n                  {property.name}\n                </h4>\n                {property.distance && (\n                  <div className=\"text-sm text-muted-foreground\">\n                    <span data-testid={`distance-${property.id}`}>\n                      {property.distance} miles away\n                    </span>\n                  </div>\n                )}\n              </div>\n              <div className=\"text-sm text-muted-foreground mt-1\" data-testid={`details-${property.id}`}>\n                {property.address}\n              </div>\n              {property.matchScore && (\n                <div className=\"text-xs text-muted-foreground mt-2\">\n                  <span data-testid={`match-score-${property.id}`}>\n                    Match Score: {property.matchScore}%\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"mt-6 flex justify-between items-center\">\n        <div className=\"text-sm text-muted-foreground\" data-testid=\"selection-count\">\n          {selectedIds.length} of 5 properties selected\n        </div>\n        <Button \n          onClick={handleContinue}\n          disabled={selectedIds.length === 0}\n          data-testid=\"button-continue-summary\"\n        >\n          Continue to Summary\n          <ArrowRight className=\"ml-2 h-4 w-4\" />\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3516},"client/src/components/optimization-table.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Plus, Minus, TrendingUp, TrendingDown, RotateCcw, RotateCw, RefreshCw, DollarSign } from \"lucide-react\";\nimport type { PropertyUnit, OptimizationReport } from \"@shared/schema\";\n\ninterface OptimizationTableProps {\n  units: PropertyUnit[];\n  report: OptimizationReport;\n  onApplyChanges?: (unitPrices: Record<string, number>) => void;\n}\n\ninterface UnitWithDetails extends PropertyUnit {\n  confidenceLevel?: string;\n  reasoning?: string;\n  marketAverage?: string;\n}\n\nexport default function OptimizationTable({ units, report, onApplyChanges }: OptimizationTableProps) {\n  const [modifiedPrices, setModifiedPrices] = useState<Record<string, number>>({});\n  const [selectedUnitType, setSelectedUnitType] = useState<string>(\"all\");\n  const [bulkFixedAmount, setBulkFixedAmount] = useState<string>(\"\");\n  const [history, setHistory] = useState<Record<string, number>[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  // Initialize modified prices with recommended rents\n  useEffect(() => {\n    const initialPrices: Record<string, number> = {};\n    units.forEach(unit => {\n      const recommendedRent = unit.recommendedRent ? parseFloat(unit.recommendedRent) : parseFloat(unit.currentRent);\n      initialPrices[unit.id] = recommendedRent;\n    });\n    setModifiedPrices(initialPrices);\n    setHistory([initialPrices]);\n    setHistoryIndex(0);\n  }, [units]);\n\n  // Get unique unit types for filtering\n  const unitTypes = useMemo(() => {\n    const types = new Set(units.map(unit => unit.unitType));\n    return Array.from(types).sort();\n  }, [units]);\n\n  // Calculate real-time impact\n  const impact = useMemo(() => {\n    let totalMonthlyIncrease = 0;\n    let affectedUnits = 0;\n    let unitsIncreased = 0;\n    let unitsDecreased = 0;\n\n    units.forEach(unit => {\n      const currentRent = parseFloat(unit.currentRent);\n      const newRent = modifiedPrices[unit.id] || currentRent;\n      const change = newRent - currentRent;\n\n      if (change !== 0) {\n        affectedUnits++;\n        totalMonthlyIncrease += change;\n        if (change > 0) unitsIncreased++;\n        else unitsDecreased++;\n      }\n    });\n\n    const avgPercentChange = affectedUnits > 0 \n      ? (totalMonthlyIncrease / units.reduce((sum, unit) => sum + parseFloat(unit.currentRent), 0)) * 100\n      : 0;\n\n    return {\n      totalMonthlyIncrease,\n      totalAnnualIncrease: totalMonthlyIncrease * 12,\n      affectedUnits,\n      unitsIncreased,\n      unitsDecreased,\n      avgPercentChange: avgPercentChange.toFixed(2)\n    };\n  }, [modifiedPrices, units]);\n\n  const handlePriceChange = (unitId: string, newPrice: number) => {\n    const updated = { ...modifiedPrices, [unitId]: newPrice };\n    setModifiedPrices(updated);\n    addToHistory(updated);\n  };\n\n  const handleQuickAdjust = (unitId: string, amount: number) => {\n    const currentPrice = modifiedPrices[unitId] || 0;\n    handlePriceChange(unitId, Math.max(0, currentPrice + amount));\n  };\n\n  const applyBulkPercentage = (percentage: number) => {\n    const updated: Record<string, number> = {};\n    const unitsToUpdate = selectedUnitType === \"all\" \n      ? units \n      : units.filter(u => u.unitType === selectedUnitType);\n\n    unitsToUpdate.forEach(unit => {\n      const currentPrice = modifiedPrices[unit.id] || parseFloat(unit.currentRent);\n      updated[unit.id] = Math.round(currentPrice * (1 + percentage / 100));\n    });\n\n    const newPrices = { ...modifiedPrices, ...updated };\n    setModifiedPrices(newPrices);\n    addToHistory(newPrices);\n  };\n\n  const applyBulkFixed = (amount: number, operation: 'add' | 'subtract') => {\n    const updated: Record<string, number> = {};\n    const unitsToUpdate = selectedUnitType === \"all\" \n      ? units \n      : units.filter(u => u.unitType === selectedUnitType);\n\n    unitsToUpdate.forEach(unit => {\n      const currentPrice = modifiedPrices[unit.id] || parseFloat(unit.currentRent);\n      const adjustedAmount = operation === 'add' ? amount : -amount;\n      updated[unit.id] = Math.max(0, currentPrice + adjustedAmount);\n    });\n\n    const newPrices = { ...modifiedPrices, ...updated };\n    setModifiedPrices(newPrices);\n    addToHistory(newPrices);\n  };\n\n  const setToMarket = (multiplier: number = 1) => {\n    const updated: Record<string, number> = {};\n    const unitsToUpdate = selectedUnitType === \"all\" \n      ? units \n      : units.filter(u => u.unitType === selectedUnitType);\n\n    unitsToUpdate.forEach(unit => {\n      const unitWithDetails = unit as UnitWithDetails;\n      const marketAvg = unitWithDetails.marketAverage ? parseFloat(unitWithDetails.marketAverage) : parseFloat(unit.currentRent);\n      updated[unit.id] = Math.round(marketAvg * multiplier);\n    });\n\n    const newPrices = { ...modifiedPrices, ...updated };\n    setModifiedPrices(newPrices);\n    addToHistory(newPrices);\n  };\n\n  const resetToRecommendations = () => {\n    const updated: Record<string, number> = {};\n    units.forEach(unit => {\n      const recommendedRent = unit.recommendedRent ? parseFloat(unit.recommendedRent) : parseFloat(unit.currentRent);\n      updated[unit.id] = recommendedRent;\n    });\n    setModifiedPrices(updated);\n    addToHistory(updated);\n  };\n\n  const addToHistory = (prices: Record<string, number>) => {\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(prices);\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  };\n\n  const undo = () => {\n    if (historyIndex > 0) {\n      setHistoryIndex(historyIndex - 1);\n      setModifiedPrices(history[historyIndex - 1]);\n    }\n  };\n\n  const redo = () => {\n    if (historyIndex < history.length - 1) {\n      setHistoryIndex(historyIndex + 1);\n      setModifiedPrices(history[historyIndex + 1]);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"vacant\":\n        return <Badge variant=\"destructive\" data-testid={`status-vacant`}>Vacant</Badge>;\n      case \"occupied\":\n        return <Badge variant=\"default\" className=\"bg-green-100 text-green-800\" data-testid={`status-occupied`}>Occupied</Badge>;\n      case \"notice_given\":\n        return <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800\" data-testid={`status-notice`}>Notice Given</Badge>;\n      default:\n        return <Badge variant=\"outline\" data-testid={`status-unknown`}>{status}</Badge>;\n    }\n  };\n\n  const getConfidenceBadge = (level: string = \"Medium\") => {\n    switch (level) {\n      case \"High\":\n        return <Badge className=\"bg-green-100 text-green-800\">High</Badge>;\n      case \"Low\":\n        return <Badge className=\"bg-red-100 text-red-800\">Low</Badge>;\n      default:\n        return <Badge className=\"bg-yellow-100 text-yellow-800\">Medium</Badge>;\n    }\n  };\n\n  const getChangeIndicator = (currentRent: number, newRent: number) => {\n    const change = newRent - currentRent;\n    if (change > 0) {\n      return (\n        <span className=\"flex items-center text-green-600\">\n          <TrendingUp className=\"w-4 h-4 mr-1\" />\n          +${Math.abs(change)}\n        </span>\n      );\n    } else if (change < 0) {\n      return (\n        <span className=\"flex items-center text-red-600\">\n          <TrendingDown className=\"w-4 h-4 mr-1\" />\n          -${Math.abs(change)}\n        </span>\n      );\n    }\n    return <span className=\"text-gray-500\">$0</span>;\n  };\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"optimization-table\">\n      {/* Bulk Adjustment Toolbar */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Bulk Adjustments</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {/* Unit Type Filter */}\n          <div className=\"flex items-center gap-4\">\n            <span className=\"text-sm font-medium\">Apply to:</span>\n            <Select value={selectedUnitType} onValueChange={setSelectedUnitType}>\n              <SelectTrigger className=\"w-[200px]\" data-testid=\"select-unit-type\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Units</SelectItem>\n                {unitTypes.map(type => (\n                  <SelectItem key={type} value={type}>{type}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Percentage Adjustments */}\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium w-32\">Percentage:</span>\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => applyBulkPercentage(-5)}\n                data-testid=\"button-bulk-minus-5\"\n              >\n                -5%\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => applyBulkPercentage(-2)}\n                data-testid=\"button-bulk-minus-2\"\n              >\n                -2%\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => applyBulkPercentage(2)}\n                data-testid=\"button-bulk-plus-2\"\n              >\n                +2%\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => applyBulkPercentage(5)}\n                data-testid=\"button-bulk-plus-5\"\n              >\n                +5%\n              </Button>\n            </div>\n          </div>\n\n          {/* Fixed Amount Adjustments */}\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium w-32\">Fixed Amount:</span>\n            <Input\n              type=\"number\"\n              placeholder=\"Amount\"\n              value={bulkFixedAmount}\n              onChange={(e) => setBulkFixedAmount(e.target.value)}\n              className=\"w-32\"\n              data-testid=\"input-bulk-amount\"\n            />\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={() => bulkFixedAmount && applyBulkFixed(parseFloat(bulkFixedAmount), 'add')}\n              data-testid=\"button-bulk-add\"\n            >\n              <Plus className=\"w-4 h-4 mr-1\" />\n              Add\n            </Button>\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={() => bulkFixedAmount && applyBulkFixed(parseFloat(bulkFixedAmount), 'subtract')}\n              data-testid=\"button-bulk-subtract\"\n            >\n              <Minus className=\"w-4 h-4 mr-1\" />\n              Subtract\n            </Button>\n          </div>\n\n          {/* Market-based Presets */}\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium w-32\">Market Presets:</span>\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setToMarket(1)}\n                data-testid=\"button-set-market\"\n              >\n                Set to Market\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setToMarket(1.05)}\n                data-testid=\"button-set-105-market\"\n              >\n                105% of Market\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={resetToRecommendations}\n                data-testid=\"button-reset-ai\"\n              >\n                <RefreshCw className=\"w-4 h-4 mr-1\" />\n                Reset to AI\n              </Button>\n            </div>\n          </div>\n\n          {/* Undo/Redo */}\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium w-32\">History:</span>\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={undo}\n              disabled={historyIndex <= 0}\n              data-testid=\"button-undo\"\n            >\n              <RotateCcw className=\"w-4 h-4 mr-1\" />\n              Undo\n            </Button>\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={redo}\n              disabled={historyIndex >= history.length - 1}\n              data-testid=\"button-redo\"\n            >\n              <RotateCw className=\"w-4 h-4 mr-1\" />\n              Redo\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Real-time Impact Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\" data-testid=\"impact-cards\">\n        <Card className={impact.totalMonthlyIncrease > 0 ? \"border-green-200 bg-green-50\" : impact.totalMonthlyIncrease < 0 ? \"border-red-200 bg-red-50\" : \"\"}>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold\" data-testid=\"monthly-impact\">\n              {impact.totalMonthlyIncrease >= 0 ? \"+\" : \"\"}${Math.abs(impact.totalMonthlyIncrease).toLocaleString()}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Monthly Impact</div>\n          </CardContent>\n        </Card>\n        <Card className={impact.totalAnnualIncrease > 0 ? \"border-green-200 bg-green-50\" : impact.totalAnnualIncrease < 0 ? \"border-red-200 bg-red-50\" : \"\"}>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold\" data-testid=\"annual-impact\">\n              {impact.totalAnnualIncrease >= 0 ? \"+\" : \"\"}${Math.abs(impact.totalAnnualIncrease).toLocaleString()}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Annual Impact</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold\" data-testid=\"affected-units-count\">\n              {impact.affectedUnits}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Units Changed</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-green-600\" data-testid=\"units-increased\">\n              ‚Üë {impact.unitsIncreased}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Increased</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"text-2xl font-bold text-red-600\" data-testid=\"units-decreased\">\n              ‚Üì {impact.unitsDecreased}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">Decreased</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Units Table */}\n      <div className=\"bg-muted rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-background\">\n              <tr>\n                <th className=\"px-4 py-3 text-left font-semibold\">Unit</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Type</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Current</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">AI Rec.</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Market Avg</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">New Price</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Quick Adjust</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Change</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Annual</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Confidence</th>\n                <th className=\"px-4 py-3 text-left font-semibold\">Status</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-border\">\n              {units.map((unit) => {\n                const unitWithDetails = unit as UnitWithDetails;\n                const currentRent = parseFloat(unit.currentRent);\n                const recommendedRent = unit.recommendedRent ? parseFloat(unit.recommendedRent) : currentRent;\n                const marketAvg = unitWithDetails.marketAverage ? parseFloat(unitWithDetails.marketAverage) : currentRent;\n                const newRent = modifiedPrices[unit.id] || recommendedRent;\n                const change = newRent - currentRent;\n                const annualImpact = change * 12;\n\n                return (\n                  <tr \n                    key={unit.id} \n                    className=\"hover:bg-accent\" \n                    data-testid={`unit-row-${unit.unitNumber}`}\n                  >\n                    <td className=\"px-4 py-3 font-medium\" data-testid={`unit-number-${unit.unitNumber}`}>\n                      {unit.unitNumber}\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`unit-type-${unit.unitNumber}`}>\n                      {unit.unitType}\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`current-rent-${unit.unitNumber}`}>\n                      ${currentRent}\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`ai-recommended-${unit.unitNumber}`}>\n                      <span className=\"text-blue-600 font-medium\">\n                        ${recommendedRent}\n                      </span>\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`market-avg-${unit.unitNumber}`}>\n                      ${marketAvg}\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`editable-rent-${unit.unitNumber}`}>\n                      <Input\n                        type=\"number\"\n                        value={newRent}\n                        onChange={(e) => handlePriceChange(unit.id, parseFloat(e.target.value) || 0)}\n                        className=\"w-24\"\n                        data-testid={`input-rent-${unit.unitNumber}`}\n                      />\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`quick-adjust-${unit.unitNumber}`}>\n                      <div className=\"flex gap-1\">\n                        <Button \n                          size=\"sm\" \n                          variant=\"outline\"\n                          onClick={() => handleQuickAdjust(unit.id, -10)}\n                          data-testid={`button-minus-10-${unit.unitNumber}`}\n                        >\n                          -$10\n                        </Button>\n                        <Button \n                          size=\"sm\" \n                          variant=\"outline\"\n                          onClick={() => handleQuickAdjust(unit.id, -5)}\n                          data-testid={`button-minus-5-${unit.unitNumber}`}\n                        >\n                          -$5\n                        </Button>\n                        <Button \n                          size=\"sm\" \n                          variant=\"outline\"\n                          onClick={() => handleQuickAdjust(unit.id, 5)}\n                          data-testid={`button-plus-5-${unit.unitNumber}`}\n                        >\n                          +$5\n                        </Button>\n                        <Button \n                          size=\"sm\" \n                          variant=\"outline\"\n                          onClick={() => handleQuickAdjust(unit.id, 10)}\n                          data-testid={`button-plus-10-${unit.unitNumber}`}\n                        >\n                          +$10\n                        </Button>\n                      </div>\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`change-${unit.unitNumber}`}>\n                      {getChangeIndicator(currentRent, newRent)}\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`impact-${unit.unitNumber}`}>\n                      <span className={\n                        annualImpact > 0 ? \"text-green-600 font-medium\" : \n                        annualImpact < 0 ? \"text-red-600 font-medium\" : \n                        \"text-gray-600\"\n                      }>\n                        {annualImpact > 0 ? \"+\" : \"\"}${Math.abs(annualImpact).toLocaleString()}/year\n                      </span>\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`confidence-${unit.unitNumber}`}>\n                      {getConfidenceBadge(unitWithDetails.confidenceLevel)}\n                    </td>\n                    <td className=\"px-4 py-3\" data-testid={`status-${unit.unitNumber}`}>\n                      {getStatusBadge(unit.status)}\n                    </td>\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Apply Changes Button */}\n      {onApplyChanges && (\n        <div className=\"flex justify-end\">\n          <Button \n            size=\"lg\"\n            onClick={() => onApplyChanges(modifiedPrices)}\n            disabled={impact.affectedUnits === 0}\n            data-testid=\"button-apply-changes\"\n            className=\"px-8\"\n          >\n            <DollarSign className=\"w-5 h-5 mr-2\" />\n            Apply Changes ({impact.affectedUnits} units)\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":21754},"client/src/components/property-form.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertPropertySchema } from \"@shared/schema\";\nimport type { InsertProperty } from \"@shared/schema\";\nimport { Form, FormControl, FormField, FormItem, FormLabel } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Brain } from \"lucide-react\";\nimport { z } from \"zod\";\n\ninterface PropertyFormProps {\n  onSubmit: (data: InsertProperty) => void;\n  isLoading?: boolean;\n  initialValues?: {\n    propertyName: string;\n    address: string;\n  };\n}\n\n// Simplified schema for just address and property name\nconst simplifiedPropertySchema = z.object({\n  address: z.string().min(1, \"Property address is required\"),\n  propertyName: z.string().min(1, \"Property name is required\")\n});\n\ntype SimplifiedFormData = z.infer<typeof simplifiedPropertySchema>;\n\nexport default function PropertyForm({ onSubmit, isLoading, initialValues }: PropertyFormProps) {\n  const form = useForm<SimplifiedFormData>({\n    resolver: zodResolver(simplifiedPropertySchema),\n    defaultValues: {\n      address: initialValues?.address || \"\",\n      propertyName: initialValues?.propertyName || \"\"\n    }\n  });\n\n  const handleSubmit = (data: SimplifiedFormData) => {\n    // Transform simplified data to InsertProperty format\n    const fullPropertyData: InsertProperty = {\n      address: data.address,\n      propertyName: data.propertyName,\n      city: null,\n      state: null,\n      propertyType: null,\n      totalUnits: null,\n      builtYear: null,\n      squareFootage: null,\n      parkingSpaces: null,\n      amenities: []\n    };\n    onSubmit(fullPropertyData);\n  };\n\n  return (\n    <div className=\"bg-card rounded-lg border border-border p-6\" data-testid=\"property-form\">\n      <div className=\"text-center mb-6\">\n        <h3 className=\"text-2xl font-semibold mb-2\" data-testid=\"form-title\">\n          Property Analysis Setup\n        </h3>\n        <p className=\"text-muted-foreground\">\n          Enter your property details to begin AI analysis and competitive data scraping\n        </p>\n      </div>\n      \n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <FormField\n              control={form.control}\n              name=\"propertyName\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-base font-medium\">Property Name</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"e.g. Sunset Gardens Apartments\" \n                      {...field} \n                      data-testid=\"input-property-name\"\n                      className=\"h-12\"\n                    />\n                  </FormControl>\n                </FormItem>\n              )}\n            />\n            \n            <FormField\n              control={form.control}\n              name=\"address\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-base font-medium\">Property Address</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"123 Main St, Omaha, NE 68102\" \n                      {...field} \n                      data-testid=\"input-address\"\n                      className=\"h-12\"\n                    />\n                  </FormControl>\n                </FormItem>\n              )}\n            />\n          </div>\n          \n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-start\">\n              <Brain className=\"text-blue-600 mr-3 mt-1 h-5 w-5\" />\n              <div>\n                <h4 className=\"font-medium text-blue-900 mb-1\">What happens next:</h4>\n                <ul className=\"text-sm text-blue-800 space-y-1\">\n                  <li>‚Ä¢ <strong>Instant AI Analysis:</strong> Get immediate market insights for your property</li>\n                  <li>‚Ä¢ <strong>Auto City Detection:</strong> We'll extract the city from your address</li>\n                  <li>‚Ä¢ <strong>Background Scraping:</strong> Automatic data collection from apartments.com</li>\n                  <li>‚Ä¢ <strong>Property Matching:</strong> Auto-detect your property from competitive listings</li>\n                  <li>‚Ä¢ <strong>Detailed Analysis:</strong> Compare with real market data and optimize pricing</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex justify-center\">\n            <Button \n              type=\"submit\" \n              disabled={isLoading}\n              data-testid=\"button-start-analysis\"\n              className=\"h-12 px-8 text-base\"\n            >\n              <Brain className=\"mr-2 h-5 w-5\" />\n              {isLoading ? \"Starting Analysis...\" : \"Start AI Analysis & Scraping\"}\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}\n","size_bytes":5084},"client/src/components/vacancy-chart.tsx":{"content":"import type { CompetitorProperty } from \"@shared/schema\";\n\ninterface VacancyChartProps {\n  subjectVacancyRate: number;\n  competitors: CompetitorProperty[];\n}\n\nexport default function VacancyChart({ subjectVacancyRate, competitors }: VacancyChartProps) {\n  const allProperties = [\n    { name: \"Your Property\", vacancyRate: subjectVacancyRate, color: \"bg-primary\" },\n    ...competitors.map(comp => ({ \n      name: comp.name, \n      vacancyRate: parseFloat(comp.vacancyRate), \n      color: getColorForIndex(competitors.indexOf(comp))\n    }))\n  ];\n\n  const maxRate = Math.max(...allProperties.map(p => p.vacancyRate));\n\n  return (\n    <div className=\"bg-card rounded-lg border border-border p-6\" data-testid=\"vacancy-chart\">\n      <h3 className=\"text-xl font-semibold mb-6\" data-testid=\"chart-title\">\n        Vacancy Comparison Summary\n      </h3>\n      \n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\n        <div className=\"bg-muted p-4 rounded-lg text-center\" data-testid=\"subject-vacancy\">\n          <div className=\"text-2xl font-bold text-primary\">\n            {subjectVacancyRate.toFixed(1)}%\n          </div>\n          <div className=\"text-sm text-muted-foreground\">Your Property Vacancy</div>\n        </div>\n        <div className=\"bg-muted p-4 rounded-lg text-center\" data-testid=\"market-average\">\n          <div className=\"text-2xl font-bold text-green-600\">\n            {calculateMarketAverage(competitors).toFixed(1)}%\n          </div>\n          <div className=\"text-sm text-muted-foreground\">Market Average</div>\n        </div>\n        <div className=\"bg-muted p-4 rounded-lg text-center\" data-testid=\"competitor-average\">\n          <div className=\"text-2xl font-bold text-amber-600\">\n            {calculateCompetitorAverage(competitors).toFixed(1)}%\n          </div>\n          <div className=\"text-sm text-muted-foreground\">Competitor Average</div>\n        </div>\n      </div>\n\n      <div className=\"bg-muted p-6 rounded-lg\" data-testid=\"chart-container\">\n        <h4 className=\"font-semibold mb-4\">Vacancy Rate Comparison</h4>\n        <div className=\"space-y-4\">\n          {allProperties.map((property, index) => (\n            <div key={index} className=\"flex items-center\" data-testid={`chart-bar-${index}`}>\n              <div className=\"w-32 text-sm font-medium\" data-testid={`property-name-${index}`}>\n                {property.name}\n              </div>\n              <div className=\"flex-1 bg-background rounded-full h-6 relative\">\n                <div \n                  className={`chart-bar ${property.color} h-6 rounded-full`}\n                  style={{ width: `${(property.vacancyRate / maxRate) * 100}%` }}\n                  data-testid={`progress-bar-${index}`}\n                />\n                <span \n                  className=\"absolute right-2 top-0 h-6 flex items-center text-xs font-medium\"\n                  data-testid={`vacancy-rate-${index}`}\n                >\n                  {property.vacancyRate.toFixed(1)}%\n                </span>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction getColorForIndex(index: number): string {\n  const colors = [\"bg-blue-500\", \"bg-green-500\", \"bg-purple-500\", \"bg-orange-500\"];\n  return colors[index % colors.length];\n}\n\nfunction calculateMarketAverage(competitors: CompetitorProperty[]): number {\n  if (competitors.length === 0) return 0;\n  const total = competitors.reduce((sum, comp) => sum + parseFloat(comp.vacancyRate), 0);\n  return total / competitors.length;\n}\n\nfunction calculateCompetitorAverage(competitors: CompetitorProperty[]): number {\n  return calculateMarketAverage(competitors);\n}\n","size_bytes":3651},"client/src/components/workflow-progress.tsx":{"content":"import { useLocation } from \"wouter\";\n\nexport default function WorkflowProgress() {\n  const [location] = useLocation();\n  \n  const steps = [\n    { id: 1, name: \"Property Analysis\", path: \"/\" },\n    { id: 2, name: \"Competitor Selection\", path: \"/summarize\" },\n    { id: 3, name: \"Summary & Analysis\", path: \"/analyze\" },\n    { id: 4, name: \"Optimization\", path: \"/optimize\" }\n  ];\n\n  const getCurrentStep = () => {\n    if (location === \"/\") return 1;\n    if (location.includes(\"/summarize\")) return 2;\n    if (location.includes(\"/analyze\")) return 3;\n    if (location.includes(\"/optimize\")) return 4;\n    return 1;\n  };\n\n  const currentStep = getCurrentStep();\n\n  return (\n    <div className=\"mt-8 p-4 bg-muted rounded-lg\" data-testid=\"workflow-progress\">\n      <h3 className=\"font-semibold mb-4\" data-testid=\"progress-title\">Analysis Progress</h3>\n      <div className=\"space-y-3\">\n        {steps.map((step) => {\n          const isActive = step.id === currentStep;\n          const isCompleted = step.id < currentStep;\n          \n          return (\n            <div key={step.id} className=\"flex items-center\" data-testid={`step-${step.id}`}>\n              <div \n                className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mr-3 ${\n                  isCompleted \n                    ? \"step-completed\" \n                    : isActive \n                    ? \"step-active\" \n                    : \"step-inactive\"\n                }`}\n                data-testid={`step-circle-${step.id}`}\n              >\n                {step.id}\n              </div>\n              <span \n                className={`text-sm ${\n                  isActive || isCompleted \n                    ? \"font-medium text-foreground\" \n                    : \"text-muted-foreground\"\n                }`}\n                data-testid={`step-name-${step.id}`}\n              >\n                {step.name}\n              </span>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","size_bytes":2002},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/excel-export.ts":{"content":"import ExcelJS from 'exceljs';\n\nexport interface ExcelExportData {\n  propertyInfo: {\n    address: string;\n    type: string;\n    units: number;\n    builtYear: number;\n  };\n  units: Array<{\n    unitNumber: string;\n    unitType: string;\n    currentRent: number;\n    recommendedRent?: number;\n    change: number;\n    annualImpact: number;\n    status: string;\n    confidenceLevel?: string;\n    reasoning?: string;\n  }>;\n  summary: {\n    totalIncrease: number;\n    affectedUnits: number;\n    avgIncrease: number;\n    riskLevel: string;\n  };\n  marketInsights?: {\n    occupancyImpact: string;\n    competitivePosition: string;\n    timeToLease: string;\n  };\n}\n\nexport async function exportToExcel(data: ExcelExportData): Promise<void> {\n  const workbook = new ExcelJS.Workbook();\n  workbook.creator = 'Property Optimization Tool';\n  workbook.lastModifiedBy = 'Property Optimization Tool';\n  workbook.created = new Date();\n  workbook.modified = new Date();\n  \n  // Create main worksheet\n  const worksheet = workbook.addWorksheet('Optimization Report', {\n    headerFooter: {\n      firstHeader: 'Property Optimization Report',\n      firstFooter: '&CGenerated by Property Optimization Tool'\n    }\n  });\n  \n  // Set column widths\n  worksheet.columns = [\n    { header: 'Unit Number', key: 'unitNumber', width: 15 },\n    { header: 'Unit Type', key: 'unitType', width: 15 },\n    { header: 'Current Rent', key: 'currentRent', width: 15 },\n    { header: 'Recommended Rent', key: 'recommendedRent', width: 18 },\n    { header: 'Monthly Change', key: 'change', width: 15 },\n    { header: 'Annual Impact', key: 'annualImpact', width: 15 },\n    { header: 'Status', key: 'status', width: 12 },\n    { header: 'Confidence', key: 'confidence', width: 12 },\n    { header: 'Notes', key: 'notes', width: 40 }\n  ];\n  \n  // Add title and property info\n  const titleRow = worksheet.addRow(['Property Optimization Report']);\n  titleRow.getCell(1).font = { size: 18, bold: true, color: { argb: 'FF2563EB' } };\n  titleRow.height = 30;\n  \n  worksheet.addRow(['Generated on:', new Date().toLocaleDateString()]);\n  worksheet.addRow([]);\n  \n  // Property Information Section\n  const propertyHeaderRow = worksheet.addRow(['Property Information']);\n  propertyHeaderRow.getCell(1).font = { size: 14, bold: true, color: { argb: 'FF059669' } };\n  \n  worksheet.addRow(['Address:', data.propertyInfo.address]);\n  worksheet.addRow(['Property Type:', data.propertyInfo.type]);\n  worksheet.addRow(['Total Units:', data.propertyInfo.units]);\n  worksheet.addRow(['Built Year:', data.propertyInfo.builtYear]);\n  worksheet.addRow([]);\n  \n  // Units Section Header\n  const unitsHeaderRow = worksheet.addRow(['Unit-by-Unit Optimization']);\n  unitsHeaderRow.getCell(1).font = { size: 14, bold: true, color: { argb: 'FF059669' } };\n  worksheet.addRow([]);\n  \n  // Add header row for units table\n  const headerRow = worksheet.addRow([\n    'Unit Number',\n    'Unit Type', \n    'Current Rent',\n    'Recommended Rent',\n    'Monthly Change',\n    'Annual Impact',\n    'Status',\n    'Confidence',\n    'Notes'\n  ]);\n  \n  // Style header row\n  headerRow.eachCell((cell) => {\n    cell.font = { bold: true, color: { argb: 'FFFFFFFF' } };\n    cell.fill = {\n      type: 'pattern',\n      pattern: 'solid',\n      fgColor: { argb: 'FF3B82F6' }\n    };\n    cell.border = {\n      top: { style: 'thin' },\n      left: { style: 'thin' },\n      bottom: { style: 'thin' },\n      right: { style: 'thin' }\n    };\n    cell.alignment = { horizontal: 'center', vertical: 'middle' };\n  });\n  \n  // Add unit data with conditional formatting\n  data.units.forEach((unit) => {\n    const row = worksheet.addRow([\n      unit.unitNumber,\n      unit.unitType,\n      unit.currentRent,\n      unit.recommendedRent || unit.currentRent,\n      unit.change,\n      unit.annualImpact,\n      unit.status,\n      unit.confidenceLevel || 'N/A',\n      unit.reasoning || 'No additional notes'\n    ]);\n    \n    // Apply conditional formatting based on change amount\n    const changeCell = row.getCell(5); // Monthly Change column\n    const impactCell = row.getCell(6); // Annual Impact column\n    \n    if (unit.change > 0) {\n      // Positive change - green\n      changeCell.font = { color: { argb: 'FF059669' }, bold: true };\n      changeCell.fill = {\n        type: 'pattern',\n        pattern: 'solid',\n        fgColor: { argb: 'FFDCFCE7' }\n      };\n      impactCell.font = { color: { argb: 'FF059669' }, bold: true };\n      impactCell.fill = {\n        type: 'pattern',\n        pattern: 'solid',\n        fgColor: { argb: 'FFDCFCE7' }\n      };\n    } else if (unit.change < 0) {\n      // Negative change - red\n      changeCell.font = { color: { argb: 'FFDC2626' }, bold: true };\n      changeCell.fill = {\n        type: 'pattern',\n        pattern: 'solid',\n        fgColor: { argb: 'FFFEF2F2' }\n      };\n      impactCell.font = { color: { argb: 'FFDC2626' }, bold: true };\n      impactCell.fill = {\n        type: 'pattern',\n        pattern: 'solid',\n        fgColor: { argb: 'FFFEF2F2' }\n      };\n    } else {\n      // No change - gray\n      changeCell.font = { color: { argb: 'FF6B7280' } };\n      impactCell.font = { color: { argb: 'FF6B7280' } };\n    }\n    \n    // Add borders to all cells\n    row.eachCell((cell) => {\n      cell.border = {\n        top: { style: 'thin' },\n        left: { style: 'thin' },\n        bottom: { style: 'thin' },\n        right: { style: 'thin' }\n      };\n    });\n    \n    // Format currency cells\n    row.getCell(3).numFmt = '\"$\"#,##0.00'; // Current Rent\n    row.getCell(4).numFmt = '\"$\"#,##0.00'; // Recommended Rent\n    row.getCell(5).numFmt = '\"$\"#,##0.00'; // Monthly Change\n    row.getCell(6).numFmt = '\"$\"#,##0.00'; // Annual Impact\n  });\n  \n  worksheet.addRow([]);\n  \n  // Summary Section\n  const summaryHeaderRow = worksheet.addRow(['Optimization Summary']);\n  summaryHeaderRow.getCell(1).font = { size: 14, bold: true, color: { argb: 'FF059669' } };\n  \n  const summaryData = [\n    ['Total Annual Revenue Increase:', `$${data.summary.totalIncrease.toLocaleString()}`],\n    ['Units Affected:', data.summary.affectedUnits],\n    ['Average Rent Increase:', `${data.summary.avgIncrease}%`],\n    ['Risk Level:', data.summary.riskLevel]\n  ];\n  \n  summaryData.forEach(([label, value]) => {\n    const row = worksheet.addRow([label, value]);\n    row.getCell(1).font = { bold: true };\n    if (typeof label === 'string' && label.includes('Revenue Increase') && typeof value === 'string' && value.startsWith('$')) {\n      row.getCell(2).font = { color: { argb: 'FF059669' }, bold: true };\n    }\n  });\n  \n  // Market Insights Section (if available)\n  if (data.marketInsights) {\n    worksheet.addRow([]);\n    const insightsHeaderRow = worksheet.addRow(['Market Insights']);\n    insightsHeaderRow.getCell(1).font = { size: 14, bold: true, color: { argb: 'FF059669' } };\n    \n    worksheet.addRow(['Occupancy Impact:', data.marketInsights.occupancyImpact]);\n    worksheet.addRow(['Competitive Position:', data.marketInsights.competitivePosition]);\n    worksheet.addRow(['Time to Lease:', data.marketInsights.timeToLease]);\n  }\n  \n  // Generate and download the file\n  const buffer = await workbook.xlsx.writeBuffer();\n  const blob = new Blob([buffer], { \n    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \n  });\n  \n  const link = document.createElement('a');\n  const url = URL.createObjectURL(blob);\n  link.href = url;\n  link.download = `property-optimization-${Date.now()}.xlsx`;\n  link.style.visibility = 'hidden';\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n","size_bytes":7568},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/analyze.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowRight, AlertCircle, Loader2 } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport AnalysisFilters from \"@/components/analysis-filters\";\nimport FilteredAnalysisResults from \"@/components/filtered-analysis-results\";\nimport { useWorkflowState } from \"@/hooks/use-workflow-state\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport type { FilterCriteria, FilteredAnalysis } from \"@shared/schema\";\n\nexport default function Analyze({ params }: { params: { id: string } }) {\n  const [, setLocation] = useLocation();\n  const [filters, setFilters] = useState<FilterCriteria>({\n    bedroomTypes: [],\n    priceRange: { min: 500, max: 5000 },  // Widened range to capture all units\n    availability: \"60days\",  // Most inclusive option to show all units\n    squareFootageRange: { min: 200, max: 3000 }  // Expanded range for all unit sizes\n  });\n  const [analysisData, setAnalysisData] = useState<FilteredAnalysis | null>(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [isDebouncing, setIsDebouncing] = useState(false);\n  const debounceTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const { state: workflowState, saveState: saveWorkflowState, loadState: loadWorkflowState } = useWorkflowState(params.id);\n\n  // Mutation for filtered analysis\n  const analysisMutation = useMutation({\n    mutationFn: async (filterCriteria: FilterCriteria): Promise<FilteredAnalysis> => {\n      const response = await apiRequest('POST', '/api/filtered-analysis', filterCriteria);\n      return response.json();\n    },\n    onSuccess: (data: FilteredAnalysis) => {\n      setAnalysisData(data);\n    },\n    onError: (error) => {\n      console.error('Analysis error:', error);\n    }\n  });\n\n  // Load workflow state on mount and restore filters\n  useEffect(() => {\n    const initializeState = async () => {\n      const loadedState = await loadWorkflowState();\n      if (loadedState && loadedState.filterCriteria) {\n        setFilters(loadedState.filterCriteria);\n      }\n      setIsInitialized(true);\n    };\n    initializeState();\n  }, [params.id]);\n\n  // Debounced filter changes (300ms delay)\n  useEffect(() => {\n    if (isInitialized) {\n      // Clear any existing timer\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n      \n      // Show debouncing indicator\n      setIsDebouncing(true);\n      \n      // Set new timer for 300ms\n      debounceTimerRef.current = setTimeout(() => {\n        analysisMutation.mutate(filters);\n        setIsDebouncing(false);\n        // Save workflow state with current filters\n        saveWorkflowState({\n          stage: 'analyze',\n          filterCriteria: filters\n        });\n      }, 300);\n      \n      // Cleanup on unmount\n      return () => {\n        if (debounceTimerRef.current) {\n          clearTimeout(debounceTimerRef.current);\n        }\n      };\n    }\n  }, [filters, isInitialized]);\n\n  const handleFiltersChange = (newFilters: FilterCriteria) => {\n    setFilters(newFilters);\n  };\n\n  const handleContinueToOptimize = async () => {\n    // Save workflow state before navigating\n    await saveWorkflowState({\n      stage: 'optimize',\n      filterCriteria: filters\n    });\n    setLocation(`/optimize/${params.id}`);\n  };\n\n  return (\n    <motion.div \n      className=\"h-full\" \n      data-testid=\"analyze-page\"\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ duration: 0.3 }}\n    >\n      <div className=\"bg-card rounded-lg border border-border h-full overflow-hidden\">\n        {/* 75/25 Layout Container */}\n        <div className=\"flex flex-col lg:flex-row h-full\">\n          {/* Main Analysis Area - 75% width */}\n          <div className=\"flex-1 lg:w-3/4 p-6 overflow-y-auto relative\">\n            {/* Debouncing Indicator */}\n            <AnimatePresence>\n              {isDebouncing && (\n                <motion.div\n                  initial={{ opacity: 0, y: -10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  exit={{ opacity: 0, y: -10 }}\n                  className=\"absolute top-4 right-4 z-10 bg-primary/10 text-primary px-3 py-1 rounded-full flex items-center gap-2 text-sm\"\n                  data-testid=\"debouncing-indicator\"\n                >\n                  <Loader2 className=\"h-3 w-3 animate-spin\" />\n                  Updating analysis...\n                </motion.div>\n              )}\n            </AnimatePresence>\n\n            {/* Analysis Results Area */}\n            {analysisMutation.error ? (\n              <motion.div \n                className=\"flex items-center justify-center min-h-[500px]\" \n                data-testid=\"error-state\"\n                initial={{ opacity: 0, scale: 0.95 }}\n                animate={{ opacity: 1, scale: 1 }}\n                transition={{ duration: 0.3 }}\n              >\n                <div className=\"text-center space-y-4\">\n                  <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto\" />\n                  <div className=\"text-lg font-medium\">Analysis Failed</div>\n                  <div className=\"text-muted-foreground mb-4\">\n                    Unable to load analysis data. Please try again.\n                  </div>\n                  <Button \n                    onClick={() => analysisMutation.mutate(filters)} \n                    data-testid=\"button-retry\"\n                  >\n                    Retry Analysis\n                  </Button>\n                </div>\n              </motion.div>\n            ) : (\n              <motion.div\n                key={JSON.stringify(filters)}\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ duration: 0.3 }}\n              >\n                <FilteredAnalysisResults \n                  analysis={analysisData!}\n                  isLoading={analysisMutation.isPending || isDebouncing}\n                />\n              </motion.div>\n            )}\n            \n            {/* Continue to Optimization Button */}\n            {analysisData && !analysisMutation.isPending && !isDebouncing && (\n              <motion.div \n                className=\"flex justify-end pt-6 border-t mt-6\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.2, duration: 0.3 }}\n              >\n                <Button \n                  onClick={handleContinueToOptimize} \n                  data-testid=\"button-proceed-optimization\"\n                  size=\"lg\"\n                  className=\"shadow-lg hover:shadow-xl transition-all\"\n                >\n                  Proceed to Optimization\n                  <ArrowRight className=\"ml-2 h-4 w-4\" />\n                </Button>\n              </motion.div>\n            )}\n          </div>\n\n          {/* Filter Sidebar - 25% width */}\n          <div className=\"lg:w-1/4 lg:border-l border-border p-6 bg-muted/5 overflow-y-auto\">\n            <div className=\"sticky top-0\">\n              <AnalysisFilters\n                filters={filters}\n                onFiltersChange={handleFiltersChange}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}","size_bytes":7369},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/optimize.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { \n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle\n} from \"@/components/ui/alert-dialog\";\nimport { FileSpreadsheet, Save } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport OptimizationTable from \"@/components/optimization-table\";\nimport { exportToExcel, type ExcelExportData } from \"@/lib/excel-export\";\nimport { useWorkflowState } from \"@/hooks/use-workflow-state\";\nimport type { Property, PropertyUnit, OptimizationReport } from \"@shared/schema\";\n\ninterface OptimizationData {\n  report: OptimizationReport;\n  units: PropertyUnit[];\n}\n\ninterface PropertyWithAnalysis {\n  property: Property;\n  analysis: any;\n}\n\nexport default function Optimize({ params }: { params: { id: string } }) {\n  const { toast } = useToast();\n  const { state: workflowState, saveState: saveWorkflowState, loadState: loadWorkflowState } = useWorkflowState(params.id);\n  \n  const [goal, setGoal] = useState(\"maximize-revenue\");\n  const [targetOccupancy, setTargetOccupancy] = useState([95]);\n  const [riskTolerance, setRiskTolerance] = useState([2]); // 1=Low, 2=Medium, 3=High\n  const [showApplyDialog, setShowApplyDialog] = useState(false);\n  const [pendingPrices, setPendingPrices] = useState<Record<string, number>>({});\n  const [hasInitialized, setHasInitialized] = useState(false);\n\n  const propertyQuery = useQuery<PropertyWithAnalysis>({\n    queryKey: ['/api/properties', params.id],\n  });\n\n  const optimizationQuery = useQuery<OptimizationData>({\n    queryKey: ['/api/properties', params.id, 'optimization'],\n    enabled: hasInitialized // Enabled once initialized\n  });\n\n  const syncUnitsMutation = useMutation({\n    mutationFn: async (): Promise<PropertyUnit[]> => {\n      const res = await apiRequest(\"POST\", `/api/properties/${params.id}/sync-units`, {});\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/properties', params.id, 'optimization'] });\n    }\n  });\n\n  const createUnitsMutation = useMutation({\n    mutationFn: async (): Promise<PropertyUnit[]> => {\n      console.log('[OPTIMIZE] Creating units for property:', params.id);\n      const res = await apiRequest(\"POST\", `/api/properties/${params.id}/units`, {});\n      const data = await res.json();\n      console.log('[OPTIMIZE] Units created:', data);\n      return data;\n    },\n    onError: (error) => {\n      console.error('[OPTIMIZE] Failed to create units:', error);\n      toast({\n        title: \"Failed to Create Units\",\n        description: \"Unable to create units for optimization. Please ensure property data has been scraped.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Load workflow state and sync units on mount\n  useEffect(() => {\n    const initializeOptimization = async () => {\n      // Load workflow state\n      const loadedState = await loadWorkflowState();\n      if (loadedState && loadedState.optimizationParams) {\n        setGoal(loadedState.optimizationParams.goal || \"maximize-revenue\");\n        setTargetOccupancy([loadedState.optimizationParams.targetOccupancy || 95]);\n        setRiskTolerance([loadedState.optimizationParams.riskTolerance || 2]);\n      }\n      \n      // Save current stage\n      await saveWorkflowState({\n        stage: 'optimize',\n        optimizationParams: {\n          goal,\n          targetOccupancy: targetOccupancy[0],\n          riskTolerance: riskTolerance[0]\n        }\n      });\n      \n      // Sync units first to ensure we have all 14 units\n      try {\n        await syncUnitsMutation.mutateAsync();\n      } catch (error) {\n        console.error('Failed to sync units:', error);\n      }\n      \n      setHasInitialized(true);\n    };\n    \n    initializeOptimization();\n  }, [params.id]);\n\n  // Save workflow state when optimization params change\n  useEffect(() => {\n    if (hasInitialized) {\n      saveWorkflowState({\n        stage: 'optimize',\n        optimizationParams: {\n          goal,\n          targetOccupancy: targetOccupancy[0],\n          riskTolerance: riskTolerance[0]\n        }\n      });\n    }\n  }, [goal, targetOccupancy, riskTolerance, hasInitialized]);\n\n  const optimizeMutation = useMutation({\n    mutationFn: async (data: { goal: string; targetOccupancy: number; riskTolerance: number }): Promise<OptimizationData> => {\n      const res = await apiRequest(\"POST\", `/api/properties/${params.id}/optimize`, data);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData(['/api/properties', params.id, 'optimization'], data);\n      toast({\n        title: \"Optimization Complete\",\n        description: `Generated recommendations for ${data.units.length} units.`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Optimization Failed\",\n        description: \"Failed to generate recommendations. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const applyPricingMutation = useMutation({\n    mutationFn: async (unitPrices: Record<string, number>) => {\n      const res = await apiRequest(\"POST\", `/api/properties/${params.id}/apply-pricing`, { unitPrices });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/properties', params.id] });\n      toast({\n        title: \"Pricing Applied Successfully\",\n        description: `Updated pricing for ${data.affectedUnits} units with an annual impact of $${data.totalAnnualImpact.toLocaleString()}.`,\n      });\n      setShowApplyDialog(false);\n    },\n    onError: () => {\n      toast({\n        title: \"Failed to Apply Pricing\",\n        description: \"There was an error saving the pricing changes. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const generateRecommendations = () => {\n    console.log('[OPTIMIZE] Generate recommendations clicked');\n    console.log('[OPTIMIZE] Current optimization data:', optimizationQuery.data);\n    console.log('[OPTIMIZE] Parameters:', { goal, targetOccupancy: targetOccupancy[0], riskTolerance: riskTolerance[0] });\n    \n    // First create units if they don't exist, then optimize\n    if (!optimizationQuery.data) {\n      console.log('[OPTIMIZE] No existing optimization data, creating units first');\n      createUnitsMutation.mutate(undefined, {\n        onSuccess: (units) => {\n          console.log('[OPTIMIZE] Units created successfully, now optimizing with', units.length, 'units');\n          optimizeMutation.mutate({ \n            goal, \n            targetOccupancy: targetOccupancy[0], \n            riskTolerance: riskTolerance[0] \n          });\n        }\n      });\n    } else {\n      console.log('[OPTIMIZE] Existing optimization data found, optimizing directly');\n      optimizeMutation.mutate({ \n        goal, \n        targetOccupancy: targetOccupancy[0], \n        riskTolerance: riskTolerance[0] \n      });\n    }\n  };\n\n  const getRiskLabel = (value: number) => {\n    switch (value) {\n      case 1: return \"Low\";\n      case 2: return \"Medium\";\n      case 3: return \"High\";\n      default: return \"Medium\";\n    }\n  };\n\n  const handleApplyChanges = (unitPrices: Record<string, number>) => {\n    setPendingPrices(unitPrices);\n    setShowApplyDialog(true);\n  };\n\n  const confirmApplyChanges = () => {\n    applyPricingMutation.mutate(pendingPrices);\n  };\n\n  const handleExportToExcel = async () => {\n    const property = propertyQuery.data?.property;\n    const optimization = optimizationQuery.data;\n    \n    if (!property || !optimization) {\n      toast({\n        title: \"Export Failed\",\n        description: \"No optimization data available to export.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const exportData: ExcelExportData = {\n      propertyInfo: {\n        address: property.address,\n        type: property.propertyType || 'Unknown',\n        units: property.totalUnits || 0,\n        builtYear: property.builtYear || 0,\n      },\n      units: optimization.units.map(unit => ({\n        unitNumber: unit.unitNumber,\n        unitType: unit.unitType,\n        currentRent: parseFloat(unit.currentRent),\n        recommendedRent: unit.recommendedRent ? parseFloat(unit.recommendedRent) : undefined,\n        change: unit.recommendedRent ? parseFloat(unit.recommendedRent) - parseFloat(unit.currentRent) : 0,\n        annualImpact: unit.recommendedRent ? (parseFloat(unit.recommendedRent) - parseFloat(unit.currentRent)) * 12 : 0,\n        status: unit.status,\n        confidenceLevel: 'Medium', // Default confidence level\n        reasoning: 'AI-generated pricing recommendation' // Default reasoning\n      })),\n      summary: {\n        totalIncrease: parseFloat(optimization.report.totalIncrease),\n        affectedUnits: optimization.report.affectedUnits,\n        avgIncrease: parseFloat(optimization.report.avgIncrease),\n        riskLevel: optimization.report.riskLevel,\n      }\n    };\n\n    try {\n      await exportToExcel(exportData);\n      toast({\n        title: \"Export Successful\",\n        description: \"Optimization report has been downloaded as Excel file.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Export Failed\",\n        description: \"Failed to generate Excel file. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (propertyQuery.isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\" data-testid=\"loading-state\">\n        <div className=\"text-muted-foreground\">Loading property data...</div>\n      </div>\n    );\n  }\n\n  if (propertyQuery.error) {\n    return (\n      <div className=\"text-center py-8\" data-testid=\"error-state\">\n        <div className=\"text-red-600 mb-4\">Failed to load property data</div>\n        <Button onClick={() => window.location.reload()} data-testid=\"button-retry\">\n          Retry\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"optimize-page\">\n      <div className=\"bg-card rounded-lg border border-border p-6\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-xl font-semibold\" data-testid=\"optimization-title\">\n            Pricing Optimization\n          </h3>\n          <Button \n            onClick={handleExportToExcel}\n            disabled={!optimizationQuery.data}\n            className=\"bg-green-600 hover:bg-green-700\"\n            data-testid=\"button-export-excel\"\n          >\n            <FileSpreadsheet className=\"mr-2 h-4 w-4\" />\n            Export to Excel\n          </Button>\n        </div>\n\n        {/* Optimization Controls */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\" data-testid=\"optimization-controls\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Optimization Goal</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <RadioGroup value={goal} onValueChange={setGoal} data-testid=\"radio-goal\">\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"maximize-revenue\" id=\"maximize-revenue\" />\n                  <Label htmlFor=\"maximize-revenue\">Maximize Revenue</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"maximize-occupancy\" id=\"maximize-occupancy\" />\n                  <Label htmlFor=\"maximize-occupancy\">Maximize Occupancy</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"balanced\" id=\"balanced\" />\n                  <Label htmlFor=\"balanced\">Balanced</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"custom\" id=\"custom\" />\n                  <Label htmlFor=\"custom\">Custom</Label>\n                </div>\n              </RadioGroup>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Target Occupancy</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"px-2\" data-testid=\"slider-occupancy\">\n                <Slider\n                  value={targetOccupancy}\n                  onValueChange={setTargetOccupancy}\n                  max={100}\n                  min={85}\n                  step={1}\n                  className=\"w-full\"\n                />\n              </div>\n              <div className=\"flex justify-between text-sm text-muted-foreground\">\n                <span>85%</span>\n                <span className=\"font-semibold\">{targetOccupancy[0]}%</span>\n                <span>100%</span>\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Risk Tolerance</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"px-2\" data-testid=\"slider-risk\">\n                <Slider\n                  value={riskTolerance}\n                  onValueChange={setRiskTolerance}\n                  max={3}\n                  min={1}\n                  step={1}\n                  className=\"w-full\"\n                />\n              </div>\n              <div className=\"flex justify-between text-sm text-muted-foreground\">\n                <span>Low</span>\n                <span className=\"font-semibold\">{getRiskLabel(riskTolerance[0])}</span>\n                <span>High</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Generate Button */}\n        <div className=\"flex justify-center mb-6\">\n          <Button \n            size=\"lg\"\n            onClick={generateRecommendations}\n            disabled={optimizeMutation.isPending || createUnitsMutation.isPending}\n            data-testid=\"button-generate-recommendations\"\n            className=\"px-8\"\n          >\n            {(optimizeMutation.isPending || createUnitsMutation.isPending) \n              ? \"Generating Recommendations...\" \n              : \"Generate Optimization Recommendations\"}\n          </Button>\n        </div>\n\n        {/* Optimization Table */}\n        {optimizationQuery.data ? (\n          <OptimizationTable\n            units={optimizationQuery.data.units}\n            report={optimizationQuery.data.report}\n            onApplyChanges={handleApplyChanges}\n          />\n        ) : (\n          <div className=\"text-center py-8\" data-testid=\"no-data-state\">\n            <div className=\"text-muted-foreground mb-4\">\n              No optimization data available. Generate recommendations to get started.\n            </div>\n            <Button \n              onClick={generateRecommendations}\n              disabled={optimizeMutation.isPending || createUnitsMutation.isPending}\n              data-testid=\"button-get-started\"\n            >\n              Generate Recommendations\n            </Button>\n          </div>\n        )}\n\n      </div>\n\n      {/* Apply Changes Confirmation Dialog */}\n      <AlertDialog open={showApplyDialog} onOpenChange={setShowApplyDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Apply Pricing Changes?</AlertDialogTitle>\n            <AlertDialogDescription>\n              You are about to apply pricing changes to your property units. \n              This action will update the recommended rent prices for all modified units.\n              <br /><br />\n              {Object.keys(pendingPrices).length} units will be affected.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={confirmApplyChanges}\n              disabled={applyPricingMutation.isPending}\n            >\n              {applyPricingMutation.isPending ? \"Applying...\" : \"Apply Changes\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","size_bytes":16578},"client/src/pages/property-input.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport PropertyForm from \"@/components/property-form\";\nimport AIAnalysis from \"@/components/ai-analysis\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Loader2, CheckCircle, AlertCircle, Database } from \"lucide-react\";\nimport type { InsertProperty, Property, PropertyAnalysis, ScrapingJob } from \"@shared/schema\";\n\ninterface PropertyWithAnalysis {\n  property: Property;\n  analysis: PropertyAnalysis;\n}\n\ninterface ScrapingResult {\n  scrapingJob: ScrapingJob;\n  message: string;\n  targetUrl: string;\n}\n\nexport default function PropertyInput() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [result, setResult] = useState<PropertyWithAnalysis | null>(null);\n  const [scrapingResult, setScrapingResult] = useState<ScrapingResult | null>(null);\n  const [existingProperty, setExistingProperty] = useState<Property | null>(null);\n  \n  // Query to get the latest property (if it exists)\n  const latestPropertyQuery = useQuery({\n    queryKey: ['/api/properties/latest'],\n    queryFn: async () => {\n      const res = await fetch('/api/properties/latest');\n      if (res.status === 404) return null;\n      if (!res.ok) throw new Error('Failed to fetch property');\n      return res.json();\n    },\n    retry: false\n  });\n  \n  useEffect(() => {\n    if (latestPropertyQuery.data) {\n      setExistingProperty(latestPropertyQuery.data);\n    }\n  }, [latestPropertyQuery.data]);\n\n  const createPropertyMutation = useMutation({\n    mutationFn: async (data: InsertProperty): Promise<PropertyWithAnalysis> => {\n      const res = await apiRequest(\"POST\", \"/api/properties\", data);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      setResult(data);\n      // Automatically start scraping after property creation\n      startScrapingMutation.mutate(data.property.id);\n    },\n    onError: (error) => {\n      console.error(\"Error creating property:\", error);\n      toast({\n        title: \"Analysis Failed\",\n        description: \"Failed to analyze your property. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const startScrapingMutation = useMutation({\n    mutationFn: async (propertyId: string): Promise<ScrapingResult> => {\n      const res = await apiRequest(\"POST\", `/api/properties/${propertyId}/scrape`, {});\n      return res.json();\n    },\n    onSuccess: (data) => {\n      setScrapingResult(data);\n      toast({\n        title: \"Scraping Started\",\n        description: data.message,\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Error starting scraping:\", error);\n      const errorMessage = error?.message || \"Failed to start competitive data scraping.\";\n      const isTemporary = errorMessage.includes(\"temporarily unavailable\");\n      \n      toast({\n        title: isTemporary ? \"Temporary Service Issue\" : \"Scraping Failed\",\n        description: isTemporary \n          ? \"The scraping service is temporarily unavailable due to anti-scraping protection. Please try again in a few minutes.\"\n          : errorMessage,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSubmit = (data: InsertProperty) => {\n    createPropertyMutation.mutate(data);\n  };\n\n  const handleContinue = () => {\n    if (result?.property.id) {\n      setLocation(`/summarize/${result.property.id}`);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"property-input-page\">\n      <PropertyForm \n        onSubmit={handleSubmit}\n        isLoading={createPropertyMutation.isPending}\n        initialValues={existingProperty ? {\n          propertyName: existingProperty.propertyName,\n          address: existingProperty.address\n        } : undefined}\n      />\n      \n      {result && (\n        <AIAnalysis\n          analysis={result.analysis}\n          onContinue={handleContinue}\n        />\n      )}\n\n      {/* Scraping Status Card */}\n      {(startScrapingMutation.isPending || scrapingResult) && (\n        <Card className=\"border-blue-200 bg-blue-50\" data-testid=\"scraping-status\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-blue-900\">\n              <Database className=\"h-5 w-5\" />\n              Competitive Data Scraping\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {startScrapingMutation.isPending && (\n              <div className=\"flex items-center gap-3\">\n                <Loader2 className=\"h-5 w-5 animate-spin text-blue-600\" />\n                <div>\n                  <p className=\"font-medium text-blue-900\">Starting competitive data collection...</p>\n                  <p className=\"text-sm text-blue-700\">Analyzing your property address and preparing scraping job</p>\n                </div>\n              </div>\n            )}\n            \n            {scrapingResult && (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-3\">\n                  <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                  <div>\n                    <p className=\"font-medium text-green-900\">Scraping job initiated successfully!</p>\n                    <p className=\"text-sm text-green-700\">{scrapingResult.message}</p>\n                  </div>\n                </div>\n                \n                <div className=\"bg-white rounded-lg p-4 border border-blue-200\">\n                  <h4 className=\"font-medium text-blue-900 mb-2\">Scraping Details:</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div>\n                      <span className=\"text-blue-700\">Target URL:</span>\n                      <span className=\"ml-2 font-mono text-blue-900\">{scrapingResult.targetUrl}</span>\n                    </div>\n                    <div>\n                      <span className=\"text-blue-700\">Job ID:</span>\n                      <span className=\"ml-2 font-mono text-blue-900\">{scrapingResult.scrapingJob.id}</span>\n                    </div>\n                    <div>\n                      <span className=\"text-blue-700\">Status:</span>\n                      <span className=\"ml-2 text-blue-900 capitalize\">{scrapingResult.scrapingJob.status}</span>\n                    </div>\n                  </div>\n                  \n                  <div className=\"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded\">\n                    <div className=\"flex items-start gap-2\">\n                      <AlertCircle className=\"h-4 w-4 text-yellow-600 mt-0.5\" />\n                      <div className=\"text-sm\">\n                        <p className=\"font-medium text-yellow-900\">Background Processing</p>\n                        <p className=\"text-yellow-800\">\n                          The scraping job is now running in the background. You can continue with the analysis \n                          while competitive data is being collected. Real scraped data will be available for \n                          comparison shortly.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n            \n            {startScrapingMutation.isError && (\n              <div className=\"flex items-center gap-3\">\n                <AlertCircle className=\"h-5 w-5 text-red-600\" />\n                <div>\n                  <p className=\"font-medium text-red-900\">Scraping failed</p>\n                  <p className=\"text-sm text-red-700\">\n                    Unable to start competitive data collection. You can still proceed with manual analysis.\n                  </p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":7908},"client/src/pages/summarize.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ArrowRight, ArrowLeft, Loader2, CheckCircle, XCircle, Download, TrendingUp, TrendingDown, AlertCircle, BarChart3 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport CompetitorSelection from \"@/components/competitor-selection\";\nimport RentComparisonChart from \"@/components/rent-comparison-chart\";\nimport UnitListingsTable from \"@/components/unit-listings-table\";\nimport { useWorkflowState } from \"@/hooks/use-workflow-state\";\nimport type { Property, PropertyAnalysis, ScrapedProperty } from \"@shared/schema\";\n\ninterface PropertyWithAnalysis {\n  property: Property;\n  analysis: PropertyAnalysis;\n}\n\ninterface ScrapingResult {\n  propertyId: string;\n  propertyName: string;\n  propertyAddress: string;\n  isSubjectProperty: boolean;\n  scrapingJobId?: string;\n  unitsFound: number;\n  units: any[];\n  error?: string;\n}\n\ninterface Unit {\n  unitNumber: string;\n  unitType: string;\n  bedrooms: number;\n  bathrooms: string;\n  squareFootage: number;\n  rent: string;\n  availabilityDate: string;\n  status: string;\n}\n\ninterface VacancyData {\n  subjectProperty: {\n    id: string;\n    name: string;\n    vacancyRate: number;\n    unitTypes: UnitTypeData[];\n    units?: Unit[];\n  };\n  competitors: {\n    id: string;\n    name: string;\n    vacancyRate: number;\n    unitTypes: UnitTypeData[];\n    units?: Unit[];\n  }[];\n  marketInsights: {\n    subjectVsMarket: string;\n    strongestUnitType: string;\n    totalVacancies: number;\n    competitorAvgVacancies: number;\n  };\n}\n\ninterface UnitTypeData {\n  type: string;\n  totalUnits: number;\n  availableUnits: number;\n  vacancyRate: number;\n  avgRent: number;\n  avgSqFt: number;\n  rentRange: { min: number; max: number };\n}\n\nexport default function Summarize({ params }: { params: { id: string } }) {\n  const [, setLocation] = useLocation();\n  const [selectedCompetitors, setSelectedCompetitors] = useState<ScrapedProperty[]>([]);\n  const [showChart, setShowChart] = useState(false);\n  const [scrapingStage, setScrapingStage] = useState<'none' | 'scraping' | 'completed' | 'error'>('none');\n  const [scrapingResults, setScrapingResults] = useState<ScrapingResult[]>([]);\n  const [showVacancyChart, setShowVacancyChart] = useState(false);\n  const { toast } = useToast();\n  const { state: workflowState, saveState: saveWorkflowState, loadState: loadWorkflowState } = useWorkflowState(params.id);\n\n  const propertyQuery = useQuery<PropertyWithAnalysis>({\n    queryKey: ['/api/properties', params.id],\n  });\n\n  const competitorsQuery = useQuery<ScrapedProperty[]>({\n    queryKey: ['/api/competitors'],\n  });\n\n  // Load workflow state on mount and restore selections\n  useEffect(() => {\n    const initializeState = async () => {\n      const loadedState = await loadWorkflowState();\n      if (loadedState && loadedState.selectedCompetitorIds && competitorsQuery.data) {\n        const selected = competitorsQuery.data.filter(comp => \n          loadedState.selectedCompetitorIds?.includes(comp.id)\n        );\n        if (selected.length > 0) {\n          setSelectedCompetitors(selected);\n          setShowChart(true);\n          // Check if scraping was completed\n          if (loadedState.stage === 'summarize-completed') {\n            setScrapingStage('completed');\n            setShowVacancyChart(true);\n          }\n        }\n      }\n    };\n\n    if (competitorsQuery.data) {\n      initializeState();\n    }\n  }, [competitorsQuery.data, params.id]);\n\n  // Vacancy data query - triggered after scraping completes\n  const vacancyQuery = useQuery<VacancyData>({\n    queryKey: ['/api/vacancy/summary', params.id, selectedCompetitors.map(c => c.id)],\n    queryFn: async () => {\n      const competitorIds = selectedCompetitors.map(c => c.id);\n      const searchParams = new URLSearchParams({\n        propertyId: params.id,\n        ...competitorIds.reduce((acc, id, index) => {\n          acc[`competitorIds[${index}]`] = id;\n          return acc;\n        }, {} as Record<string, string>)\n      });\n      const response = await apiRequest('GET', `/api/vacancy/summary?${searchParams}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch vacancy data');\n      }\n      return await response.json();\n    },\n    enabled: scrapingStage === 'completed' && selectedCompetitors.length > 0,\n    retry: 3,\n    retryDelay: 2000,\n  });\n\n  const scrapingMutation = useMutation({\n    mutationFn: async (competitorIds: string[]) => {\n      const response = await apiRequest('POST', '/api/competitors/scrape-units', { competitorIds });\n      return await response.json();\n    },\n    onSuccess: (data) => {\n      setScrapingResults(data.results || []);\n      setScrapingStage('completed');\n      // Invalidate and refetch vacancy data\n      queryClient.invalidateQueries({ queryKey: ['/api/vacancy/summary'] });\n      toast({\n        title: \"Unit Scraping Completed\",\n        description: `Successfully scraped ${data.totalUnitsFound} units from ${data.processedProperties} properties.`\n      });\n    },\n    onError: (error) => {\n      setScrapingStage('error');\n      console.error('Scraping error:', error);\n      toast({\n        title: \"Scraping Failed\",\n        description: \"Failed to scrape unit data. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleCompetitorSelection = async (selectedIds: string[]) => {\n    if (competitorsQuery.data) {\n      const selected = competitorsQuery.data.filter(comp => selectedIds.includes(comp.id));\n      setSelectedCompetitors(selected);\n      setShowChart(true);\n      \n      // Save workflow state with selected competitors\n      await saveWorkflowState({\n        stage: 'summarize-in-progress',\n        selectedCompetitorIds: selectedIds\n      });\n      \n      // Start unit scraping workflow\n      setScrapingStage('scraping');\n      try {\n        await scrapingMutation.mutateAsync(selectedIds);\n        // Save completed state after successful scraping\n        await saveWorkflowState({\n          stage: 'summarize-completed',\n          selectedCompetitorIds: selectedIds\n        });\n      } catch (error) {\n        console.error('Failed to start scraping:', error);\n      }\n    }\n  };\n\n  const handleContinueToAnalyze = async () => {\n    // Save workflow state before navigating\n    await saveWorkflowState({\n      stage: 'analyze',\n      selectedCompetitorIds: selectedCompetitors.map(c => c.id)\n    });\n    setLocation(`/analyze/${params.id}`);\n  };\n\n  const handleBackToCompetitors = async () => {\n    // Update workflow state but don't clear data\n    await saveWorkflowState({\n      stage: 'summarize',\n      selectedCompetitorIds: [] // Still save empty to indicate going back\n    });\n    setShowChart(false);\n    setShowVacancyChart(false);\n    setScrapingStage('none');\n    setSelectedCompetitors([]);\n    setScrapingResults([]);\n  };\n\n  const handleExportData = () => {\n    if (vacancyQuery.data) {\n      const data = vacancyQuery.data;\n      const csvContent = generateCSVReport(data);\n      const blob = new Blob([csvContent], { type: 'text/csv' });\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `rent-comparison-${new Date().toISOString().split('T')[0]}.csv`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      toast({\n        title: \"Export Complete\",\n        description: \"Rent comparison data has been downloaded as CSV.\"\n      });\n    }\n  };\n\n  const generateCSVReport = (data: VacancyData): string => {\n    const headers = ['Property', 'Unit Type', 'Total Units', 'Available Units', 'Vacancy Rate %', 'Avg Rent', 'Avg Sq Ft', 'Min Rent', 'Max Rent'];\n    const rows = [headers];\n    \n    // Add subject property data\n    data.subjectProperty.unitTypes.forEach(unit => {\n      rows.push([\n        `${data.subjectProperty.name} (Subject)`,\n        unit.type,\n        unit.totalUnits.toString(),\n        unit.availableUnits.toString(),\n        unit.vacancyRate.toFixed(1),\n        Math.round(unit.avgRent).toString(),\n        Math.round(unit.avgSqFt).toString(),\n        Math.round(unit.rentRange.min).toString(),\n        Math.round(unit.rentRange.max).toString()\n      ]);\n    });\n    \n    // Add competitor data\n    data.competitors.forEach(competitor => {\n      competitor.unitTypes.forEach(unit => {\n        rows.push([\n          competitor.name,\n          unit.type,\n          unit.totalUnits.toString(),\n          unit.availableUnits.toString(),\n          unit.vacancyRate.toFixed(1),\n          Math.round(unit.avgRent).toString(),\n          Math.round(unit.avgSqFt).toString(),\n          Math.round(unit.rentRange.min).toString(),\n          Math.round(unit.rentRange.max).toString()\n        ]);\n      });\n    });\n    \n    return rows.map(row => row.join(',')).join('\\n');\n  };\n\n  // Effect to show vacancy chart when data is ready\n  useEffect(() => {\n    if (scrapingStage === 'completed' && vacancyQuery.data && !vacancyQuery.isLoading) {\n      setShowVacancyChart(true);\n    }\n  }, [scrapingStage, vacancyQuery.data, vacancyQuery.isLoading]);\n\n  if (propertyQuery.isLoading || competitorsQuery.isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\" data-testid=\"loading-state\">\n        <div className=\"text-muted-foreground\">Loading property data...</div>\n      </div>\n    );\n  }\n\n  if (propertyQuery.error || competitorsQuery.error) {\n    return (\n      <div className=\"text-center py-8\" data-testid=\"error-state\">\n        <div className=\"text-red-600 mb-4\">Failed to load property data</div>\n        <Button onClick={() => window.location.reload()} data-testid=\"button-retry\">\n          Retry\n        </Button>\n      </div>\n    );\n  }\n\n  const competitors = competitorsQuery.data || [];\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"summarize-page\">\n      {/* Subject Property Card */}\n      {propertyQuery.data && (\n        <Card data-testid=\"subject-property-card\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Badge variant=\"default\" className=\"mr-2\">Subject Property</Badge>\n              {propertyQuery.data.property.propertyName}\n            </CardTitle>\n            <CardDescription>\n              {propertyQuery.data.property.address}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Total Units</p>\n                <p className=\"text-lg font-semibold\">{propertyQuery.data.property.totalUnits || 'N/A'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">City</p>\n                <p className=\"text-lg font-semibold\">{propertyQuery.data.property.city || 'N/A'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">State</p>\n                <p className=\"text-lg font-semibold\">{propertyQuery.data.property.state || 'N/A'}</p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Property Type</p>\n                <p className=\"text-lg font-semibold\">{propertyQuery.data.property.propertyType || 'N/A'}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n      \n      {!showChart ? (\n        <CompetitorSelection \n          competitors={competitors}\n          onContinue={handleCompetitorSelection}\n        />\n      ) : (\n        <>\n          <div className=\"bg-card rounded-lg border border-border p-6\" data-testid=\"competitor-summary\">\n            <h3 className=\"text-xl font-semibold mb-6\">Selected Competitors</h3>\n            <div className=\"space-y-4\">\n              {selectedCompetitors.map((competitor) => (\n                <div key={competitor.id} className=\"p-4 bg-muted rounded-lg\" data-testid={`selected-competitor-${competitor.id}`}>\n                  <div className=\"font-semibold\">{competitor.name}</div>\n                  <div className=\"text-sm text-muted-foreground\">{competitor.address}</div>\n                  {competitor.distance && (\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      Distance: {competitor.distance} miles\n                    </div>\n                  )}\n                  {competitor.matchScore && (\n                    <div className=\"text-xs text-muted-foreground\">\n                      Match Score: {competitor.matchScore}%\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Unit Scraping Progress Section */}\n          <div className=\"bg-card rounded-lg border border-border p-6\" data-testid=\"unit-scraping-section\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-xl font-semibold\">Unit Data Collection</h3>\n              {scrapingStage === 'scraping' && (\n                <div className=\"flex items-center text-blue-600\" data-testid=\"scraping-indicator\">\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  <span className=\"text-sm\">Scraping unit details...</span>\n                </div>\n              )}\n              {scrapingStage === 'completed' && (\n                <div className=\"flex items-center text-green-600\" data-testid=\"scraping-completed\">\n                  <CheckCircle className=\"h-4 w-4 mr-2\" />\n                  <span className=\"text-sm\">Collection completed</span>\n                </div>\n              )}\n              {scrapingStage === 'error' && (\n                <div className=\"flex items-center text-red-600\" data-testid=\"scraping-error\">\n                  <XCircle className=\"h-4 w-4 mr-2\" />\n                  <span className=\"text-sm\">Collection failed</span>\n                </div>\n              )}\n            </div>\n\n            {scrapingStage === 'scraping' && (\n              <div className=\"space-y-3\" data-testid=\"scraping-progress\">\n                <p className=\"text-sm text-muted-foreground\">\n                  Collecting detailed unit information from subject property and selected competitors. This may take a few minutes...\n                </p>\n                <div className=\"space-y-2\">\n                  {/* Note: During scraping, we show selected competitors. The backend will automatically include the subject property */}\n                  <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md\">\n                    <div className=\"flex items-center\">\n                      <Loader2 className=\"h-3 w-3 mr-2 animate-spin text-blue-500\" />\n                      <div>\n                        <span className=\"text-xs font-medium text-blue-600 dark:text-blue-400 uppercase tracking-wide\">Subject Property</span>\n                        <div className=\"text-sm\">Collecting unit data...</div>\n                      </div>\n                    </div>\n                  </div>\n                  {selectedCompetitors.map((competitor) => (\n                    <div key={competitor.id} className=\"flex items-center p-3 bg-muted rounded-md\">\n                      <Loader2 className=\"h-3 w-3 mr-2 animate-spin text-blue-500\" />\n                      <span className=\"text-sm\">{competitor.name}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {scrapingStage === 'completed' && scrapingResults.length > 0 && (\n              <div className=\"space-y-3\" data-testid=\"scraping-results\">\n                <p className=\"text-sm text-muted-foreground\">\n                  Successfully collected unit data from {scrapingResults.filter(r => !r.error).length} properties\n                  {scrapingResults.some(r => r.isSubjectProperty) ? ' (including subject property)' : ''}.\n                </p>\n                \n                {/* Subject Property Display */}\n                {scrapingResults.filter(r => r.isSubjectProperty).map((result) => (\n                  <div key={result.propertyId} className=\"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\" data-testid={`subject-property-${result.propertyId}`}>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center\">\n                        {result.error ? (\n                          <XCircle className=\"h-4 w-4 mr-2 text-red-500\" />\n                        ) : (\n                          <CheckCircle className=\"h-4 w-4 mr-2 text-green-500\" />\n                        )}\n                        <div>\n                          <span className=\"text-xs font-medium text-blue-600 dark:text-blue-400 uppercase tracking-wide\">Subject Property</span>\n                          <div className=\"text-sm font-semibold\">{result.propertyName}</div>\n                        </div>\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {result.error ? 'Failed to collect data' : `${result.unitsFound} units found`}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                \n                {/* Competitor Properties Display */}\n                {scrapingResults.filter(r => !r.isSubjectProperty).length > 0 && (\n                  <div className=\"space-y-2\">\n                    <h4 className=\"text-sm font-medium text-muted-foreground mt-4\">Competitor Properties</h4>\n                    {scrapingResults.filter(r => !r.isSubjectProperty).map((result) => (\n                      <div key={result.propertyId} className=\"flex items-center justify-between p-3 bg-muted rounded-md\" data-testid={`competitor-result-${result.propertyId}`}>\n                        <div className=\"flex items-center\">\n                          {result.error ? (\n                            <XCircle className=\"h-4 w-4 mr-2 text-red-500\" />\n                          ) : (\n                            <CheckCircle className=\"h-4 w-4 mr-2 text-green-500\" />\n                          )}\n                          <span className=\"text-sm font-medium\">{result.propertyName}</span>\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {result.error ? 'Failed to collect data' : `${result.unitsFound} units found`}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {scrapingStage === 'error' && (\n              <div className=\"text-center py-4\" data-testid=\"scraping-error-message\">\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  Failed to collect unit data. Please try again or proceed with available data.\n                </p>\n                <Button\n                  onClick={() => scrapingMutation.mutate(selectedCompetitors.map(c => c.id))}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  data-testid=\"button-retry-scraping\"\n                >\n                  Retry Collection\n                </Button>\n              </div>\n            )}\n          </div>\n\n          {/* Vacancy Analysis Chart */}\n          {showVacancyChart && (\n            <div className=\"space-y-6\" data-testid=\"vacancy-analysis-section\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-2\">\n                  <BarChart3 className=\"h-5 w-5 text-primary\" />\n                  <h3 className=\"text-xl font-semibold\">Rent Analysis & Market Comparison</h3>\n                </div>\n                {vacancyQuery.data && (\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    {vacancyQuery.data.competitors.length + 1} Properties Analyzed\n                  </Badge>\n                )}\n              </div>\n\n              <RentComparisonChart \n                data={vacancyQuery.data || null}\n                isLoading={vacancyQuery.isLoading}\n                error={vacancyQuery.error?.message}\n              />\n\n              {/* Key Market Insights */}\n              {vacancyQuery.data && (\n                <Card data-testid=\"market-insights\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <TrendingUp className=\"h-5 w-5 text-green-600\" />\n                      <span>Key Market Insights</span>\n                    </CardTitle>\n                    <CardDescription>\n                      Market analysis based on {vacancyQuery.data.competitors.length} competitor properties\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                      {/* Subject Property vs Market */}\n                      <div className=\"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          {vacancyQuery.data.subjectProperty.vacancyRate < vacancyQuery.data.marketInsights.competitorAvgVacancies ? (\n                            <TrendingDown className=\"h-4 w-4 text-green-600\" />\n                          ) : (\n                            <TrendingUp className=\"h-4 w-4 text-red-600\" />\n                          )}\n                          <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">Market Position</span>\n                        </div>\n                        <div className=\"text-lg font-bold text-blue-900 dark:text-blue-100\">\n                          {vacancyQuery.data.subjectProperty.vacancyRate.toFixed(1)}% Vacancy\n                        </div>\n                        <div className=\"text-xs text-blue-600 dark:text-blue-400\">\n                          {vacancyQuery.data.marketInsights.subjectVsMarket}\n                        </div>\n                      </div>\n\n                      {/* Strongest Unit Type */}\n                      <div className=\"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                          <span className=\"text-sm font-medium text-green-700 dark:text-green-300\">Strongest Unit</span>\n                        </div>\n                        <div className=\"text-lg font-bold text-green-900 dark:text-green-100\">\n                          {vacancyQuery.data.marketInsights.strongestUnitType}\n                        </div>\n                        <div className=\"text-xs text-green-600 dark:text-green-400\">\n                          Lowest vacancy rate\n                        </div>\n                      </div>\n\n                      {/* Market Avg Vacancy */}\n                      <div className=\"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <AlertCircle className=\"h-4 w-4 text-amber-600\" />\n                          <span className=\"text-sm font-medium text-amber-700 dark:text-amber-300\">Market Average</span>\n                        </div>\n                        <div className=\"text-lg font-bold text-amber-900 dark:text-amber-100\">\n                          {vacancyQuery.data.marketInsights.competitorAvgVacancies.toFixed(1)}%\n                        </div>\n                        <div className=\"text-xs text-amber-600 dark:text-amber-400\">\n                          Competitor avg vacancy\n                        </div>\n                      </div>\n\n                      {/* Total Market Vacancies */}\n                      <div className=\"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <BarChart3 className=\"h-4 w-4 text-purple-600\" />\n                          <span className=\"text-sm font-medium text-purple-700 dark:text-purple-300\">Total Vacancies</span>\n                        </div>\n                        <div className=\"text-lg font-bold text-purple-900 dark:text-purple-100\">\n                          {vacancyQuery.data.marketInsights.totalVacancies}\n                        </div>\n                        <div className=\"text-xs text-purple-600 dark:text-purple-400\">\n                          Across all properties\n                        </div>\n                      </div>\n                    </div>\n\n                    <Separator />\n\n                    {/* Detailed insights text */}\n                    <div className=\"prose max-w-none\">\n                      <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                        Your property <strong>{vacancyQuery.data.subjectProperty.name}</strong> has a vacancy rate of <strong>{vacancyQuery.data.subjectProperty.vacancyRate.toFixed(1)}%</strong>, \n                        which is <strong>{vacancyQuery.data.marketInsights.subjectVsMarket.toLowerCase()}</strong>. \n                        The <strong>{vacancyQuery.data.marketInsights.strongestUnitType}</strong> unit type shows the strongest performance with the lowest vacancy rate. \n                        Consider focusing optimization efforts on underperforming unit types while leveraging the success of your strongest units.\n                      </p>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Unit Listings Tables Section */}\n              {vacancyQuery.data?.subjectProperty?.units && (\n                <div className=\"space-y-6\" data-testid=\"unit-listings-section\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-xl font-semibold\">Detailed Unit Listings</h3>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {vacancyQuery.data.subjectProperty.units.length + \n                       vacancyQuery.data.competitors.reduce((sum, c) => sum + (c.units?.length || 0), 0)} Total Units\n                    </Badge>\n                  </div>\n\n                  {/* Subject Property Units Table */}\n                  <UnitListingsTable\n                    propertyName={vacancyQuery.data.subjectProperty.name}\n                    units={vacancyQuery.data.subjectProperty.units || []}\n                    isSubjectProperty={true}\n                  />\n\n                  {/* Competitor Property Units Tables */}\n                  {vacancyQuery.data.competitors.map((competitor) => (\n                    <UnitListingsTable\n                      key={competitor.id}\n                      propertyName={competitor.name}\n                      units={competitor.units || []}\n                      isSubjectProperty={false}\n                    />\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Navigation Buttons */}\n          <div className=\"flex items-center justify-between pt-6\" data-testid=\"navigation-buttons\">\n            <Button \n              variant=\"outline\" \n              onClick={handleBackToCompetitors}\n              data-testid=\"button-back-competitors\"\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back to Competitors\n            </Button>\n            \n            <div className=\"flex space-x-3\">\n              {vacancyQuery.data && (\n                <Button \n                  variant=\"outline\" \n                  onClick={handleExportData}\n                  data-testid=\"button-export-data\"\n                >\n                  <Download className=\"mr-2 h-4 w-4\" />\n                  Export Data\n                </Button>\n              )}\n              \n              <Button \n                onClick={handleContinueToAnalyze}\n                disabled={scrapingStage === 'scraping'}\n                data-testid=\"button-continue-to-analyze\"\n              >\n                {scrapingStage === 'scraping' ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Collecting Data...\n                  </>\n                ) : (\n                  <>\n                    Proceed to Analysis\n                    <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","size_bytes":29329},"client/src/components/layout/header.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Download } from \"lucide-react\";\n\nexport default function Header() {\n  return (\n    <header className=\"bg-card border-b border-border px-6 py-4\" data-testid=\"header\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\" data-testid=\"page-title\">\n            Property Analysis Dashboard\n          </h2>\n          <p className=\"text-muted-foreground\" data-testid=\"page-description\">\n            Analyze, compare, and optimize your property pricing\n          </p>\n        </div>\n        <div className=\"flex items-center space-x-4\">\n          <Button variant=\"secondary\" data-testid=\"button-export-report\">\n            <Download className=\"mr-2 h-4 w-4\" />\n            Export Report\n          </Button>\n          <div className=\"w-8 h-8 bg-primary rounded-full flex items-center justify-center\" data-testid=\"user-avatar\">\n            <span className=\"text-primary-foreground font-semibold text-sm\">JD</span>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":1092},"client/src/components/layout/sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Home, BarChart3, TrendingUp, DollarSign } from \"lucide-react\";\nimport WorkflowProgress from \"@/components/workflow-progress\";\n\nexport default function Sidebar() {\n  const [location] = useLocation();\n  \n  // Extract property ID from current URL\n  const extractPropertyId = (path: string): string | null => {\n    const match = path.match(/\\/(summarize|analyze|optimize)\\/([^\\/]+)/);\n    return match ? match[2] : null;\n  };\n  \n  const propertyId = extractPropertyId(location);\n  \n  // Generate navigation with dynamic property IDs\n  const navigation = [\n    { \n      name: \"Property Input\", \n      href: \"/\", \n      icon: Home,\n      enabled: true \n    },\n    { \n      name: \"Summarize\", \n      href: propertyId ? `/summarize/${propertyId}` : null, \n      icon: BarChart3,\n      enabled: !!propertyId\n    },\n    { \n      name: \"Analyze\", \n      href: propertyId ? `/analyze/${propertyId}` : null, \n      icon: TrendingUp,\n      enabled: !!propertyId\n    },\n    { \n      name: \"Optimize\", \n      href: propertyId ? `/optimize/${propertyId}` : null, \n      icon: DollarSign,\n      enabled: !!propertyId\n    },\n  ];\n\n  return (\n    <div className=\"w-64 bg-card border-r border-border flex flex-col\" data-testid=\"sidebar\">\n      <div className=\"p-6 border-b border-border\">\n        <h1 className=\"text-xl font-bold text-primary\" data-testid=\"app-title\">\n          PropertyAnalytics Pro\n        </h1>\n        <p className=\"text-sm text-muted-foreground mt-1\" data-testid=\"app-subtitle\">\n          Real Estate Analysis Platform\n        </p>\n      </div>\n      \n      <nav className=\"flex-1 p-4\" data-testid=\"main-navigation\">\n        <div className=\"space-y-2\">\n          {navigation.map((item) => {\n            const Icon = item.icon;\n            const isActive = item.href ? (\n              location === item.href || \n              (item.href !== \"/\" && location.startsWith(item.href.split('/')[1] ? `/${item.href.split('/')[1]}` : item.href))\n            ) : false;\n            \n            // If navigation is disabled (no property ID), render as disabled span\n            if (!item.enabled || !item.href) {\n              return (\n                <div\n                  key={item.name}\n                  className=\"flex items-center px-3 py-2 rounded-md font-medium text-muted-foreground/50 cursor-not-allowed\"\n                  data-testid={`nav-link-${item.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <Icon className=\"w-5 h-5 mr-3\" />\n                  {item.name}\n                </div>\n              );\n            }\n            \n            return (\n              <Link\n                key={item.name}\n                href={item.href}\n                className={`flex items-center px-3 py-2 rounded-md font-medium transition-colors ${\n                  isActive\n                    ? \"bg-primary text-primary-foreground\"\n                    : \"hover:bg-accent text-muted-foreground hover:text-foreground\"\n                }`}\n                data-testid={`nav-link-${item.name.toLowerCase().replace(/\\s+/g, '-')}`}\n              >\n                <Icon className=\"w-5 h-5 mr-3\" />\n                {item.name}\n              </Link>\n            );\n          })}\n        </div>\n        \n        <WorkflowProgress />\n      </nav>\n    </div>\n  );\n}\n","size_bytes":3332},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"replit.md":{"content":"# Property Analytics Pro - Real Estate Analysis Platform\n\n## Overview\n\nProperty Analytics Pro is a comprehensive real estate analysis platform that helps property managers and real estate professionals analyze, compare, and optimize their property pricing strategies. The application combines AI-powered property analysis with web scraping capabilities to provide market insights and competitive analysis. It features a multi-stage workflow that guides users through property input, competitor analysis, detailed comparison, and pricing optimization.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## Recent Changes (September 24, 2025)\n\n### Critical Bug Fixes\n- **Fixed Generate Optimization Button**: Added missing POST /api/properties/:id/units endpoint that creates property units from scraped data or generates basic units when no scraped data is available\n- **Fixed Scraping Display Issue**: Updated parseUrls function to handle Scrapezy's \"listings\" response format in addition to \"apartment_listings\"\n- **Fixed Property Values Persistence**: \n  - Added subject property card on summarize page to display property name and address\n  - Implemented form value persistence when navigating back to property input page\n  - Added GET /api/properties/latest endpoint to retrieve most recent property\n- **Fixed Type Safety Issues**: Corrected type mismatches for currentRent (ensured string type) and safe id fallback generation\n\n### Enhanced Error Handling\n- Added comprehensive logging throughout backend endpoints for debugging\n- Improved frontend error messages with detailed toast notifications\n- Added safe fallbacks for scraped data to prevent endpoint crashes\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React with TypeScript using Vite as the build tool\n- **Routing**: Wouter for client-side routing with a multi-page workflow\n- **State Management**: React Query (TanStack Query) for server state management with optimistic updates\n- **UI Framework**: shadcn/ui components built on Radix UI primitives with Tailwind CSS\n- **Form Handling**: React Hook Form with Zod validation for type-safe form management\n- **Styling**: Tailwind CSS with CSS custom properties for theming support\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js framework\n- **Language**: TypeScript with ES modules\n- **Database**: PostgreSQL with Drizzle ORM for type-safe database operations\n- **Schema Management**: Drizzle Kit for database migrations and schema synchronization\n- **Validation**: Zod schemas shared between client and server for consistent validation\n\n### Data Storage Solutions\n- **Primary Database**: PostgreSQL hosted on Neon Database\n- **ORM**: Drizzle ORM with support for relations and type-safe queries\n- **Schema Design**: Normalized database with tables for properties, analysis, competitors, units, optimization reports, and scraping jobs\n- **Caching Strategy**: Smart caching service with 30-day TTL for scraped data\n\n### Authentication and Authorization\n- **Current State**: No authentication system implemented\n- **Session Management**: Basic Express session handling prepared for future auth integration\n- **Security**: CORS and basic request validation in place\n\n### Web Scraping Integration\n- **Primary Service**: Scrapezy API for apartment listing discovery and detailed property data extraction\n- **Multi-stage Scraping**: \n  - Stage 1: URL discovery from search pages\n  - Stage 2: Detailed unit information extraction\n  - Stage 3: Smart caching with automatic refresh\n- **Error Handling**: Robust error handling with individual property failure isolation\n- **Rate Limiting**: Built-in polling mechanism with configurable retry logic\n\n### AI Integration\n- **Provider**: OpenAI GPT-5 for property analysis and market insights\n- **Use Cases**: \n  - Property market positioning analysis\n  - Competitive advantage identification\n  - Pricing insights and recommendations\n  - Optimization report generation\n- **Response Format**: Structured JSON responses for consistent data processing\n\n### Workflow Architecture\n- **Multi-page Flow**: 4-stage workflow (Input ‚Üí Summarize ‚Üí Analyze ‚Üí Optimize)\n- **Progressive Enhancement**: Each stage builds upon previous data\n- **State Persistence**: Server-side state management with client-side caching\n- **Real-time Updates**: Polling-based updates for long-running scraping operations\n\n## External Dependencies\n\n### Database Services\n- **Neon Database**: Serverless PostgreSQL hosting with automatic scaling\n- **Connection Pooling**: Built-in connection management for optimal performance\n\n### AI Services\n- **OpenAI API**: GPT-5 model for natural language processing and analysis\n- **Structured Outputs**: JSON mode for consistent response formatting\n\n### Web Scraping Services\n- **Scrapezy API**: Professional web scraping service for apartment listings\n- **Rate Limiting**: API-level rate limiting and job queue management\n- **Data Extraction**: AI-powered data extraction with custom prompts\n\n### Development Tools\n- **Vite**: Fast development server and build tool with HMR\n- **TypeScript**: Static type checking across the entire stack\n- **ESBuild**: Fast JavaScript bundling for production builds\n- **Replit Integration**: Development environment optimization for Replit platform\n\n### UI Component Libraries\n- **Radix UI**: Unstyled, accessible component primitives\n- **shadcn/ui**: Pre-styled components with consistent design system\n- **Lucide React**: Icon library with comprehensive icon set\n- **Tailwind CSS**: Utility-first CSS framework with design tokens\n\n### Data Handling Libraries\n- **React Hook Form**: Performant form library with validation\n- **Zod**: TypeScript-first schema validation\n- **date-fns**: Modern date utility library\n- **class-variance-authority**: Type-safe variant handling for components\n\n### Development Dependencies\n- **tsx**: TypeScript execution for Node.js development\n- **PostCSS**: CSS processing with Tailwind integration\n- **Autoprefixer**: CSS vendor prefix automation","size_bytes":6045},"client/src/components/rent-comparison-chart.tsx":{"content":"import { useMemo } from \"react\";\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend,\n  TooltipItem,\n} from \"chart.js\";\nimport { Bar } from \"react-chartjs-2\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend\n);\n\ninterface VacancyData {\n  subjectProperty: {\n    id: string;\n    name: string;\n    vacancyRate: number;\n    unitTypes: UnitTypeData[];\n  };\n  competitors: {\n    id: string;\n    name: string;\n    vacancyRate: number;\n    unitTypes: UnitTypeData[];\n  }[];\n  marketInsights: {\n    subjectVsMarket: string;\n    strongestUnitType: string;\n    totalVacancies: number;\n    competitorAvgVacancies: number;\n  };\n}\n\ninterface UnitTypeData {\n  type: string;\n  totalUnits: number;\n  availableUnits: number;\n  vacancyRate: number;\n  avgRent: number;\n  avgSqFt: number;\n  rentRange: { min: number; max: number };\n}\n\ninterface RentComparisonChartProps {\n  data: VacancyData | null;\n  isLoading?: boolean;\n  error?: string;\n}\n\nconst UNIT_TYPES = ['Studio', '1BR', '2BR', '3BR+'];\n\n// Color palette for chart - optimized for dark theme\nconst SUBJECT_PROPERTY_COLOR = '#5DCCBF'; // Teal (target property)\nconst COMPETITOR_COLORS = [\n  '#F4A460', // Sandy Orange\n  '#FF8C69', // Salmon\n  '#FFB347', // Peach\n  '#FFA07A', // Light Salmon\n  '#FFD700', // Gold\n  '#FF6B6B', // Light Red\n  '#FF7F50', // Coral\n  '#FFA500', // Orange\n];\n\nexport default function RentComparisonChart({ data, isLoading, error }: RentComparisonChartProps) {\n  const chartData = useMemo(() => {\n    if (!data) return null;\n\n    const labels = UNIT_TYPES;\n    const datasets = [];\n\n    // Helper function to get rent data for a property by unit type\n    const getRentByUnitType = (property: any, unitType: string) => {\n      const unit = property.unitTypes.find((u: UnitTypeData) => u.type === unitType);\n      return unit ? unit.avgRent : 0;\n    };\n\n    // Subject property dataset (teal bars)\n    datasets.push({\n      label: data.subjectProperty.name + ' (Target)',\n      data: labels.map(type => getRentByUnitType(data.subjectProperty, type)),\n      backgroundColor: SUBJECT_PROPERTY_COLOR,\n      borderColor: SUBJECT_PROPERTY_COLOR,\n      borderWidth: 2,\n      borderRadius: 4,\n      isSubject: true,\n    });\n\n    // Competitor datasets (orange tones)\n    data.competitors.forEach((competitor, index) => {\n      const color = COMPETITOR_COLORS[index % COMPETITOR_COLORS.length];\n      datasets.push({\n        label: competitor.name,\n        data: labels.map(type => getRentByUnitType(competitor, type)),\n        backgroundColor: color,\n        borderColor: color,\n        borderWidth: 2,\n        borderRadius: 4,\n        isSubject: false,\n      });\n    });\n\n    return { labels, datasets };\n  }, [data]);\n\n  const chartOptions = useMemo(() => ({\n    responsive: true,\n    maintainAspectRatio: false,\n    plugins: {\n      title: {\n        display: true,\n        text: 'Rent Comparison by Bedrooms',\n        font: {\n          size: 18,\n          weight: 'bold' as const,\n        },\n        padding: 20,\n        color: 'hsl(var(--foreground))',\n      },\n      datalabels: {\n        anchor: 'end' as const,\n        align: 'top' as const,\n        formatter: (value: number) => {\n          return value > 0 ? `$${Math.round(value).toLocaleString()}` : '';\n        },\n        color: 'hsl(var(--foreground))',\n        font: {\n          size: 11,\n          weight: 'bold' as const,\n        },\n      },\n      legend: {\n        position: 'top' as const,\n        align: 'start' as const,\n        labels: {\n          usePointStyle: true,\n          padding: 20,\n          font: {\n            size: 12,\n          },\n          color: 'hsl(var(--foreground))',\n        },\n      },\n      tooltip: {\n        backgroundColor: 'hsl(var(--background))',\n        titleColor: 'hsl(var(--foreground))',\n        bodyColor: 'hsl(var(--muted-foreground))',\n        borderColor: 'hsl(var(--border))',\n        borderWidth: 1,\n        cornerRadius: 8,\n        displayColors: true,\n        callbacks: {\n          title: (context: TooltipItem<'bar'>[]) => {\n            return `${context[0].label} Units`;\n          },\n          beforeBody: (context: TooltipItem<'bar'>[]) => {\n            const datasetIndex = context[0].datasetIndex;\n            const unitType = context[0].label;\n            \n            if (!data) return '';\n            \n            // Find the property data (subject or competitor)\n            let property;\n            if (datasetIndex === 0) {\n              property = data.subjectProperty;\n            } else {\n              property = data.competitors[datasetIndex - 1];\n            }\n            \n            if (!property) return '';\n            \n            const unitTypeData = property.unitTypes.find(u => u.type === unitType);\n            if (!unitTypeData) return '';\n            \n            const lines = [\n              `Property: ${property.name}`,\n              `Total Units: ${unitTypeData.totalUnits}`,\n              `Available: ${unitTypeData.availableUnits}`,\n              `Vacancy Rate: ${unitTypeData.vacancyRate.toFixed(1)}%`,\n            ];\n            \n            if (unitTypeData.avgSqFt > 0) {\n              lines.push(`Avg Sq Ft: ${Math.round(unitTypeData.avgSqFt)}`);\n            }\n            \n            if (unitTypeData.rentRange.min !== unitTypeData.rentRange.max) {\n              lines.push(`Rent Range: $${Math.round(unitTypeData.rentRange.min)} - $${Math.round(unitTypeData.rentRange.max)}`);\n            }\n            \n            return lines;\n          },\n          label: (context: TooltipItem<'bar'>) => {\n            const value = context.parsed.y;\n            return value > 0 ? `Average Rent: $${Math.round(value)}` : 'No data available';\n          },\n        },\n      },\n    },\n    scales: {\n      x: {\n        title: {\n          display: true,\n          text: 'Unit Type',\n          font: {\n            size: 14,\n            weight: 'bold' as const,\n          },\n          color: 'hsl(var(--foreground))',\n        },\n        grid: {\n          display: false,\n        },\n        ticks: {\n          color: 'hsl(var(--foreground))',\n          font: {\n            size: 12,\n          },\n        },\n      },\n      y: {\n        title: {\n          display: true,\n          text: 'Average Rent ($)',\n          font: {\n            size: 14,\n            weight: 'bold' as const,\n          },\n          color: 'hsl(var(--foreground))',\n        },\n        beginAtZero: true,\n        ticks: {\n          callback: function(value: any) {\n            return '$' + value.toLocaleString();\n          },\n          color: 'hsl(var(--foreground))',\n          font: {\n            size: 11,\n          },\n        },\n        grid: {\n          color: 'hsl(var(--border))',\n          borderDash: [3, 3],\n        },\n      },\n    },\n    interaction: {\n      mode: 'index' as const,\n      intersect: false,\n    },\n  }), [data]);\n\n  if (isLoading) {\n    return (\n      <Card data-testid=\"rent-chart-loading\">\n        <CardHeader>\n          <CardTitle>Average Rent Comparison</CardTitle>\n          <CardDescription>Loading rent comparison data...</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-96 flex items-center justify-center\">\n            <div className=\"space-y-4 w-full\">\n              <Skeleton className=\"h-8 w-3/4 mx-auto\" />\n              <Skeleton className=\"h-64 w-full\" />\n              <div className=\"flex justify-center space-x-4\">\n                <Skeleton className=\"h-4 w-20\" />\n                <Skeleton className=\"h-4 w-24\" />\n                <Skeleton className=\"h-4 w-20\" />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card data-testid=\"rent-chart-error\">\n        <CardHeader>\n          <CardTitle>Average Rent Comparison</CardTitle>\n          <CardDescription className=\"text-red-600\">Error loading chart data</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-96 flex items-center justify-center\">\n            <div className=\"text-center space-y-4\">\n              <div className=\"text-red-500 text-sm\">{error}</div>\n              <div className=\"text-muted-foreground text-sm\">\n                Please ensure unit data has been collected for the selected properties.\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!data || !chartData) {\n    return (\n      <Card data-testid=\"rent-chart-no-data\">\n        <CardHeader>\n          <CardTitle>Average Rent Comparison</CardTitle>\n          <CardDescription>No data available</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-96 flex items-center justify-center\">\n            <div className=\"text-center space-y-2\">\n              <div className=\"text-muted-foreground\">No rent comparison data available</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Unit data collection may still be in progress.\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card data-testid=\"rent-comparison-chart\">\n      <CardHeader>\n        <CardTitle>Rent Comparison by Bedrooms</CardTitle>\n        <CardDescription>\n          Comparing average rents across {data.subjectProperty.name} and {data.competitors.length} competitor{data.competitors.length !== 1 ? 's' : ''}\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className=\"h-96 w-full\" data-testid=\"chart-container\">\n          <Bar data={chartData} options={chartOptions} />\n        </div>\n        \n        {/* Unit type summary below chart */}\n        <div className=\"mt-6 space-y-4\" data-testid=\"unit-type-summary\">\n          <h4 className=\"font-semibold text-sm text-muted-foreground uppercase tracking-wide\">\n            Unit Type Summary\n          </h4>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            {UNIT_TYPES.map(unitType => {\n              const subjectUnit = data.subjectProperty.unitTypes.find(u => u.type === unitType);\n              const hasData = subjectUnit && subjectUnit.totalUnits > 0;\n              \n              return (\n                <div key={unitType} className=\"text-center p-3 bg-muted rounded-lg\" data-testid={`unit-summary-${unitType.toLowerCase()}`}>\n                  <div className=\"font-semibold text-sm\">{unitType}</div>\n                  {hasData ? (\n                    <>\n                      <div className=\"text-lg font-bold text-primary\">\n                        ${Math.round(subjectUnit.avgRent).toLocaleString()}\n                      </div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {subjectUnit.totalUnits} units\n                      </div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {subjectUnit.vacancyRate.toFixed(1)}% vacant\n                      </div>\n                    </>\n                  ) : (\n                    <div className=\"text-sm text-muted-foreground\">No data</div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":11468},"client/src/components/filtered-analysis-results.tsx":{"content":"import { memo } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport MarketPositionGauge from \"@/components/analysis/market-position-gauge\";\nimport CompetitiveAdvantagesGrid from \"@/components/analysis/competitive-advantages-grid\";\nimport DynamicInsightsPanel from \"@/components/analysis/dynamic-insights-panel\";\nimport InteractiveComparisonChart from \"@/components/analysis/interactive-comparison-chart\";\nimport type { FilteredAnalysis } from \"@shared/schema\";\n\ninterface FilteredAnalysisResultsProps {\n  analysis: FilteredAnalysis;\n  isLoading?: boolean;\n}\n\n// Skeleton Loading Component\nconst LoadingSkeleton = memo(() => (\n  <div className=\"flex-1 space-y-6\" data-testid=\"analysis-loading\">\n    {/* Top Row: Market Position and Competitive Advantages */}\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      <Skeleton className=\"h-[280px] rounded-lg\" />\n      <Skeleton className=\"h-[280px] rounded-lg\" />\n    </div>\n    \n    {/* Interactive Chart */}\n    <Skeleton className=\"h-[400px] rounded-lg\" />\n    \n    {/* AI Insights Panel */}\n    <Skeleton className=\"h-[200px] rounded-lg\" />\n    \n    {/* Summary Statistics */}\n    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n      {[1, 2, 3, 4].map((i) => (\n        <Skeleton key={i} className=\"h-20 rounded-lg\" />\n      ))}\n    </div>\n  </div>\n));\n\nconst FilteredAnalysisResults = memo(({ \n  analysis, \n  isLoading = false \n}: FilteredAnalysisResultsProps) => {\n  // Handle loading state or missing analysis data\n  if (isLoading || !analysis) {\n    return <LoadingSkeleton />;\n  }\n\n  const containerVariants = {\n    hidden: { opacity: 0 },\n    visible: {\n      opacity: 1,\n      transition: {\n        staggerChildren: 0.1\n      }\n    }\n  };\n\n  const itemVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: { duration: 0.4, ease: \"easeOut\" }\n    }\n  };\n\n  const statVariants = {\n    hidden: { opacity: 0, scale: 0.8 },\n    visible: {\n      opacity: 1,\n      scale: 1,\n      transition: { duration: 0.3, ease: \"easeOut\" }\n    }\n  };\n\n  return (\n    <motion.div \n      className=\"flex-1 space-y-6\" \n      data-testid=\"filtered-analysis-results\"\n      variants={containerVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n    >\n      {/* Top Row: Market Position and Competitive Advantages - NEW ARRANGEMENT */}\n      <motion.div \n        className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\"\n        variants={itemVariants}\n      >\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={`gauge-${analysis.percentileRank}`}\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            transition={{ duration: 0.3 }}\n          >\n            <MarketPositionGauge \n              percentileRank={analysis.percentileRank}\n              marketPosition={analysis.marketPosition}\n              pricingPowerScore={analysis.pricingPowerScore}\n            />\n          </motion.div>\n        </AnimatePresence>\n        \n        {analysis.competitiveEdges && (\n          <AnimatePresence mode=\"wait\">\n            <motion.div\n              key={`edges-${JSON.stringify(analysis.competitiveEdges)}`}\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 0.95 }}\n              transition={{ duration: 0.3 }}\n            >\n              <CompetitiveAdvantagesGrid \n                competitiveEdges={analysis.competitiveEdges}\n              />\n            </motion.div>\n          </AnimatePresence>\n        )}\n      </motion.div>\n\n      {/* Interactive Comparison Chart - FULL WIDTH */}\n      {analysis.subjectUnits && analysis.competitorUnits && (\n        <motion.div variants={itemVariants}>\n          <AnimatePresence mode=\"wait\">\n            <motion.div\n              key={`chart-${analysis.unitCount}`}\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              transition={{ duration: 0.4 }}\n            >\n              <InteractiveComparisonChart \n                subjectUnits={analysis.subjectUnits}\n                competitorUnits={analysis.competitorUnits}\n                isLoading={isLoading}\n              />\n            </motion.div>\n          </AnimatePresence>\n        </motion.div>\n      )}\n\n      {/* AI Insights Panel - FULL WIDTH */}\n      <motion.div variants={itemVariants}>\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={`insights-${analysis.aiInsights?.length || 0}`}\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.3 }}\n          >\n            <DynamicInsightsPanel \n              aiInsights={analysis.aiInsights || []}\n              isLoading={isLoading}\n            />\n          </motion.div>\n        </AnimatePresence>\n      </motion.div>\n\n      {/* Summary Statistics with Animated Numbers */}\n      <motion.div \n        className=\"grid grid-cols-2 md:grid-cols-4 gap-4\"\n        variants={itemVariants}\n      >\n        <motion.div \n          className=\"text-center p-4 bg-muted rounded-lg transition-all hover:shadow-md\" \n          data-testid=\"unit-count\"\n          variants={statVariants}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          <motion.div \n            className=\"text-2xl font-bold text-primary\" \n            data-testid=\"unit-count-value\"\n            key={analysis.unitCount}\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ duration: 0.5 }}\n          >\n            {analysis.unitCount}\n          </motion.div>\n          <div className=\"text-sm text-muted-foreground\">Your Units</div>\n        </motion.div>\n        \n        <motion.div \n          className=\"text-center p-4 bg-muted rounded-lg transition-all hover:shadow-md\" \n          data-testid=\"avg-rent\"\n          variants={statVariants}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          <motion.div \n            className=\"text-2xl font-bold text-primary\" \n            data-testid=\"avg-rent-value\"\n            key={analysis.avgRent}\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ duration: 0.5 }}\n          >\n            ${analysis.avgRent.toLocaleString()}\n          </motion.div>\n          <div className=\"text-sm text-muted-foreground\">Avg Rent</div>\n        </motion.div>\n        \n        <motion.div \n          className=\"text-center p-4 bg-muted rounded-lg transition-all hover:shadow-md\" \n          data-testid=\"location-score\"\n          variants={statVariants}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          <motion.div \n            className=\"text-2xl font-bold text-primary\" \n            data-testid=\"location-score-value\"\n            key={analysis.locationScore}\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ duration: 0.5 }}\n          >\n            {analysis.locationScore}/100\n          </motion.div>\n          <div className=\"text-sm text-muted-foreground\">Location Score</div>\n        </motion.div>\n        \n        <motion.div \n          className=\"text-center p-4 bg-muted rounded-lg transition-all hover:shadow-md\" \n          data-testid=\"price-per-sqft\"\n          variants={statVariants}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          <motion.div \n            className=\"text-2xl font-bold text-primary\" \n            data-testid=\"price-per-sqft-value\"\n            key={analysis.pricePerSqFt}\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ duration: 0.5 }}\n          >\n            ${analysis.pricePerSqFt}\n          </motion.div>\n          <div className=\"text-sm text-muted-foreground\">Price/Sq Ft</div>\n        </motion.div>\n      </motion.div>\n    </motion.div>\n  );\n});\n\nexport default FilteredAnalysisResults;","size_bytes":8250},"client/src/components/unit-listings-table.tsx":{"content":"import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Building2, Home, Bed, Bath, Square, DollarSign, Calendar } from \"lucide-react\";\n\ninterface Unit {\n  unitNumber: string;\n  unitType: string;\n  bedrooms: number;\n  bathrooms: string;\n  squareFootage: number;\n  rent: string;\n  availabilityDate: string;\n  status: string;\n}\n\ninterface UnitListingsTableProps {\n  propertyName: string;\n  units: Unit[];\n  isSubjectProperty?: boolean;\n}\n\nexport default function UnitListingsTable({ \n  propertyName, \n  units, \n  isSubjectProperty = false \n}: UnitListingsTableProps) {\n  // Helper function to format availability date\n  const formatAvailability = (date: string, status: string) => {\n    if (!date || date === 'Contact for availability') {\n      return 'Contact for availability';\n    }\n    \n    const lowerDate = date.toLowerCase();\n    const lowerStatus = status.toLowerCase();\n    \n    if (lowerStatus === 'available' || lowerDate.includes('available now') || lowerDate.includes('immediately')) {\n      return 'Available Now';\n    }\n    \n    // Try to parse the date\n    try {\n      const parsedDate = new Date(date);\n      if (!isNaN(parsedDate.getTime())) {\n        const options: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric' };\n        return `Available ${parsedDate.toLocaleDateString('en-US', options)}`;\n      }\n    } catch {\n      // Fall back to original string if parsing fails\n    }\n    \n    return date;\n  };\n\n  // Helper function to format rent\n  const formatRent = (rent: string | number) => {\n    const rentValue = typeof rent === 'string' ? parseFloat(rent) : rent;\n    if (isNaN(rentValue) || rentValue === 0) {\n      return 'Contact for pricing';\n    }\n    return `$${rentValue.toLocaleString()}`;\n  };\n\n  // Helper function to format square footage\n  const formatSqFt = (sqft: number) => {\n    if (!sqft || sqft === 0) {\n      return 'N/A';\n    }\n    return sqft.toLocaleString();\n  };\n\n  // Helper function to format bathrooms\n  const formatBathrooms = (bathrooms: string | number) => {\n    const value = typeof bathrooms === 'string' ? bathrooms : bathrooms.toString();\n    if (!value || value === '0') {\n      return 'N/A';\n    }\n    return value;\n  };\n\n  // Helper function to get status badge variant\n  const getStatusVariant = (status: string) => {\n    const lowerStatus = status.toLowerCase();\n    if (lowerStatus === 'available') {\n      return 'default';\n    } else if (lowerStatus === 'occupied') {\n      return 'secondary';\n    }\n    return 'outline';\n  };\n\n  return (\n    <Card className={`${isSubjectProperty ? 'border-primary' : ''}`}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          {isSubjectProperty ? (\n            <Home className=\"h-5 w-5 text-primary\" />\n          ) : (\n            <Building2 className=\"h-5 w-5 text-muted-foreground\" />\n          )}\n          {propertyName} - Unit Listings\n          {isSubjectProperty && (\n            <Badge variant=\"default\" className=\"ml-2\">\n              Subject Property\n            </Badge>\n          )}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {units.length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            No unit data available for this property\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"min-w-[100px]\">Unit Number</TableHead>\n                  <TableHead className=\"min-w-[100px]\">Unit Type</TableHead>\n                  <TableHead className=\"text-center min-w-[60px]\">\n                    <div className=\"flex items-center justify-center gap-1\">\n                      <Bed className=\"h-3 w-3\" />\n                      Beds\n                    </div>\n                  </TableHead>\n                  <TableHead className=\"text-center min-w-[60px]\">\n                    <div className=\"flex items-center justify-center gap-1\">\n                      <Bath className=\"h-3 w-3\" />\n                      Baths\n                    </div>\n                  </TableHead>\n                  <TableHead className=\"text-right min-w-[80px]\">\n                    <div className=\"flex items-center justify-end gap-1\">\n                      <Square className=\"h-3 w-3\" />\n                      Sq Ft\n                    </div>\n                  </TableHead>\n                  <TableHead className=\"text-right min-w-[100px]\">\n                    <div className=\"flex items-center justify-end gap-1\">\n                      <DollarSign className=\"h-3 w-3\" />\n                      Rent\n                    </div>\n                  </TableHead>\n                  <TableHead className=\"min-w-[140px]\">\n                    <div className=\"flex items-center gap-1\">\n                      <Calendar className=\"h-3 w-3\" />\n                      Availability\n                    </div>\n                  </TableHead>\n                  <TableHead className=\"text-center min-w-[80px]\">Status</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {units.map((unit, index) => (\n                  <TableRow key={`${unit.unitNumber}-${index}`} data-testid={`unit-row-${index}`}>\n                    <TableCell className=\"font-medium\">{unit.unitNumber || 'N/A'}</TableCell>\n                    <TableCell>{unit.unitType}</TableCell>\n                    <TableCell className=\"text-center\">{unit.bedrooms || 0}</TableCell>\n                    <TableCell className=\"text-center\">{formatBathrooms(unit.bathrooms)}</TableCell>\n                    <TableCell className=\"text-right\">{formatSqFt(unit.squareFootage)}</TableCell>\n                    <TableCell className=\"text-right font-semibold\">\n                      {formatRent(unit.rent)}\n                    </TableCell>\n                    <TableCell>{formatAvailability(unit.availabilityDate, unit.status)}</TableCell>\n                    <TableCell className=\"text-center\">\n                      <Badge variant={getStatusVariant(unit.status)}>\n                        {unit.status || 'Unknown'}\n                      </Badge>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6538},"client/src/hooks/use-workflow-state.ts":{"content":"import { useState, useEffect } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport interface WorkflowState {\n  stage?: string;\n  selectedCompetitorIds?: string[];\n  filterCriteria?: any;\n  optimizationParams?: any;\n  timestamp?: string;\n}\n\nexport function useWorkflowState(propertyId: string) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [state, setState] = useState<WorkflowState | null>(null);\n\n  const loadState = async (): Promise<WorkflowState | null> => {\n    try {\n      setIsLoading(true);\n      const response = await apiRequest('GET', `/api/workflow/${propertyId}`);\n      if (response.ok) {\n        const data = await response.json();\n        setState(data);\n        return data;\n      }\n      return null;\n    } catch (error) {\n      console.error(\"Error loading workflow state:\", error);\n      return null;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const saveState = async (updates: Partial<WorkflowState>): Promise<void> => {\n    try {\n      const updatedState = {\n        ...state,\n        ...updates,\n        timestamp: new Date().toISOString()\n      };\n      \n      await apiRequest('PUT', `/api/workflow/${propertyId}`, updatedState);\n      setState(updatedState);\n    } catch (error) {\n      console.error(\"Error saving workflow state:\", error);\n    }\n  };\n\n  // Load state on mount\n  useEffect(() => {\n    if (propertyId) {\n      loadState();\n    }\n  }, [propertyId]);\n\n  return { \n    state, \n    isLoading, \n    loadState, \n    saveState \n  };\n}","size_bytes":1518},"test-matching.js":{"content":"// Test script to verify property matching improvements\n\nconst testPropertyMatching = async () => {\n  const BASE_URL = 'http://localhost:5000';\n  \n  console.log('Testing Property Matching Improvements');\n  console.log('=====================================\\n');\n  \n  // First, get all properties\n  try {\n    const propertiesResponse = await fetch(`${BASE_URL}/api/properties`);\n    const properties = await propertiesResponse.json();\n    \n    if (properties.length === 0) {\n      console.log('No properties found. Creating a test property...');\n      \n      // Create The Atlas property for testing\n      const createResponse = await fetch(`${BASE_URL}/api/properties`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          propertyName: 'The Atlas',\n          address: '1000 Main Street, Omaha, NE 68102',\n          city: 'Omaha',\n          state: 'NE',\n          totalUnits: 100\n        })\n      });\n      \n      const { property } = await createResponse.json();\n      console.log(`‚úÖ Created property: ${property.propertyName} (ID: ${property.id})`);\n      \n      // Now test the sync-units endpoint\n      console.log('\\nüìä Testing sync-units endpoint with fuzzy matching...');\n      const syncResponse = await fetch(`${BASE_URL}/api/properties/${property.id}/sync-units`, {\n        method: 'POST'\n      });\n      \n      const syncResult = await syncResponse.json();\n      console.log('Sync Result:', JSON.stringify(syncResult, null, 2));\n      \n      // Test the debug-matching endpoint\n      console.log('\\nüîç Testing debug-matching endpoint...');\n      const debugResponse = await fetch(`${BASE_URL}/api/properties/${property.id}/debug-matching`);\n      const debugResult = await debugResponse.json();\n      \n      console.log('Debug Matching Summary:');\n      console.log(`- Total scraped properties: ${debugResult.summary.totalScrapedProperties}`);\n      console.log(`- Has subject property: ${debugResult.summary.hasSubjectProperty}`);\n      console.log(`- Best match score: ${debugResult.summary.bestMatchScore}%`);\n      \n      if (debugResult.recommendations && debugResult.recommendations.length > 0) {\n        console.log('\\nüìù Recommendations:');\n        debugResult.recommendations.forEach(rec => {\n          console.log(`- [${rec.action}] ${rec.message}`);\n        });\n      }\n      \n      if (debugResult.bestMatch) {\n        console.log('\\nüéØ Best Match Details:');\n        console.log(`- Name: ${debugResult.bestMatch.name}`);\n        console.log(`- Address: ${debugResult.bestMatch.address}`);\n        console.log(`- Score: ${debugResult.bestMatch.matchScore}%`);\n        console.log(`- Is Subject: ${debugResult.bestMatch.isSubjectProperty}`);\n      }\n      \n    } else {\n      console.log(`Found ${properties.length} existing properties`);\n      \n      // Test with the first property\n      const testProperty = properties[0];\n      console.log(`\\nüìã Testing with: ${testProperty.propertyName} (ID: ${testProperty.id})`);\n      \n      // Test debug-matching endpoint\n      console.log('\\nüîç Testing debug-matching endpoint...');\n      const debugResponse = await fetch(`${BASE_URL}/api/properties/${testProperty.id}/debug-matching`);\n      const debugResult = await debugResponse.json();\n      \n      console.log('Debug Matching Summary:');\n      console.log(`- Total scraped properties: ${debugResult.summary.totalScrapedProperties}`);\n      console.log(`- Has subject property: ${debugResult.summary.hasSubjectProperty}`);\n      console.log(`- Best match score: ${debugResult.summary.bestMatchScore}%`);\n      console.log(`- Match threshold: ${debugResult.summary.matchThreshold}%`);\n      \n      if (debugResult.currentSubject) {\n        console.log('\\n‚úÖ Current Subject Property:');\n        console.log(`- Name: ${debugResult.currentSubject.name}`);\n        console.log(`- Score: ${debugResult.currentSubject.matchScore}%`);\n        console.log(`- URL: ${debugResult.currentSubject.url}`);\n      }\n      \n      if (debugResult.bestMatch && !debugResult.currentSubject) {\n        console.log('\\nüéØ Best Match (not marked as subject):');\n        console.log(`- Name: ${debugResult.bestMatch.name}`);\n        console.log(`- Score: ${debugResult.bestMatch.matchScore}%`);\n        console.log(`- URL: ${debugResult.bestMatch.url}`);\n      }\n      \n      // Test sync-units endpoint\n      console.log('\\nüìä Testing sync-units endpoint...');\n      const syncResponse = await fetch(`${BASE_URL}/api/properties/${testProperty.id}/sync-units`, {\n        method: 'POST'\n      });\n      \n      const syncResult = await syncResponse.json();\n      if (syncResponse.ok) {\n        console.log(`‚úÖ Successfully synced ${syncResult.unitsCount} units`);\n        if (syncResult.fallbackUsed) {\n          console.log('‚ö†Ô∏è Fallback matching was used');\n        }\n        if (syncResult.subjectProperty) {\n          console.log(`üìç Subject Property: ${syncResult.subjectProperty.name}`);\n        }\n      } else {\n        console.log(`‚ùå Sync failed: ${syncResult.message}`);\n        if (syncResult.suggestions) {\n          console.log('\\nüí° Suggestions:');\n          syncResult.suggestions.forEach(s => console.log(`- ${s}`));\n        }\n      }\n    }\n    \n    console.log('\\n‚úÖ Test completed successfully!');\n    \n  } catch (error) {\n    console.error('‚ùå Test failed:', error.message);\n  }\n};\n\n// Run the test\ntestPropertyMatching();","size_bytes":5439},"client/src/components/analysis/competitive-advantages-grid.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { DollarSign, Square, Calendar } from \"lucide-react\";\nimport type { CompetitiveEdges } from \"@shared/schema\";\n\ninterface CompetitiveAdvantagesGridProps {\n  competitiveEdges: CompetitiveEdges;\n}\n\nexport default function CompetitiveAdvantagesGrid({ \n  competitiveEdges \n}: CompetitiveAdvantagesGridProps) {\n  const getStatusColor = (status: \"advantage\" | \"neutral\" | \"disadvantage\") => {\n    switch (status) {\n      case \"advantage\": return \"bg-green-100 text-green-700 border-green-300\";\n      case \"neutral\": return \"bg-yellow-100 text-yellow-700 border-yellow-300\";\n      case \"disadvantage\": return \"bg-red-100 text-red-700 border-red-300\";\n    }\n  };\n\n  const getStatusBadge = (status: \"advantage\" | \"neutral\" | \"disadvantage\") => {\n    switch (status) {\n      case \"advantage\": return \"Advantage\";\n      case \"neutral\": return \"Neutral\";\n      case \"disadvantage\": return \"Disadvantage\";\n    }\n  };\n\n  const edges = [\n    {\n      key: \"pricing\",\n      title: \"Pricing\",\n      icon: <DollarSign className=\"h-5 w-5\" />,\n      data: competitiveEdges.pricing\n    },\n    {\n      key: \"size\",\n      title: \"Unit Size\",\n      icon: <Square className=\"h-5 w-5\" />,\n      data: competitiveEdges.size\n    },\n    {\n      key: \"availability\",\n      title: \"Availability\",\n      icon: <Calendar className=\"h-5 w-5\" />,\n      data: competitiveEdges.availability\n    }\n  ];\n\n  return (\n    <div \n      className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\" \n      data-testid=\"competitive-advantages-grid\"\n    >\n      {edges.map((edge) => (\n        <Card \n          key={edge.key}\n          className={`h-full border-2 ${getStatusColor(edge.data.status)} transition-all hover:shadow-lg`}\n          data-testid={`edge-card-${edge.key}`}\n        >\n          <CardContent className=\"p-4 h-full flex flex-col\">\n            {/* Header with icon and title */}\n            <div className=\"text-center mb-3 space-y-2\">\n              <div className=\"flex items-center justify-center gap-2\">\n                {edge.icon}\n                <span className=\"font-semibold text-sm\">{edge.title}</span>\n              </div>\n              <div className=\"flex justify-center\">\n                <Badge \n                  variant=\"outline\" \n                  className=\"text-xs whitespace-nowrap\"\n                  data-testid={`status-badge-${edge.key}`}\n                >\n                  {getStatusBadge(edge.data.status)}\n                </Badge>\n              </div>\n            </div>\n\n            {/* Edge value display */}\n            <div className=\"flex-1 flex items-center justify-center py-3\">\n              <div \n                className=\"text-xl lg:text-2xl font-bold text-center leading-tight\"\n                data-testid={`edge-value-${edge.key}`}\n              >\n                {edge.key === \"pricing\" && edge.data.edge !== 0 && (\n                  <div className=\"flex flex-col items-center\">\n                    <span>{edge.data.edge > 0 ? `+${edge.data.edge}%` : `${edge.data.edge}%`}</span>\n                  </div>\n                )}\n                {edge.key === \"size\" && edge.data.edge !== 0 && (\n                  <div className=\"flex flex-col items-center\">\n                    <span>{edge.data.edge > 0 ? `+${edge.data.edge}` : `${edge.data.edge}`}</span>\n                    <span className=\"text-sm font-normal\">sq ft</span>\n                  </div>\n                )}\n                {edge.key === \"availability\" && (\n                  <div className=\"flex flex-col items-center\">\n                    <span>{edge.data.edge !== 0 ? `${Math.abs(edge.data.edge)}` : \"0\"}</span>\n                    <span className=\"text-sm font-normal\">\n                      {edge.data.edge !== 0 ? \"units\" : \"equal\"}\n                    </span>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Description label */}\n            <div className=\"text-center mt-auto\">\n              <span \n                className=\"text-xs font-medium leading-tight block\"\n                data-testid={`edge-label-${edge.key}`}\n              >\n                {edge.data.label}\n              </span>\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}","size_bytes":4327},"client/src/components/analysis/dynamic-insights-panel.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Lightbulb, Sparkles, RefreshCw } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\n\ninterface DynamicInsightsPanelProps {\n  aiInsights: string[];\n  isLoading?: boolean;\n}\n\nexport default function DynamicInsightsPanel({ \n  aiInsights, \n  isLoading = false \n}: DynamicInsightsPanelProps) {\n  const [displayedInsights, setDisplayedInsights] = useState<string[]>([]);\n  const [animating, setAnimating] = useState(false);\n\n  useEffect(() => {\n    if (aiInsights && aiInsights.length > 0 && !isLoading) {\n      setAnimating(true);\n      setTimeout(() => {\n        setDisplayedInsights(aiInsights);\n        setAnimating(false);\n      }, 300);\n    }\n  }, [aiInsights, isLoading]);\n\n  const getInsightIcon = (index: number) => {\n    const icons = [\n      <Lightbulb className=\"h-4 w-4\" />,\n      <Sparkles className=\"h-4 w-4\" />,\n      <RefreshCw className=\"h-4 w-4\" />\n    ];\n    return icons[index] || icons[0];\n  };\n\n  return (\n    <Card data-testid=\"dynamic-insights-panel\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"flex items-center gap-2\">\n          <Sparkles className=\"h-5 w-5 text-yellow-500\" />\n          AI-Generated Insights\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-3\" data-testid=\"insights-loading\">\n            <Skeleton className=\"h-20 w-full\" />\n            <Skeleton className=\"h-20 w-full\" />\n            <Skeleton className=\"h-20 w-full\" />\n          </div>\n        ) : displayedInsights.length > 0 ? (\n          <div \n            className={`space-y-3 transition-opacity duration-300 ${\n              animating ? 'opacity-50' : 'opacity-100'\n            }`}\n            data-testid=\"insights-list\"\n          >\n            {displayedInsights.map((insight, index) => (\n              <Alert \n                key={index} \n                className=\"border-l-4 border-l-primary\"\n                data-testid={`insight-${index}`}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"flex-shrink-0 mt-1\">\n                    <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center\">\n                      <span className=\"text-sm font-bold text-primary\">\n                        {index + 1}\n                      </span>\n                    </div>\n                  </div>\n                  <AlertDescription className=\"flex-1\">\n                    <div className=\"flex items-start gap-2\">\n                      <div className=\"mt-0.5 text-primary\">\n                        {getInsightIcon(index)}\n                      </div>\n                      <span className=\"text-sm leading-relaxed\">\n                        {insight}\n                      </span>\n                    </div>\n                  </AlertDescription>\n                </div>\n              </Alert>\n            ))}\n          </div>\n        ) : (\n          <Alert data-testid=\"no-insights\">\n            <Lightbulb className=\"h-4 w-4\" />\n            <AlertDescription>\n              No AI insights available. Insights will be generated based on your filter selections and market comparison data.\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {/* Insights metadata */}\n        {displayedInsights.length > 0 && !isLoading && (\n          <div className=\"mt-4 pt-4 border-t\">\n            <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n              <span>Generated from {aiInsights.length} market factors</span>\n              <span>Updates with filter changes</span>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":3886},"client/src/components/analysis/interactive-comparison-chart.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\nimport { \n  Chart as ChartJS, \n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend\n} from 'chart.js';\nimport { Scatter, Bar } from 'react-chartjs-2';\nimport type { UnitComparison } from \"@shared/schema\";\n\n// Register ChartJS components\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend\n);\n\ninterface InteractiveComparisonChartProps {\n  subjectUnits: UnitComparison[];\n  competitorUnits: UnitComparison[];\n  isLoading?: boolean;\n}\n\nexport default function InteractiveComparisonChart({ \n  subjectUnits, \n  competitorUnits,\n  isLoading = false \n}: InteractiveComparisonChartProps) {\n  // State for chart type and metric type\n  const [chartType, setChartType] = useState<\"scatter\" | \"bar\">(\"scatter\");\n  const [metricType, setMetricType] = useState<\"unitPrice\" | \"pricePerSqFt\">(\"unitPrice\");\n\n  // Calculate price per sq ft for a unit\n  const getPricePerSqFt = (unit: UnitComparison) => {\n    return unit.squareFootage && unit.squareFootage > 0 \n      ? unit.rent / unit.squareFootage \n      : null;\n  };\n\n  // Truncate property name for bar chart labels\n  const truncatePropertyName = (name: string, maxLength: number = 15) => {\n    return name.length > maxLength ? name.substring(0, maxLength) + '...' : name;\n  };\n\n  // Prepare data for scatter chart\n  const subjectScatterData = useMemo(() => {\n    return subjectUnits\n      .filter(unit => metricType === \"unitPrice\" || getPricePerSqFt(unit) !== null)\n      .map(unit => ({\n        x: unit.squareFootage || 0,\n        y: metricType === \"unitPrice\" ? unit.rent : getPricePerSqFt(unit),\n        unitInfo: unit\n      }));\n  }, [subjectUnits, metricType]);\n\n  const competitorScatterData = useMemo(() => {\n    return competitorUnits\n      .filter(unit => metricType === \"unitPrice\" || getPricePerSqFt(unit) !== null)\n      .map(unit => ({\n        x: unit.squareFootage || 0,\n        y: metricType === \"unitPrice\" ? unit.rent : getPricePerSqFt(unit),\n        unitInfo: unit\n      }));\n  }, [competitorUnits, metricType]);\n\n  // Prepare data for bar chart\n  const barData = useMemo(() => {\n    const filteredSubjectUnits = metricType === \"pricePerSqFt\" \n      ? subjectUnits.filter(unit => getPricePerSqFt(unit) !== null)\n      : subjectUnits;\n    const filteredCompetitorUnits = metricType === \"pricePerSqFt\"\n      ? competitorUnits.filter(unit => getPricePerSqFt(unit) !== null)\n      : competitorUnits;\n    \n    const allUnits = [...filteredSubjectUnits, ...filteredCompetitorUnits];\n    const barLabels = allUnits.map((unit, index) => {\n      const prefix = filteredSubjectUnits.includes(unit) ? 'S' : 'C';\n      return `${prefix}${index + 1}: ${truncatePropertyName(unit.propertyName)}`;\n    });\n\n    return {\n      labels: barLabels,\n      datasets: [\n        {\n          label: 'Your Units',\n          data: allUnits.map(unit => \n            filteredSubjectUnits.includes(unit) \n              ? (metricType === \"unitPrice\" ? unit.rent : getPricePerSqFt(unit))\n              : null\n          ),\n          backgroundColor: 'rgba(59, 130, 246, 0.6)', // Blue\n          borderColor: 'rgba(59, 130, 246, 1)',\n          borderWidth: 2,\n          categoryPercentage: 0.8,\n          barPercentage: 0.9,\n        },\n        {\n          label: 'Competitor Units',\n          data: allUnits.map(unit => \n            filteredCompetitorUnits.includes(unit) \n              ? (metricType === \"unitPrice\" ? unit.rent : getPricePerSqFt(unit))\n              : null\n          ),\n          backgroundColor: 'rgba(239, 68, 68, 0.4)', // Red\n          borderColor: 'rgba(239, 68, 68, 0.8)',\n          borderWidth: 1,\n          categoryPercentage: 0.8,\n          barPercentage: 0.9,\n        }\n      ],\n    };\n  }, [subjectUnits, competitorUnits, metricType]);\n\n  const scatterData = useMemo(() => {\n    return {\n      datasets: [\n        {\n          label: 'Your Units',\n          data: subjectScatterData,\n          backgroundColor: 'rgba(59, 130, 246, 0.6)', // Blue\n          borderColor: 'rgba(59, 130, 246, 1)',\n          borderWidth: 2,\n          pointStyle: 'circle',\n          pointRadius: (context: any) => {\n            const unit = context.raw?.unitInfo;\n            return unit ? 4 + (unit.bedrooms * 2) : 6;\n          },\n        },\n        {\n          label: 'Competitor Units',\n          data: competitorScatterData,\n          backgroundColor: 'rgba(239, 68, 68, 0.4)', // Red\n          borderColor: 'rgba(239, 68, 68, 0.8)',\n          borderWidth: 1,\n          pointStyle: 'circle',\n          pointRadius: (context: any) => {\n            const unit = context.raw?.unitInfo;\n            return unit ? 4 + (unit.bedrooms * 2) : 6;\n          },\n        }\n      ],\n    };\n  }, [subjectScatterData, competitorScatterData]);\n\n  const scatterOptions = useMemo(() => ({\n    responsive: true,\n    maintainAspectRatio: false,\n    plugins: {\n      legend: {\n        position: 'top' as const,\n      },\n      title: {\n        display: false,\n      },\n      tooltip: {\n        callbacks: {\n          label: function(context: any) {\n            const unitInfo = context.raw.unitInfo;\n            const pricePerSqFt = getPricePerSqFt(unitInfo);\n            return [\n              `Property: ${unitInfo.propertyName}`,\n              `Type: ${unitInfo.unitType}`,\n              `Rent: $${unitInfo.rent.toLocaleString()}`,\n              `Size: ${unitInfo.squareFootage || 'N/A'} sq ft`,\n              `Price/SqFt: ${pricePerSqFt !== null ? `$${pricePerSqFt.toFixed(2)}` : 'N/A'}`,\n              `Bedrooms: ${unitInfo.bedrooms}`,\n              `Bathrooms: ${unitInfo.bathrooms || 'N/A'}`\n            ];\n          }\n        }\n      }\n    },\n    scales: {\n      x: {\n        title: {\n          display: true,\n          text: 'Square Footage',\n        },\n        min: 0,\n        grid: {\n          color: 'rgba(0, 0, 0, 0.05)',\n        }\n      },\n      y: {\n        title: {\n          display: true,\n          text: metricType === \"unitPrice\" ? 'Monthly Rent ($)' : 'Price per Sq Ft ($/sq ft)',\n        },\n        min: 0,\n        grid: {\n          color: 'rgba(0, 0, 0, 0.05)',\n        },\n        ticks: {\n          callback: function(value: any) {\n            return metricType === \"unitPrice\" \n              ? '$' + value.toLocaleString()\n              : '$' + value.toFixed(2);\n          }\n        }\n      }\n    }\n  }), [metricType]);\n\n  const barOptions = useMemo(() => {\n    const filteredSubjectUnits = metricType === \"pricePerSqFt\" \n      ? subjectUnits.filter(unit => getPricePerSqFt(unit) !== null)\n      : subjectUnits;\n    const filteredCompetitorUnits = metricType === \"pricePerSqFt\"\n      ? competitorUnits.filter(unit => getPricePerSqFt(unit) !== null)\n      : competitorUnits;\n    const allUnits = [...filteredSubjectUnits, ...filteredCompetitorUnits];\n    \n    return {\n      responsive: true,\n      maintainAspectRatio: false,\n      plugins: {\n        legend: {\n          position: 'top' as const,\n        },\n        title: {\n          display: false,\n        },\n        tooltip: {\n          callbacks: {\n            label: function(context: any) {\n              const index = context.dataIndex;\n              const unit = allUnits[index];\n              const pricePerSqFt = getPricePerSqFt(unit);\n              return [\n                `Property: ${unit.propertyName}`,\n                `Type: ${unit.unitType}`,\n                `Rent: $${unit.rent.toLocaleString()}`,\n                `Size: ${unit.squareFootage || 'N/A'} sq ft`,\n                `Price/SqFt: ${pricePerSqFt !== null ? `$${pricePerSqFt.toFixed(2)}` : 'N/A'}`,\n                `Bedrooms: ${unit.bedrooms}`,\n                `Bathrooms: ${unit.bathrooms || 'N/A'}`\n              ];\n            }\n          }\n        }\n      },\n      scales: {\n        x: {\n          title: {\n            display: true,\n            text: 'Units',\n          },\n          grid: {\n            color: 'rgba(0, 0, 0, 0.05)',\n          },\n          ticks: {\n            autoSkip: true,\n            maxTicksLimit: 20,\n            maxRotation: 45,\n            minRotation: 45\n          }\n        },\n        y: {\n          title: {\n            display: true,\n            text: metricType === \"unitPrice\" ? 'Monthly Rent ($)' : 'Price per Sq Ft ($/sq ft)',\n          },\n          min: 0,\n          grid: {\n            color: 'rgba(0, 0, 0, 0.05)',\n          },\n          ticks: {\n            callback: function(value: any) {\n              return metricType === \"unitPrice\" \n                ? '$' + value.toLocaleString()\n                : '$' + value.toFixed(2);\n            }\n          }\n        }\n      }\n    };\n  }, [subjectUnits, competitorUnits, metricType]);\n\n  // Calculate summary statistics\n  const totalUnits = subjectUnits.length + competitorUnits.length;\n  \n  const avgSubjectRent = subjectUnits.length > 0 \n    ? subjectUnits.reduce((sum, u) => sum + u.rent, 0) / subjectUnits.length \n    : 0;\n  const avgCompetitorRent = competitorUnits.length > 0\n    ? competitorUnits.reduce((sum, u) => sum + u.rent, 0) / competitorUnits.length\n    : 0;\n    \n  const subjectUnitsWithSqFt = subjectUnits.filter(u => getPricePerSqFt(u) !== null);\n  const competitorUnitsWithSqFt = competitorUnits.filter(u => getPricePerSqFt(u) !== null);\n  \n  const avgSubjectPricePerSqFt = subjectUnitsWithSqFt.length > 0\n    ? subjectUnitsWithSqFt.reduce((sum, u) => sum + (getPricePerSqFt(u) || 0), 0) / subjectUnitsWithSqFt.length\n    : 0;\n  const avgCompetitorPricePerSqFt = competitorUnitsWithSqFt.length > 0\n    ? competitorUnitsWithSqFt.reduce((sum, u) => sum + (getPricePerSqFt(u) || 0), 0) / competitorUnitsWithSqFt.length\n    : 0;\n\n  const displaySubjectMetric = metricType === \"unitPrice\" ? avgSubjectRent : avgSubjectPricePerSqFt;\n  const displayCompetitorMetric = metricType === \"unitPrice\" ? avgCompetitorRent : avgCompetitorPricePerSqFt;\n  const displayDifference = displaySubjectMetric - displayCompetitorMetric;\n\n  return (\n    <Card data-testid=\"interactive-comparison-chart\">\n      <CardHeader>\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Unit-Level Market Comparison</CardTitle>\n            <div className=\"flex gap-2\">\n              <Badge variant=\"secondary\" data-testid=\"subject-units-count\">\n                {subjectUnits.length} Your Units\n              </Badge>\n              <Badge variant=\"outline\" data-testid=\"competitor-units-count\">\n                {competitorUnits.length} Competitor Units\n              </Badge>\n            </div>\n          </div>\n          \n          {/* Chart Controls */}\n          <div className=\"flex gap-4 items-center\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm font-medium\">Chart Type:</span>\n              <ToggleGroup \n                type=\"single\" \n                value={chartType} \n                onValueChange={(value) => value && setChartType(value as \"scatter\" | \"bar\")}\n                data-testid=\"toggle-chart-type\"\n              >\n                <ToggleGroupItem value=\"scatter\" aria-label=\"Scatter chart\" data-testid=\"toggle-scatter\">\n                  Scatter\n                </ToggleGroupItem>\n                <ToggleGroupItem value=\"bar\" aria-label=\"Bar chart\" data-testid=\"toggle-bar\">\n                  Bar\n                </ToggleGroupItem>\n              </ToggleGroup>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm font-medium\">Metric:</span>\n              <ToggleGroup \n                type=\"single\" \n                value={metricType} \n                onValueChange={(value) => value && setMetricType(value as \"unitPrice\" | \"pricePerSqFt\")}\n                data-testid=\"toggle-metric-type\"\n              >\n                <ToggleGroupItem value=\"unitPrice\" aria-label=\"Unit price\" data-testid=\"toggle-unit-price\">\n                  Unit Price\n                </ToggleGroupItem>\n                <ToggleGroupItem value=\"pricePerSqFt\" aria-label=\"Price per sq ft\" data-testid=\"toggle-price-per-sqft\">\n                  Price per Sq Ft\n                </ToggleGroupItem>\n              </ToggleGroup>\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-4\" data-testid=\"chart-loading\">\n            <Skeleton className=\"h-[400px] w-full\" />\n            <div className=\"grid grid-cols-3 gap-4\">\n              <Skeleton className=\"h-20\" />\n              <Skeleton className=\"h-20\" />\n              <Skeleton className=\"h-20\" />\n            </div>\n          </div>\n        ) : totalUnits > 0 ? (\n          <>\n            {/* Chart Container */}\n            <div className=\"h-[400px] mb-6\" data-testid={chartType === \"scatter\" ? \"scatter-chart\" : \"bar-chart\"}>\n              {chartType === \"scatter\" ? (\n                <Scatter data={scatterData} options={scatterOptions} />\n              ) : (\n                <Bar data={barData} options={barOptions} />\n              )}\n            </div>\n\n            {/* Summary Statistics */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"text-center p-4 bg-blue-50 rounded-lg\" data-testid=\"avg-subject-metric\">\n                <div className=\"text-2xl font-bold text-blue-600\">\n                  {metricType === \"unitPrice\" \n                    ? `$${Math.round(displaySubjectMetric).toLocaleString()}`\n                    : `$${displaySubjectMetric.toFixed(2)}`}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {metricType === \"unitPrice\" ? \"Your Avg Rent\" : \"Your Avg $/SqFt\"}\n                </div>\n              </div>\n              <div className=\"text-center p-4 bg-red-50 rounded-lg\" data-testid=\"avg-competitor-metric\">\n                <div className=\"text-2xl font-bold text-red-600\">\n                  {metricType === \"unitPrice\" \n                    ? `$${Math.round(displayCompetitorMetric).toLocaleString()}`\n                    : `$${displayCompetitorMetric.toFixed(2)}`}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {metricType === \"unitPrice\" ? \"Competitor Avg Rent\" : \"Competitor Avg $/SqFt\"}\n                </div>\n              </div>\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\" data-testid=\"metric-difference\">\n                <div className={`text-2xl font-bold ${\n                  displayDifference > 0 ? 'text-green-600' : \n                  displayDifference < 0 ? 'text-orange-600' : \n                  'text-gray-600'\n                }`}>\n                  {displayDifference > 0 ? '+' : ''}\n                  {metricType === \"unitPrice\" \n                    ? `$${Math.round(displayDifference).toLocaleString()}`\n                    : `$${displayDifference.toFixed(2)}`}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Difference\n                </div>\n              </div>\n            </div>\n\n            {/* Chart Legend Info */}\n            <div className=\"mt-4 text-xs text-muted-foreground text-center\">\n              {chartType === \"scatter\" \n                ? \"Bubble size represents bedroom count. Hover over points for detailed unit information.\"\n                : \"S = Subject (Your) Units, C = Competitor Units. Hover over bars for detailed unit information.\"}\n            </div>\n          </>\n        ) : (\n          <div className=\"text-center py-12 text-muted-foreground\" data-testid=\"no-data\">\n            No units match the current filter criteria. Try adjusting your filters.\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":16048},"client/src/components/analysis/market-position-gauge.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, TrendingDown, Minus } from \"lucide-react\";\n\ninterface MarketPositionGaugeProps {\n  percentileRank: number;\n  marketPosition: string;\n  pricingPowerScore: number;\n}\n\nexport default function MarketPositionGauge({ \n  percentileRank, \n  marketPosition,\n  pricingPowerScore \n}: MarketPositionGaugeProps) {\n  // Determine color and icon based on percentile\n  const getPositionColor = (percentile: number) => {\n    if (percentile <= 33) return \"text-green-600\";\n    if (percentile <= 66) return \"text-yellow-600\";\n    return \"text-red-600\";\n  };\n\n  const getPositionBgColor = (percentile: number) => {\n    if (percentile <= 33) return \"bg-green-100\";\n    if (percentile <= 66) return \"bg-yellow-100\";\n    return \"bg-red-100\";\n  };\n\n  const getPositionIcon = (percentile: number) => {\n    if (percentile <= 33) return <TrendingDown className=\"h-5 w-5\" />;\n    if (percentile <= 66) return <Minus className=\"h-5 w-5\" />;\n    return <TrendingUp className=\"h-5 w-5\" />;\n  };\n\n  const getPositionLabel = (percentile: number) => {\n    if (percentile <= 33) return \"Underpriced\";\n    if (percentile <= 66) return \"Optimal\";\n    return \"Overpriced\";\n  };\n\n  const positionColor = getPositionColor(percentileRank);\n  const positionBgColor = getPositionBgColor(percentileRank);\n  const positionIcon = getPositionIcon(percentileRank);\n  const positionLabel = getPositionLabel(percentileRank);\n\n  return (\n    <Card data-testid=\"market-position-gauge\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"flex items-center justify-between\">\n          <span>Market Position</span>\n          <Badge \n            variant=\"secondary\" \n            className={`${positionBgColor} ${positionColor}`}\n            data-testid=\"position-badge\"\n          >\n            {positionLabel}\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Percentile Gauge */}\n        <div className=\"relative\">\n          <div className=\"flex justify-between items-center mb-2\">\n            <span className=\"text-sm text-muted-foreground\">Market Percentile</span>\n            <div className={`flex items-center gap-1 ${positionColor}`}>\n              {positionIcon}\n              <span className=\"text-2xl font-bold\" data-testid=\"percentile-value\">\n                {percentileRank}%\n              </span>\n            </div>\n          </div>\n          \n          {/* Visual Gauge with colored zones */}\n          <div className=\"relative h-4 bg-gradient-to-r from-green-200 via-yellow-200 to-red-200 rounded-full overflow-hidden\">\n            <div \n              className=\"absolute top-0 left-0 h-full w-1 bg-gray-800\"\n              style={{ left: `${percentileRank}%` }}\n              data-testid=\"gauge-indicator\"\n            />\n          </div>\n          \n          {/* Zone labels */}\n          <div className=\"flex justify-between mt-2 text-xs text-muted-foreground\">\n            <span>Underpriced</span>\n            <span>Optimal</span>\n            <span>Overpriced</span>\n          </div>\n        </div>\n\n        {/* Market Position Text */}\n        <div className=\"text-center p-4 bg-muted rounded-lg\">\n          <div className=\"text-lg font-semibold\" data-testid=\"market-position-text\">\n            {marketPosition}\n          </div>\n          <div className=\"text-sm text-muted-foreground mt-1\">\n            Current Market Position\n          </div>\n        </div>\n\n        {/* Pricing Power Score */}\n        <div className=\"space-y-2\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-sm font-medium\">Pricing Power Score</span>\n            <span className=\"text-sm font-bold\" data-testid=\"pricing-power-value\">\n              {pricingPowerScore}/100\n            </span>\n          </div>\n          <Progress \n            value={pricingPowerScore} \n            className=\"h-2\" \n            data-testid=\"pricing-power-progress\"\n          />\n          <div className=\"text-xs text-muted-foreground\">\n            Higher score indicates stronger pricing leverage\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":4313}},"version":1}